(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{323:function(e,a){},331:function(e,a,t){e.exports=t(889)},342:function(e,a,t){},598:function(e,a){},600:function(e,a){},63:function(e){e.exports={b:"https://raw.githubusercontent.com/medialab/ricardo_data/master",a:"https://api.github.com/repos/medialab/ricardo_data/contents"}},632:function(e,a){},633:function(e,a){},766:function(e,a,t){var n={"./geojson.json":299,"./table-schema.json":767,"./topojson.json":300};function r(e){var a=c(e);return t(a)}function c(e){if(!t.o(n,e)){var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=c,e.exports=r,r.id=766},834:function(e,a,t){var n={"./data-package.json":835,"./data-resource.json":836,"./fiscal-data-package.json":837,"./registry.json":838,"./tabular-data-package.json":839,"./tabular-data-resource.json":840};function r(e){var a=c(e);return t(a)}function c(e){if(!t.o(n,e)){var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=c,e.exports=r,r.id=834},886:function(e,a){},887:function(e,a){},889:function(e,a,t){"use strict";t.r(a);var n=t(0),r=t.n(n),c=t(76),o=t.n(c),l=t(35),i=(t(342),t(58)),s=t(59),u=t(61),d=t(60),m=t(62),p=t(17),f=t(121),h=t(63),v=t(78),E="FETCH_DATAPACKAGE_SUCCESS",b="FETCH_TABLES_SUCCESS",y=[{name:"sources",path:"data/sources.csv"},{name:"entity_names",path:"data/entity_names.csv"}],g={};var O=function(e){function a(){return Object(i.a)(this,a),Object(u.a)(this,Object(d.a)(a).apply(this,arguments))}return Object(m.a)(a,e),Object(s.a)(a,[{key:"componentDidMount",value:function(){this.props.fetchDatapackage(),this.props.fetchAllTables({branch:"master"})}},{key:"render",value:function(){var e=this.props.repoData;return r.a.createElement("div",null,!e.tables&&r.a.createElement("span",null,"loading tables"),!e.datapackage&&r.a.createElement("span",null,"loading datapackage"))}}]),a}(r.a.Component),j=Object(l.b)(function(e){return{repoData:e.repoData}},{fetchAllTables:function(e){return function(a){var t=e.branch;a({type:"FETCH_TABLES_REQUEST"}),Promise.all(y.map(function(e){return Object(f.get)("".concat(h.a,"/").concat(e.path,"?ref=").concat(t))})).then(function(e){var t={};e.forEach(function(e){var a=e.data.name.split(".")[0];t[a]=e.data}),a({type:b,payload:t})}).catch(function(t){return a({type:"FETCH_TABLES_FAILURE",payload:e,error:t})})}},fetchDatapackage:function(){return function(e){return e({type:"FETCH_DATAPACKAGE_REQUEST"}),Object(f.get)("".concat(h.a,"/datapackage.json?ref=master")).then(function(a){return e({type:E,payload:a.data})}).catch(function(a){return e({type:"FETCH_DATAPACKAGE_FAILURE",error:a})})}}})(O),k=t(330),w=t(14),S="UPDATE_FLOW",A="IMPORT_FLOWS",T={};var _="SET_STEP",F=function(e){return{type:_,payload:e}},C=[{id:"0",name:"Upload file",title:"Choose a file"},{id:"1",name:"Schema Validation",title:"Schema validation against datapackage"}],N={steps:C,selectedStep:C[0]};var D=t(8),x=t.n(D),R=t(122),L=(t(592),t(327),t(77)),V=t(79),U="VALIDATE_TABLE_REQUEST",B="VALIDATE_TABLE_SUCCESS",H="VALIDATE_TABLE_FAILURE",I="VALIDATE_HEADER_REQUEST",P="VALIDATE_HEADER_SUCCESS",M="VALIDATE_HEADER_FAILURE",K={tableValidated:"flows",schemaFeedback:null,headerFeedback:null,tables:null};var W=function(e){var a=e.schemaValidation.tableValidated;return e.schemaValidation.descriptor.resources.find(function(e){return e.name===a}).schema},Q=function(e){var a=G(e),t={};return a.forEach(function(a){var n=a.reference.resource;t[n]=e.schemaValidation.tables[n]}),t},G=function(e){var a=e.schemaValidation.tableValidated;return e.schemaValidation.descriptor.resources.find(function(e){return e.name===a}).schema.foreignKeys},J=t(120),Y=function(e){var a,t=e.headerNames,n=e.fieldNames,c=t.length-n.length;return a=c>0?Object(J.difference)(t,n):Object(J.difference)(n,t),r.a.createElement("div",null,a.length===c&&c>0&&r.a.createElement("div",{className:"has-text-danger"},r.a.createElement("span",null,"Extra headers - "),a.map(function(e){return r.a.createElement("span",null,'"',e,'" ')})),a.length===Math.abs(c)&&c<0&&r.a.createElement("div",{className:"has-text-danger has-text-weight-bold"},r.a.createElement("span",null,"Missing headers - "),a.map(function(e){return r.a.createElement("span",null,'"',e,'" ')})),r.a.createElement("div",{style:{display:"flex",flexFlow:"row nowrap"}},r.a.createElement("div",null,r.a.createElement("div",{className:"has-text-weight-bold"},"headers"),t.map(function(e,a){return r.a.createElement("div",{key:a},e)})),r.a.createElement("div",null,r.a.createElement("div",{className:"has-text-weight-bold"},"schema fields"),n.map(function(e,a){return r.a.createElement("div",{key:a},e)}))))},z=t(179),Z=t.n(z);var $=Object(l.b)(function(e){return{schema:e.schemaValidation.descriptor&&W(e),headerFeedback:e.schemaValidation.headerFeedback}},{importFlows:function(e){return{type:A,payload:e}},setStep:F,validateHeader:function(e){return function(a){var t=e.source,n=e.schema;a({type:I,payload:Object(p.a)({},e,{status:"loading"})}),a(Object(R.a)(x.a.mark(function e(){var r;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,L.Table.load(t.slice(0,2),{schema:n});case 3:return r=e.sent,e.next=6,r.read({limit:1});case 6:a({type:P,payload:{status:"done",valid:!0,headers:r.headers}}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0),a({type:M,valid:!1,payload:e.t0});case 13:case"end":return e.stop()}},e,null,[[0,9]])})))}}})(function(e){var a=e.schema,t=e.headerFeedback,n=e.setStep,c=e.importFlows,o=e.validateHeader;return r.a.createElement("div",null,r.a.createElement(w.DropZone,{maxSize:1e7,onDrop:function(e){var t=Object(k.a)(e,1)[0];"xlsx"===t.name.split(".")[1]?function(e){return new Promise(function(a,t){var n=new FileReader;n.onload=function(e){var t=e.target.result,r=Z.a.read(t,{type:"binary"}),c=r.SheetNames[0],o=r.Sheets[c],l=Z.a.utils.sheet_to_json(o,{header:1,defval:"",blankrows:!1});a(l),n=void 0},n.onerror=function(e){t(e.target.error),n=void 0},n.readAsBinaryString(e)})}(t).then(function(e){c({file:{name:t.name},data:e}),o({source:e,schema:a})}).catch(function(e){return console.error("fail to parse file")}):function(e){return new Promise(function(a,t){var n=new FileReader;return n.onload=function(t){var r;r="csv"===e.name.split(".")[1]?Object(V.b)(t.target.result):Object(V.c)(t.target.result),a(r),n=void 0},n.onerror=function(e){t(e.target.error),n=void 0},n.readAsText(e)})}(t).then(function(e){c({file:{name:t.name},data:e}),o({source:e,schema:a})}).catch(function(e){return console.error("fail to parse file")})},onDropRejected:function(e,a){console.log("file is invalid")},isSize:"small"},r.a.createElement("span",{className:"tech-info"},"Drag and drop .xlsx, .csv file here(maximum 10MB)")),t&&"loading"===t.status&&r.a.createElement("span",null,"validating fields"),t&&t.valid&&r.a.createElement("div",null,r.a.createElement("span",null,"data fields are valid"),r.a.createElement(w.Button,{isColor:"info",onClick:function(){return n({id:"1"})}},"Next Step")),t&&!t.valid&&"ERROR_HEADER"===t.type&&r.a.createElement("div",null,r.a.createElement("span",{className:"has-text-danger has-text-weight-bold"},"Fields are invalid, plase fix your file and re-upload"),r.a.createElement(Y,{headerNames:t.headerNames,fieldNames:t.fieldNames})))}),q=t(119),X=function(e){function a(){return Object(i.a)(this,a),Object(u.a)(this,Object(d.a)(a).apply(this,arguments))}return Object(m.a)(a,e),Object(s.a)(a,[{key:"render",value:function(){var e=this.props,a=e.className,t=e.columnNames,n=void 0===t?[]:t,c=e.values,o=void 0===c?[]:c;return r.a.createElement("div",{style:{position:"relative",width:"100%",height:"70vh"}},r.a.createElement("div",{className:"action-table ".concat(a)},r.a.createElement("div",{className:"action-table-header"},n.map(function(e,a){return r.a.createElement("div",{key:a,className:"table-cell"},e)})),r.a.createElement("div",{className:"action-table-main"},o.map(function(e,a){return r.a.createElement("div",{key:a,className:"table-row"},n.map(function(a,t){return r.a.createElement("div",{key:t,className:"table-cell",style:{wordBreak:"break-all",color:e[a].valid?"black":"red"}},e[a].value,!e[a].valid&&r.a.createElement(w.HelpPin,{place:"right"},e[a].errorType,":",e[a].message))}))}))))}}]),a}(r.a.Component),ee=function(e){function a(){return Object(i.a)(this,a),Object(u.a)(this,Object(d.a)(a).apply(this,arguments))}return Object(m.a)(a,e),Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,a=e.flows,t=e.schema,n=(e.schemaFeedback,e.relations);this.props.validateTable({source:a,schema:t,relations:n})}},{key:"render",value:function(){var e=this.props,a=e.flows,t=(e.schema,e.schemaFeedback),n=(e.relations,a[0]),c=["ERROR_FORMAT","ERROR_UNIQUE_KEY","ERROR_FOREIGN_KEY"];return r.a.createElement("div",null,t&&"loading"===t.status&&r.a.createElement("span",null,t.loader),t&&!t.valid&&t.errors&&r.a.createElement("div",null,r.a.createElement("span",null,"Found ",t.errors.length," rows has errors"),r.a.createElement(X,{values:function(){var e=[];return t.errors.forEach(function(t){var r=a[t.rowNumber-1],o=n.reduce(function(e,a,n){var o={name:a,value:r[n],valid:!0};return c.forEach(function(e){var r=t.errors.find(function(a){return a.type===e});if(r&&r.errors){var c=r.errors.find(function(e){return e.columnNumber?e.columnNumber===n+1:e.columnName?e.columnName[0]===a:void 0});c&&(o=Object(p.a)({},o,{valid:!1,errorType:e,message:c.message}))}}),Object(p.a)({},e,Object(q.a)({},a,o))},{});e.push(o)}),e}(),columnNames:n})),t&&t.valid&&r.a.createElement("span",null,"Flows data is valid"))}}]),a}(r.a.Component),ae=Object(l.b)(function(e){return{flows:e.flows.data,schema:e.schemaValidation.descriptor&&W(e),relations:e.schemaValidation.descriptor&&Q(e),foreignKeys:e.schemaValidation.descriptor&&G(e),schemaFeedback:e.schemaValidation.schemaFeedback}},{validateTable:function(e){return function(a){var t=e.source,n=e.schema;e.relations,a(Object(R.a)(x.a.mark(function e(){return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.delegateYield(x.a.mark(function e(){var r,c,o,l,i;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t.length,c=100,o=0,l=[],i=x.a.mark(function e(){var r,i,s,u,d;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a({type:U,payload:{status:"loading",loader:"validating ".concat(o," rows")}}),r=o/c,i=[t[0]].concat(t.slice(o+1-r,o+c-r)),e.next=5,L.Table.load(i,{schema:n});case 5:return s=e.sent,e.next=8,s.read({forceCast:!0});case 8:u=e.sent,(d=u.filter(function(e){return e.errors})).length&&(d.forEach(function(e){return e.rowNumber=e.rowNumber+c*r-r}),l=l.concat(d));case 11:case"end":return e.stop()}},e)});case 6:if(!(o<r)){e.next=11;break}return e.delegateYield(i(),"t0",8);case 8:o+=c,e.next=6;break;case 11:l.length?a({type:H,payload:{status:"done",valid:!1,errors:l}}):a({type:B,payload:{status:"done",valid:!0}});case 12:case"end":return e.stop()}},e)})(),"t0",2);case 2:e.next=8;break;case 4:e.prev=4,e.t1=e.catch(0),console.error(e.t1),a({type:H,payload:e.t1});case 8:case"end":return e.stop()}},e,null,[[0,4]])})))}}})(ee),te=function(e){var a=e.steps,t=e.selectedStep,n=e.onSetStep,c=e.children;return r.a.createElement(w.LayoutWrapper,{hasConfig:!0},r.a.createElement(w.LayoutHeader,null,r.a.createElement(w.AppTitle,null,"Ricardo Data App"),r.a.createElement(w.RunningTitle,null,t.title)),r.a.createElement(w.LayoutContainer,null,r.a.createElement(w.LayoutContent,null,r.a.createElement(w.LayoutContentColumn,{isConfig:!0},a.map(function(e,a){var c=t.id===e.id,o=e.id>t.id;return r.a.createElement(w.ButtonContainer,{key:a},r.a.createElement(w.Button,{isColor:c?"info":null,isDisabled:o,onClick:function(){return n(e)}},e.name))})),r.a.createElement(w.LayoutContentColumn,{isWorkspace:!0},c)),r.a.createElement(w.LayoutFooter,null,r.a.createElement(w.LayoutFooterColumn,{isSecondary:!0},r.a.createElement("h3",null,"m\xe9dialab SciencesPo")),r.a.createElement(w.LayoutFooterColumn,{isPrimary:!0},"Ricardo Data App"))))},ne=(t(888),Object(l.b)(function(e){return{steps:e.ui.steps,selectedStep:e.ui.selectedStep,repoData:e.repoData}},{setStep:F})(function(e){var a=e.steps,t=e.selectedStep,n=e.repoData,c=e.setStep;return r.a.createElement("div",{className:"App"},r.a.createElement(j,null),n.descriptor&&r.a.createElement(te,{steps:a,selectedStep:t,onSetStep:c},function(){switch(t.id){case"0":default:return r.a.createElement($,null);case"1":return r.a.createElement(ae,null)}}()))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var re=t(29),ce=t(180),oe=t(328),le=t(329),ie=Object(re.c)({ui:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,a=arguments.length>1?arguments[1]:void 0,t=a.payload;switch(a.type){case _:return Object(p.a)({},e,{selectedStep:C.find(function(e){return t.id===e.id})});default:return e}},flows:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,a=arguments.length>1?arguments[1]:void 0,t=a.payload;switch(a.type){case A:return t;case S:return Object(p.a)({},e,{data:t.data});default:return e}},schemaValidation:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,a=arguments.length>1?arguments[1]:void 0,t=a.payload;switch(a.type){case _:return"0"===t.id?Object(p.a)({},e,{schemaFeedback:null,headerFeedback:null}):e;case b:var n={};return Object.keys(t).forEach(function(e){n[e]=Object(V.a)(v.Base64.decode(t[e].content))}),Object(p.a)({},e,{tables:n});case E:return Object(p.a)({},e,{descriptor:JSON.parse(v.Base64.decode(t.content))});case I:case M:case P:return Object(p.a)({},e,{headerFeedback:t});case U:case H:case B:return Object(p.a)({},e,{schemaFeedback:t});default:return e}},repoData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,a=arguments.length>1?arguments[1]:void 0,t=a.payload;switch(a.type){case b:return Object(p.a)({},e,{tables:t});case E:return Object(p.a)({},e,{datapackage:t,descriptor:JSON.parse(v.Base64.decode(t.content))});default:return e}}}),se={key:"root",storage:oe};Object(ce.a)(se,ie);var ue=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=[le.a],t=re.d.apply(void 0,[re.a.apply(void 0,a)].concat([])),n=Object(re.e)(ie,e,t);return{store:n,persistor:Object(ce.b)(n)}}({}).store;o.a.render(r.a.createElement(l.a,{store:ue},r.a.createElement(ne,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[331,1,2]]]);
//# sourceMappingURL=main.b9a6a716.chunk.js.map