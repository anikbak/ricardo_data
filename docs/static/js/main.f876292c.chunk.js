(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{363:function(e,t){},374:function(e,t,a){e.exports=a(967)},385:function(e,t,a){},52:function(e){e.exports={a:"https://api.github.com/repos/medialab/ricardo_data/contents",b:"https://api.github.com/repos/medialab/ricardo_data/branches",c:"https://api.github.com/repos/medialab/ricardo_data/git/refs",d:"https://api.github.com/user"}},621:function(e,t){},623:function(e,t){},655:function(e,t){},656:function(e,t){},781:function(e,t,a){var n={"./geojson.json":319,"./table-schema.json":782,"./topojson.json":320};function r(e){var t=l(e);return a(t)}function l(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=l,e.exports=r,r.id=781},844:function(e,t,a){var n={"./data-package.json":845,"./data-resource.json":846,"./fiscal-data-package.json":847,"./registry.json":848,"./tabular-data-package.json":849,"./tabular-data-resource.json":850};function r(e){var t=l(e);return a(t)}function l(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=l,e.exports=r,r.id=844},915:function(e,t,a){var n={"./geojson.json":353,"./table-schema.json":916,"./topojson.json":354};function r(e){var t=l(e);return a(t)}function l(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=l,e.exports=r,r.id=915},963:function(e,t){},964:function(e,t){},966:function(e,t,a){},967:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(51),i=a.n(l),o=a(30),c=(a(385),a(21)),s=a(22),u=a(24),d=a(23),f=a(25),m=a(4),p=a(2),h=a(3),E=a(88),b="START_MODIFICATION",v={foreignKeyField:null,modificationIndex:0,modificationList:null},g=Object(E.a)(v,{SET_STEP:function(e,t){if("0"===t.payload.id)return v},START_MODIFICATION:function(e,t){var a=t.payload;e.modificationList=a,e.modificationIndex=0},REVALIDATE_ROWS_SUCCESS:function(e,t){var a=t.payload,n=a.originalValue,r=a.fixedValues;e.modificationList.forEach(function(t,a){"currency|year|reporting"===t.field&&t.value.split("|")[1]===""+n&&(e.modificationList[a]=Object(h.a)({},e.modificationList[a],{fixed:!0,unchangable:!0,fixedValues:{currency:t.value.split("|")[0],year:r.year,reporting:t.value.split("|")[2]}}))})},REVALIDATE_ROWS_FAILURE:function(e,t){var a=t.payload,n=a.fixedValues,r=a.rowNumbers;e.modificationList.forEach(function(t,a){var l=t.errors.map(function(e){return e.rowNumber});if("currency|year|reporting"===t.field&&Object(m.isEqual)(l,r)){var i=t.value.split("|")[0]+"|"+n.year+"|"+t.value.split("|")[2],o=e.modificationList.find(function(e){return e.value===i});o&&o.index!==a?e.modificationList[a]=Object(h.a)({},e.modificationList[a],{fixed:!0,unchangable:!0,fixedValues:{currency:t.value.split("|")[0],year:n.year,reporting:t.value.split("|")[2]}}):e.modificationList[a]=Object(h.a)({},e.modificationList[a],{fixed:!1,unchangable:!1,value:i,fixedValues:null})}})},HIDE_MODIFICATION:function(e,t){e.modificationIndex=0},SELECT_ERROR:function(e,t){var a=t.payload;e.modificationIndex=a.index},GO_NEXT_ERROR:function(e,t){e.modificationIndex=e.modificationIndex+1},GO_PREV_ERROR:function(e,t){e.modificationIndex>0&&(e.modificationIndex=e.modificationIndex-1)},SUBMIT_MODIFICATION:function(e,t){var a=t.payload;e.modificationList[a.index]=Object(h.a)({},e.modificationList[a.index],a,{fixed:!0})}}),w="SET_STEP",y="HIDE_MODIFICATION",C="SELECT_ERROR",R="SHOW_CONFIRMATION_MODAL",O="HIDE_CONFIRMATION_MODAL",S=function(e){return{type:w,payload:e}},x=[{id:"0",name:"Upload file",title:"Choose a file"},{id:"1",name:"Schema Validation",title:"Schema validation against datapackage"},{id:"2",name:"Error Fixing",title:"Fix errors by fields"},{id:"3",name:"Export/Publish Data",title:"Export or Publish your data to Github"}],j={steps:x,isModalDisplay:!1,selectedStep:x[0],isModification:!1,fixedIndex:[]};var N={},T=Object(E.a)(N,{SET_STEP:function(e,t){if("0"===t.payload.id)return N},IMPORT_FLOWS:function(e,t){return t.payload},UPDATE_FLOWS:function(e,t){var a=t.payload,n=a.errors,r=a.fixedValues,l=Object.keys(r);n.forEach(function(t){l.forEach(function(a){var n=e.data[0].indexOf(a);e.data[t.rowNumber-1][n]=r[a]})})}}),_=a(12),F=a.n(_),k=a(72),I=a(15),A=a(200),L=a(368),V=a(64),D=a(71),M=a(43),B=a(52),U=["slug","export_import","special_general","reporting","partner","original_name","currency","year"],H={id:0,flow:1,unit:2,year:3,species_bullions:4,transport_type:5,statistical_period:6,partner_sum:7,world_trade_type:8,notes:9,source:10,reporting:11,partner:12,"export_import|special_general":13,"currency|year|reporting":14},P=a(53),G=a(371),K="INIT_TABLES",W={},q=Object(E.a)(W,{INIT_TABLES:function(e){return W},FETCH_TABLES_SUCCESS:function(e,t){var a=t.payload,n={},r={};Object.keys(a).forEach(function(e){n[e]=Object(M.c)(D.Base64.decode(a[e].content),function(e){return e.year?Object(h.a)({},e,{year:+e.year}):e}),r[e]=n[e].length}),e.referenceTables=n,e.originalLength=r},DELETE_TABLE_ROW:function(e,t){var a=t.payload,n=a.data,r=a.resourceName,l=e.referenceTables[r].slice();l=l.filter(function(e){return!n.some(function(t){return Object(m.isEqual)(e,t)})}),e.referenceTables[r]=l},ADD_TABLE_ROW:function(e,t){var a=t.payload,n=a.data,r=a.resourceName,l=e.referenceTables[r].slice();l.splice.apply(l,[l.length,0].concat(Object(G.a)(n))),e.referenceTables[r]=l}}),Q="FETCH_DATAPACKAGE_SUCCESS",Y="FETCH_TABLES_SUCCESS",z="FETCH_BRANCHES_SUCCESS",J="CREATE_BRANCH_SUCCESS",X="CREATE_BRANCH_FAILURE",Z="UPDATE_REMOTE_FILES_REQUEST",$="UPDATE_REMOTE_FILES_SUCCESS",ee="UPDATE_REMOTE_FILES_FAILURE",te="SELECT_BRANCH",ae=[{name:"sources",path:"data/sources.csv"},{name:"RICentities",path:"data/RICentities.csv"},{name:"RICentities_groups",path:"data/RICentities_groups.csv"},{name:"currencies",path:"data/currencies.csv"},{name:"entity_names",path:"data/entity_names.csv"},{name:"exchange_rates",path:"data/exchange_rates.csv"},{name:"expimp_spegen",path:"data/expimp_spegen.csv"}],ne=function(e){return{type:te,payload:e}},re={};var le="VALIDATE_TABLE_REQUEST",ie="VALIDATE_TABLE_SUCCESS",oe="VALIDATE_TABLE_FAILURE",ce="VALIDATE_HEADER_REQUEST",se="VALIDATE_HEADER_SUCCESS",ue="VALIDATE_HEADER_FAILURE",de=function(e){return"string"===typeof e?e:e.join("|")},fe=function(e,t,a){var n=t.fields,r=t.foreignKeys,l=n.map(function(e){return e.name}),i=["source","export_import","special_general","currency"],o=n.filter(function(e){return-1===i.indexOf(e.name)}),c=r.map(function(e){return de(e.fields)}),s=["ERROR_FORMAT","ERROR_FOREIGN_KEY"],u=o.reduce(function(e,t){return Object(h.a)({},e,Object(I.a)({},t.name,{name:t.name,schema:t,errorType:"ERROR_FORMAT",errors:[]}))},{}),d=r.reduce(function(e,t){var a=de(t.fields);return Object(h.a)({},e,Object(I.a)({},a,Object(h.a)({name:a},t,{errorType:"ERROR_FOREIGN_KEY",errors:[]})))},{});return a.forEach(function(t){var a=e[t.rowNumber-1],n=t.rowNumber,r=t.originalRowNumber;s.forEach(function(e){var o=t.errors.find(function(t){return t.type===e});o&&("ERROR_FORMAT"===e?l.forEach(function(t,r){o.errors.forEach(function(l){if(l.columnNumber===r+1&&-1===i.indexOf(t)){var o={rowNumber:n,errorType:e,columnNumber:l.columnNumber,field:t,value:a[r],message:l.message};u[t].errors.push(o)}})}):"ERROR_FOREIGN_KEY"===e&&c.forEach(function(t){o.errors.forEach(function(i){var o=de(i.columnName);if(o===t){var c=i.columnName.map(function(e){var t=l.indexOf(e);return a[t]}),s={rowNumber:n,originalRowNumber:r,errorType:e,columnName:i.columnName,field:o,value:c.join("|"),message:i.message};d[t].errors.push(s)}})}))})}),Object.keys(u).forEach(function(e){u[e].errors.length||delete u[e]}),Object.keys(d).forEach(function(e){d[e].errors.length||delete d[e]}),u.reporting||u.partner?u:Object(h.a)({},u,d)},me={resourceName:"flows",schemaFeedback:null,headerFeedback:null,descriptor:null};var pe=function(e){return e.schemaValidation.resourceName},he=function(e){return e.schemaValidation.descriptor.resources},Ee=/row\s\d*/,be=Object(A.a)(pe,he,function(e,t){return t.find(function(t){return t.name===e}).schema}),ve=Object(A.a)(pe,he,function(e){return e.referenceTables.referenceTables},function(e,t,a){var n=t.find(function(t){return t.name===e}),r={};return n.schema.foreignKeys.forEach(function(e){var t=e.reference.resource;r[t]=a[t]}),r}),ge=function(e){var t=e.className,a=e.modificationList,n=e.onSelectError,l=["","Field","Value","Rows",""],i=a.filter(function(e){return"year"===e.field&&!e.fixed}).map(function(e){return""+e.value});return r.a.createElement("div",{style:{position:"relative",width:"100%",height:"70vh"}},r.a.createElement("div",{className:"action-table ".concat(t)},r.a.createElement("div",{className:"action-table-header"},l.map(function(e,t){return r.a.createElement("div",{key:t,className:"table-cell"},r.a.createElement("span",{className:"Value"===e?"has-text-danger":"has-text-black"},e))})),r.a.createElement("div",{className:"action-table-main"},a.map(function(e,t){var a=e.field,o=e.errors,c=e.originalValue,s=e.value,u=e.message,d=e.fixed,f=e.fixedValues,h=Object(m.values)(f).join("|"),E=Object(m.difference)(U,a.split("|")).length<U.length,b=function(){n(t)},v=!1;return"currency|year|reporting"===e.field&&-1!==i.indexOf(e.value.split("|")[1])&&(v=!0),r.a.createElement("div",{key:t,className:"table-row"},l.map(function(n,l){switch(l){case 0:default:return r.a.createElement("div",{key:l,className:"table-cell"},t+1);case 1:return r.a.createElement("div",{key:l,className:"table-cell"},a);case 2:return r.a.createElement("div",{key:l,className:"table-cell"},c!==s&&r.a.createElement("span",{className:"has-text-danger"},c," ->"),r.a.createElement("span",{className:"has-text-danger"},Object(m.isNull)(s)?"none":s),d&&r.a.createElement("span",{className:"has-text-success"}," ->",""===h?"none":h),r.a.createElement(p.HelpPin,null,u));case 3:return r.a.createElement("div",{key:l,className:"table-cell"},r.a.createElement("p",{className:e.fixed?"has-text-success":"has-text-black"},o.length," ",e.fixed&&!E?"rows updated":""),e.fixedReferenceTable&&e.fixedReferenceTable.length&&e.fixedReferenceTable.map(function(e,t){return r.a.createElement("p",{key:t,className:"has-text-success"},e.data.length,' row(s) added to "',e.resourceName,'" table')}));case 4:return r.a.createElement("div",{key:l,className:"table-cell"},r.a.createElement(p.Button,{isDisabled:v,isOutlined:!0,isColor:e.fixed?"success":"info",onClick:b},e.fixed?"fixed":"fix error"))}}))}))))},we=function(e){var t=e.className,a=e.flows,n=e.modificationItem,l=a[0],i=n.errors,o=n.field,c=n.value,s=n.fixedValues;return r.a.createElement("div",{style:{position:"relative",width:"100%",height:"20vh"}},r.a.createElement("div",{className:"action-table ".concat(t)},r.a.createElement("div",{className:"action-table-header"},l.map(function(e,t){var a=-1!==o.split("|").indexOf(e);return r.a.createElement("div",{key:t,className:"table-cell"},r.a.createElement("span",{className:a?"has-text-danger":"has-text-black"},e))})),r.a.createElement("div",{className:"action-table-main",style:{height:"100%"}},i.map(function(e,t){return r.a.createElement("div",{key:t,className:"table-row"},l.map(function(t,n){var l,i=-1!==o.split("|").indexOf(t),u=o.split("|").indexOf(t),d=(""+c).split("|")[u];return"year"===t&&1===u&&(d=a[e.rowNumber-1][n]),s&&i&&(l=0===s[t].length?"none":s[t]),r.a.createElement("div",{key:n,className:"table-cell",style:{wordBreak:"break-all"}},r.a.createElement("span",{className:i?"has-text-danger":"has-text-black"},i?d:a[e.rowNumber-1][n]),l&&r.a.createElement("span",{className:"has-text-success"}," ->",l))}))}))))},ye=a(89),Ce=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=e.map(function(e){return{label:e,value:e}});return t||a.unshift({value:"",label:"none"}),a},Re=function(e){var t,a=e.tables,n=e.resourceName,r=e.referenceField,l=e.filter;return t=l?a[n].filter(function(e){return e[l.field]!==l.value}).map(function(e){return e[r]}):a[n].map(function(e){return e[r]}),Object(m.uniq)(t).map(function(e){return{value:e,label:e}})},Oe=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).getStateFromProps=function(){var e,t=a.props,n=t.fieldDescriptor,r=t.fieldValue,l=new V.Field(n);return l.constraints&&l.constraints.enum&&(e=Ce(l.constraints.enum,l.constraints.required)),{fieldSchema:l,value:r,fieldValid:{valid:!1},options:e}},a.validateField=function(e){var t,n=a.state.fieldSchema;try{n.castValue(e),t={value:e,fieldValid:{valid:!0}},a.setState(t),a.props.onChange(Object(h.a)({fieldName:a.state.fieldSchema.name},t))}catch(r){t={value:e,fieldValid:{valid:!1,error:r}},a.setState(t),a.props.onChange(Object(h.a)({fieldName:a.state.fieldSchema.name},t))}},a.handleChange=function(e){e?e&&e.value?a.validateField(e.value):e&&e.target?a.validateField(e.target.value):a.validateField(""):("",a.validateField(""))},a.handleClickCreate=function(){var e=a.props.foreignKeys.find(function(e){return e.fields===a.state.fieldSchema.name});a.handleChange(""),a.props.onClickCreate({referenceMap:{field:a.state.fieldSchema.name,referenceField:e?e.reference.fields:a.state.fieldSchema.name}})},a.state=a.getStateFromProps(),a}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this.props,a=t.fieldDescriptor,n=t.fieldValue;"slug"===a.name&&n!==e.fieldValue&&this.validateField(n)}},{key:"renderField",value:function(){var e,t=this.props,a=t.fieldValue,n=t.foreignKeys,l=t.referenceTables,i=t.showNewReference,o=t.newReference,c=t.isNonchangable,s=this.state,u=s.fieldSchema,d=(s.fieldValid,s.value),f=!1;if(-1!==Object(m.findIndex)(n,function(e){return e.fields===u.name||-1!==e.fields.indexOf(u.name)})){var h=Object(m.findIndex)(n,function(e){return e.fields===u.name||-1!==e.fields.indexOf(u.name)}),E=n[h].reference.resource,b=n[h].reference.fields;f=!0,e=Re({tables:l,resourceName:E,referenceField:"object"===typeof b?b[0]:b})}return c?r.a.createElement("span",null,a):f?r.a.createElement("div",null,!i&&!o&&r.a.createElement(ye.a,{isSearchable:!0,isClearable:!0,value:function(e){return{value:e,label:e}}(d),options:e,onChange:this.handleChange}),o&&r.a.createElement("div",null,a),!this.state.value&&r.a.createElement(p.Button,{isColor:"info",onClick:this.handleClickCreate},"Create new item")):u.constraints&&u.constraints.enum?r.a.createElement(p.Select,{value:d,onChange:this.handleChange},this.state.options.map(function(e,t){return r.a.createElement("option",{key:t,value:e.value},e.label)})):r.a.createElement(p.Input,{value:d,onChange:this.handleChange})}},{key:"render",value:function(){var e=this.state,t=e.fieldSchema,a=e.fieldValid,n=(e.value,this.props),l=n.showNewReference,i=n.newReference;return r.a.createElement(p.Field,null,r.a.createElement(p.Label,null,t.name,t.constraints&&t.constraints.required&&r.a.createElement("span",null,"*")),r.a.createElement(p.Control,null,this.renderField()),a&&a.error&&!l&&!i&&r.a.createElement(p.Help,{isColor:"danger"},a.error.message))}}]),t}(r.a.Component),Se=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).hydrateState=function(){return{fixedValue:null,showSolving:!a.props.modificationItem.fixed,fieldValid:null}},a.handleFieldChange=function(e){var t=e.value,n=e.fieldValid;a.setState({fixedValue:t,fieldValid:n})},a.handleSubmitForm=function(){var e=a.props.modificationItem,t=a.state,n=t.fixedValue,r=t.fieldValid;if(r&&r.valid){var l=Object(I.a)({},e.field,n);a.props.onSubmitForm({fixedValues:l})}},a.handleShowSolving=function(){a.setState({showSolving:!0})},a.handleHideSolving=function(){a.setState({showSolving:!1})},a.state=a.hydrateState(),a}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidUpdate",value:function(e){if(this.props.modificationIndex!==e.modificationIndex){var t=this.hydrateState();this.setState(Object(h.a)({},t))}}},{key:"renderOriginal",value:function(){var e=this.props.modificationItem,t=e.value,a=e.message,n=e.field;return r.a.createElement(p.Field,null,r.a.createElement(p.Label,null,'Original value of "',n,'":'),r.a.createElement("strong",null,0===t.length?"none":t),r.a.createElement(p.Help,{isColor:"danger"},a))}},{key:"renderFixed",value:function(){var e=this.props.modificationItem,t=e.fixedValues,a=e.field,n=e.errors,l=0===t[a].length?"none":t[a];return r.a.createElement(p.Field,null,r.a.createElement(p.Label,{className:"has-text-success"},"Fixed with value"),r.a.createElement("strong",{className:"has-text-success"},l),r.a.createElement(p.Help,{isColor:"success"},"total ",n.length," rows affected"),r.a.createElement(p.Button,{isColor:"info",onClick:this.handleShowSolving},"Change this fix"))}},{key:"renderInput",value:function(){var e=this.props,t=e.modificationItem,a=e.fieldDescriptor,n=this.state.fieldValid,l=!n||!n.valid;return r.a.createElement("div",null,r.a.createElement(p.Label,null,"Fix with a new input"),r.a.createElement(Oe,{isNonchangable:!1,fieldDescriptor:a,fieldValue:t.value,onChange:this.handleFieldChange}),r.a.createElement(p.Field,{isGrouped:!0},t.fixed&&r.a.createElement(p.Control,null,r.a.createElement(p.Button,{isColor:"info",onClick:this.handleHideSolving},"Cancel")),r.a.createElement(p.Control,null,r.a.createElement(p.Button,{isColor:"info",isDisabled:l,onClick:this.handleSubmitForm},"Confirm this fix"))))}},{key:"render",value:function(){var e=this.props.modificationItem.fixed;return r.a.createElement("div",{style:{height:"60vh"}},r.a.createElement("form",null,r.a.createElement(p.Columns,null,r.a.createElement(p.Column,{isSize:"1/2"},this.renderOriginal(),e&&!this.state.showSolving&&this.renderFixed(),this.state.showSolving&&this.renderInput()))))}}]),t}(r.a.Component),xe=["author","name","country","volume_date","volume_number","pages"],je=(r.a.Component,function(e){var t=e.resource,a=t.data,n=t.resourceName;return r.a.createElement("div",{style:{height:"40vh",overflow:"auto"}},r.a.createElement("h3",null,a.length,' row(s) add to "',n,'" table'),a.map(function(e){return Object.keys(e).map(function(t){return r.a.createElement("div",null,r.a.createElement(p.Label,null,t,":"),r.a.createElement("p",null,e[t]))})}))}),Ne={type:0,RICname:1,continent:2,COW_code:3},Te=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).getStateFromProps=function(){return{fields:a.props.resourceDescriptor.schema.fields.reduce(function(e,t){var a="",n=!0;t.constraints&&t.constraints.enum&&(a=t.constraints.enum[0]);return t.constraints&&t.constraints.required&&!t.constraints.enum&&(n=!1),"type"===t.name&&(a="group"),"continent"===t.name&&(a=""),Object(h.a)({},e,Object(I.a)({},t.name,{value:a,fieldValid:{valid:n}}))},{})}},a.handleFieldChange=function(e){a.setState({fields:Object(h.a)({},a.state.fields,Object(I.a)({},e.fieldName,e))})},a.handleChangeMulti=function(e){var t,n=a.props.referenceTables.RICentities,r=e?(t=e,Object(m.orderBy)(t,[function(e){return e.value.toLowerCase()}],["asc"]).map(function(e){return e.value}).join(" & ")):"",l=e||[],i=e?function(e,t){var a=e.map(function(e){return t.find(function(t){return t.RICname===e.value}).continent});return a.length>1?"World":1===a.length?a[0]:null}(l,n):null;a.setState({multiParts:l,fields:Object(h.a)({},a.state.fields,{RICname:{fieldName:"RICname",value:r,fieldValid:{valid:""!==r,error:""===r?{message:"field is required"}:null}},continent:{fieldName:"continent",value:i,fieldValid:{valid:""!==i,error:""===i?{message:"field is required"}:null}}})})},a.state=a.getStateFromProps(),a}return Object(f.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.resourceDescriptor,n=t.referenceTables,l=a.schema,i=Object(m.values)(this.state.fields).filter(function(e){return e.fieldValid&&!e.fieldValid.valid}),o=Object(m.sortBy)(l.fields,function(e){return Ne[e.name]}),c=Re({tables:n,resourceName:"RICentities",referenceField:"RICname",filter:{field:"type",value:"group"}});return r.a.createElement("div",null,r.a.createElement("div",{style:{height:"40vh",overflow:"auto"}},r.a.createElement("h3",null,'New row to "',a.name,'" table'),o.map(function(t,a){if("RICname"===t.name){var l=e.state.fields[t.name],i=l.value,o=l.fieldValid;return r.a.createElement(p.Field,null,r.a.createElement(p.Label,null,t.name,t.constraints&&t.constraints.required&&r.a.createElement("span",null,"*")),r.a.createElement(p.Control,null,r.a.createElement(ye.a,{isSearchable:!0,isClearable:!0,isMulti:!0,value:e.state.multiParts,options:c,onChange:e.handleChangeMulti}),r.a.createElement("div",null,i)),o&&o.error&&r.a.createElement(p.Help,{isColor:"danger"},o.error.message))}return r.a.createElement(Oe,{key:a,isNonchangable:"RICname"!==t.name,referenceTables:n,fieldDescriptor:t,fieldValue:e.state.fields[t.name].value,onChange:e.handleFieldChange})})),r.a.createElement(p.Field,{isGrouped:!0},r.a.createElement(p.Control,null,r.a.createElement(p.Button,{isColor:"info",onClick:this.props.onCancel},"Cancel")),r.a.createElement(p.Control,null,r.a.createElement(p.Button,{isColor:"info",isDisabled:i.length>0,onClick:function(){var t={newResource:{resourceName:a.name,data:[Object(m.mapValues)(e.state.fields,function(e){return e.value||""})]},newReference:{resourceName:"RICentities_groups",data:e.state.multiParts.map(function(t){return{RICname_group:e.state.fields.RICname.value,RICname_part:t.value}})}};e.props.onAddNew(t)}},"Add new"))))}}]),t}(r.a.Component),_e=["author","name","country","volume_date","volume_number","pages"],Fe=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).getStateFromProps=function(){var e=a.props,t=e.resourceDescriptor,n=e.originalValues;return{newResource:t.schema.fields.reduce(function(e,t){var a="",r=!0;t.constraints&&t.constraints.enum&&(a=t.constraints.enum[0]);return t.constraints&&t.constraints.required&&!t.constraints.enum&&(r=!1),n&&n.find(function(e){return e.referenceField===t.name})&&"slug"!==t.name&&(a=n.find(function(e){return e.referenceField===t.name}).value,r=!0),Object(h.a)({},e,Object(I.a)({},t.name,{value:a,fieldValid:{valid:r}}))},{}),showNewReference:!1}},a.getSlug=function(e){var t=Object(h.a)({},a.state.newResource,Object(I.a)({},e.fieldName,e));return{fieldName:"slug",value:_e.reduce(function(e,a){var n=t[a].value||"";return e+Object(m.capitalize)(n)},"")}},a.handleFieldChange=function(e){var t=a.props.resourceDescriptor;if(a.state.newResource.slug&&-1!==_e.indexOf(e.fieldName)){var n=a.getSlug(e);a.setState({newResource:Object(h.a)({},a.state.newResource,Object(I.a)({slug:n},e.fieldName,e))})}else"RICentities"===t.name&&"type"===e.fieldName&&"group"===e.value&&a.props.onSelectGroup(),a.setState({newResource:Object(h.a)({},a.state.newResource,Object(I.a)({},e.fieldName,e))})},a.handleShowNew=function(e){a.setState({showNewReference:!0})},a.handleHideNew=function(){var e=a.state.referenceMap.field;a.setState({showNewReference:!1,newReference:null,referenceMap:null,isRICentityGroup:!1,newResource:Object(h.a)({},a.state.newResource,Object(I.a)({},e,{fieldValid:{valid:!1},value:""}))})},a.handleCreateNewReference=function(e){var t=e.referenceMap,n=t.field;t.referenceField;a.setState({showNewReference:!0,resourceValid:{valid:!0},referenceMap:t,newReference:null,newResource:Object(h.a)({},a.state.newResource,Object(I.a)({},n,{fieldValid:{valid:!1},value:""}))})},a.handleAddNewReference=function(e){var t=e.newResource,n=e.newReference,r=a.state.referenceMap,l=r.field,i=r.referenceField;a.setState({newReference:t,newRefReference:n,showNewReference:!1,newResource:Object(h.a)({},a.state.newResource,Object(I.a)({},l,{fieldValid:{valid:!0},value:t.data[0][i]}))})},a.handleResetNewReference=function(){var e=a.state.referenceMap.field;a.setState({newReference:null,newRefReference:null,showNewReference:!0,newResource:Object(h.a)({},a.state.newResource,Object(I.a)({},e,{fieldValid:{valid:!1},value:""}))})},a.handleSelectGroup=function(){a.setState({isRICentityGroup:!0})},a.state=a.getStateFromProps(),a}return Object(f.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,a=this.props,n=a.descriptor,l=a.resourceDescriptor,i=a.referenceTables,o=a.originalValues,c=l.schema,s=Object(m.values)(this.state.newResource).filter(function(e){return e.fieldValid&&!e.fieldValid.valid}),u=function(){if(c.foreignKeys){var e=c.foreignKeys[0].reference;return n.resources.find(function(t){return t.name===e.resource})}},d=function(){var t=Object(k.a)(F.a.mark(function t(){var a,n,r,o,s,u;return F.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a={newResource:{resourceName:l.name,data:[Object(m.mapValues)(e.state.newResource,function(e){return e.value||""})]},newReference:e.state.newReference,newRefReference:e.state.newRefReference},"currencies"!==l.name||e.state.newReference){t.next=21;break}return n=[Object(m.keys)(a.newResource.data[0])].concat([Object(m.values)(a.newResource.data[0])]),r={exchange_rates:i.exchange_rates},t.prev=4,t.next=7,V.Table.load(n,{schema:c});case 7:return o=t.sent,t.next=10,o.read({forceCast:!0,relations:r});case 10:s=t.sent,(u=s.filter(function(e){return e.errors})).length?e.setState({resourceValid:{valid:!1,message:u[0].errors[0].errors[0].message}}):(e.setState({resourceValid:{valid:!0}}),e.props.onAddNew(a)),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(4),e.setState({resourceValid:{valid:!1,message:t.t0.message||"validation fail"}}),console.error(t.t0);case 19:t.next=22;break;case 21:e.props.onAddNew(a);case 22:case"end":return t.stop()}},t,null,[[4,15]])}));return function(){return t.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement(p.Columns,null,r.a.createElement(p.Column,{style:{height:"50vh",overflow:"auto"}},r.a.createElement("h3",null,'New row to "',l.name,'" table'),c.fields.map(function(t,a){return r.a.createElement(Oe,{key:a,isNonchangable:-1!==U.indexOf(t.name),fieldDescriptor:t,foreignKeys:c.foreignKeys,referenceTables:i,fieldValue:e.state.newResource[t.name]&&e.state.newResource[t.name].value||"",showNewReference:e.state.showNewReference,newReference:e.state.newReference,onClickCreate:e.handleCreateNewReference,onChange:e.handleFieldChange})}),this.state.resourceValid&&this.state.resourceValid.message&&r.a.createElement(p.Field,null,r.a.createElement(p.Help,{isColor:"danger"},this.state.resourceValid.message))),c.foreignKeys&&r.a.createElement(p.Column,null,this.state.showNewReference&&(this.state.isRICentityGroup?r.a.createElement(Te,{descriptor:n,resourceDescriptor:u(),referenceTables:i,onCancel:this.handleHideNew,onAddNew:this.handleAddNewReference}):r.a.createElement(t,{descriptor:n,originalValues:o.filter(function(e){return"year"===e.field}),resourceDescriptor:u(),referenceTables:i,onSelectGroup:this.handleSelectGroup,onCancel:this.handleHideNew,onAddNew:this.handleAddNewReference})),this.state.newReference&&r.a.createElement("div",null,r.a.createElement(je,{resource:this.state.newReference}),r.a.createElement(p.Button,{onClick:this.handleResetNewReference},"Reset"))),c.foreignKeys&&this.state.newRefReference&&r.a.createElement(p.Column,null,r.a.createElement(je,{resource:this.state.newRefReference}))),r.a.createElement(p.Field,{isGrouped:!0},r.a.createElement(p.Control,null,r.a.createElement(p.Button,{isColor:"info",onClick:this.props.onCancel},"Cancel")),r.a.createElement(p.Control,null,r.a.createElement(p.Button,{isColor:"info",isDisabled:s.length>0,onClick:d},"Add new"))))}}]),t}(r.a.Component),ke=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).initFixedValues=function(){return a.props.modificationItem.field.split("|").reduce(function(e,t){return Object(h.a)({},e,Object(I.a)({},t,""))},{})},a.hydrateState=function(){var e=a.props.modificationItem,t=a.initFixedValues();return e.fixedValues&&(t=e.fixedValues),{fixedValues:t,showNewForm:!1,newResource:null,newReference:null,newRefReference:null,showSolving:!e.fixed}},a.handleSubmitForm=function(){var e=a.state,t=e.fixedValues,n=e.newResource,r=e.newReference,l=e.newRefReference,i=[];n&&i.push(n),r&&i.push(r),l&&i.push(l),a.props.onSubmitForm({fixedValues:t,fixedReferenceTable:i})},a.handleClickCreate=function(){var e=a.initFixedValues();a.setState({fixedValues:e,showSolving:!0,showNewForm:!0,newResource:null,newReference:null,newRefReference:null})},a.handleResetCreate=function(){a.setState({showNewForm:!0,newResource:null,newReference:null})},a.handleAddNewResource=function(e){var t=e.newResource,n=e.newReference,r=e.newRefReference,l=a.props,i=l.modificationItem,o=l.foreignKeyField,c=i.field.split("|"),s=c.reduce(function(e,a,n){return Object(h.a)({},e,Object(I.a)({},a,c.length>1?t.data[0][o.reference.fields[n]]:t.data[0][o.reference.fields]))},{});a.setState({newResource:t,newReference:n,newRefReference:r,fixedValues:s,showNewForm:!1})},a.handleCancel=function(){a.setState({showNewForm:!1,newResource:null,newReference:null,newRefReference:null})},a.handleSelectExist=function(e){var t=a.props.modificationItem;e?a.setState({fixedValues:Object(I.a)({},t.field,e.value),newResource:null}):a.setState({fixedValues:Object(I.a)({},t.field,"")})},a.handleShowSolving=function(){a.setState({showSolving:!0,newResource:null,newReference:null,newRefReference:null})},a.handleHideSolving=function(){a.setState({showSolving:!1,showNewForm:!1,newResource:null,newReference:null,newRefReference:null})},a.state=a.hydrateState(),a}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidUpdate",value:function(e){if(this.props.modificationIndex!==e.modificationIndex){var t=this.hydrateState();this.setState(Object(h.a)({},t))}}},{key:"renderFixed",value:function(){var e=this.props,t=e.modificationItem,a=(e.foreignKeyField,t.field),n=t.fixedValues,l=t.fixedReferenceTable,i=t.unchangable,o=Object(m.values)(n).join("|"),c=o.length?o:"none",s=Object(m.difference)(U,a.split("|")).length<U.length;return r.a.createElement(p.Field,null,r.a.createElement(p.Label,{className:"has-text-success"},s?"Keep original value":"Fixed with value"),r.a.createElement("p",{className:"has-text-success"},c),r.a.createElement(p.Help,{isColor:"success"},!s&&r.a.createElement("li",null,"total ",t.errors.length," rows updated"),l&&l.map(function(e){return r.a.createElement("li",null,e.data.length,' row(s) added to "',e.resourceName,'" table')})),r.a.createElement("br",null),r.a.createElement(p.Button,{isColor:"info",isDisabled:i,onClick:this.handleClickCreate},"Change this fix"))}},{key:"renderSolving",value:function(){var e,t=this.props,a=t.modificationItem,n=t.foreignKeyField,l=t.referenceTables,i=a.field,o=(a.fixedReferenceTable,n.reference.resource),c=n.reference.fields,s={value:e=this.state.fixedValues[i],label:e};return r.a.createElement("div",null,"source"===a.field&&!this.state.showNewForm&&!this.state.newResource&&r.a.createElement(p.Field,null,r.a.createElement(p.Label,null,"Select from exist sources"),r.a.createElement(ye.a,{isSearchable:!0,isClearable:!0,value:s,onChange:this.handleSelectExist,options:l[o].map(function(e){return{value:e[c],label:e[c]}})}),this.state.fixedValues[i]&&r.a.createElement(p.Help,{isColor:"success"},r.a.createElement("li",null,'change "',a.value,'" to "',Object(m.values)(this.state.fixedValues).join("|"),'"'),r.a.createElement("li",null,"total ",a.errors.length," rows affected"))),r.a.createElement(p.Field,null,r.a.createElement(p.Control,null,r.a.createElement(p.Button,{isColor:"info",onClick:this.handleClickCreate},"Create new item"))))}},{key:"render",value:function(){var e=this,t=this.state,a=(t.newResource,t.fixedValues,this.props),n=a.modificationItem,l=a.foreignKeyField,i=a.descriptor,o=a.referenceTables,c=n.value,s=n.message,u=n.field,d=l.reference.resource,f=i.resources.find(function(e){return e.name===d}),h=function(e,t){return e.split("|").map(function(e,a){return{value:t.split("|")[a],field:e,referenceField:"string"===typeof l.reference.fields?l.reference.fields:l.reference.fields[a]}})}(u,c),E=function(e){switch(e){case"reporting":case"partner":case"currency|year|reporting":return"1/4";default:return"1/2"}}(n.field),b=u.split("|").length>0?Object(m.values)(e.state.fixedValues).filter(function(e){return!e}).length>0:!e.state.fixedValues[u];return r.a.createElement("div",{style:{height:"60vh"}},r.a.createElement("form",null,r.a.createElement(p.Columns,null,r.a.createElement(p.Column,{isSize:E},r.a.createElement(p.Field,null,r.a.createElement(p.Label,null,'Original value of "',u,'":'),r.a.createElement("div",{className:"has-text-danger"},c),r.a.createElement(p.Help,{isColor:"danger"},s)),!this.state.showSolving&&n.fixed&&this.renderFixed(),this.state.showSolving&&this.renderSolving()),this.state.showNewForm&&r.a.createElement(p.Column,{className:"new-resource-form",style:{flex:"auto"}},r.a.createElement(Fe,{originalValues:h,descriptor:i,resourceDescriptor:f,referenceTables:o,onCancel:this.handleCancel,onAddNew:this.handleAddNewResource})),this.state.newResource&&r.a.createElement(p.Column,null,r.a.createElement(je,{resource:this.state.newResource}),r.a.createElement(p.Button,{onClick:this.handleClickCreate},"Reset")),this.state.newReference&&r.a.createElement(p.Column,null,r.a.createElement(je,{resource:this.state.newReference})),this.state.newRefReference&&r.a.createElement(p.Column,null,r.a.createElement(je,{resource:this.state.newRefReference}))),this.state.showSolving&&r.a.createElement(p.Field,{isGrouped:!0},n.fixed&&r.a.createElement(p.Control,null,r.a.createElement(p.Button,{isColor:"info",onClick:this.handleHideSolving},"Cancel")),r.a.createElement(p.Control,null,r.a.createElement(p.Button,{isColor:"info",isDisabled:b,onClick:this.handleSubmitForm},"Confirm this fix")))))}}]),t}(r.a.Component),Ie=Object(o.b)(null,{validateResource:function(e){return function(t){var a=e.descriptor;t(Object(k.a)(F.a.mark(function e(){var n;return F.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=L.Resource.load(a),e.next=4,n.read();case 4:t({type:"VALIDATE_RESOURCE_SUCCESS",payload:{valid:!0}}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0),e.t0.multiple?t({type:"VALIDATE_RESOURCE_FAILURE",payload:{rowNumber:e.t0.rowNumber,messages:e.t0.errors.map(function(e){return Object(h.a)({},e,{message:e.message})})}}):t({type:"VALIDATE_RESOURCE_FAILURE",payload:{rowNumber:e.t0.rowNumber,messages:[Object(h.a)({},e.t0,{message:e.t0.message})]}});case 11:case"end":return e.stop()}},e,null,[[0,7]])})))}}})(ke),Ae=Object(o.b)(function(e){return{descriptor:e.schemaValidation.descriptor,referenceTables:e.referenceTables.referenceTables}})(function(e){e.className;var t=e.flows,a=e.referenceTables,n=e.descriptor,l=e.schema,i=e.modificationItem,o=e.modificationIndex,c=e.onSubmitModification,s=function(e){var t=e.fixedValues,a=e.fixedReferenceTable;return c(Object(h.a)({},i,{fixedValues:t,fixedReferenceTable:a,index:o}))};return r.a.createElement("div",null,"ERROR_FORMAT"===i.errorType&&r.a.createElement(Se,{fieldDescriptor:function(){var e=i.field;return l.fields.find(function(t){return t.name===e})}(),modificationItem:i,modificationIndex:o,onSubmitForm:s}),"ERROR_FOREIGN_KEY"===i.errorType&&r.a.createElement(Ie,{schema:l,descriptor:n,foreignKeyField:function(){var e;if(-1!==i.field.indexOf("|")){var t=i.field.split("|");e=l.foreignKeys.find(function(e){return Object(m.isEqual)(e.fields,t)})}else e=l.foreignKeys.find(function(e){return e.fields===i.field});return e}(),referenceTables:a,modificationItem:i,modificationIndex:o,onSubmitForm:s}),r.a.createElement(we,{flows:t,modificationItem:i}))}),Le=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.flows,n=t.schema,l=t.isModification,i=t.modificationIndex,o=t.modificationList,c=t.referenceTables,s=o.filter(function(e){return!1===e.fixed}),u=o[i],d=function(t){t<o.length&&e.props.selectError({index:t})};return r.a.createElement("div",null,!l&&r.a.createElement("div",null,o.length>0&&r.a.createElement("div",{className:"has-text-danger has-text-weight-bold"},o.length," different errors need to modify"),o&&r.a.createElement(ge,{modificationList:o,onSelectError:d}),r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement(p.Button,{isColor:"info",onClick:function(){return e.props.setStep({id:"1"})}},"Previous Step"),0===s.length?r.a.createElement(p.Button,{isColor:"info",onClick:function(){return e.props.setStep({id:"3"})}},"Ready to publish"):r.a.createElement(p.Button,{isColor:"info",onClick:function(){e.props.selectError({index:s[0].index})}},"Start fix error"))),l&&r.a.createElement("div",null,r.a.createElement(Ae,{flows:a,schema:n,modificationIndex:i,modificationItem:o[i],onSubmitModification:function(t){var r=t.index,l=t.errors,i=t.errorType,f=t.fixedReferenceTable;if("ERROR_FORMAT"!==i&&"source"!==t.field||e.props.updateFlows(t),"year"===t.field){var m=l.map(function(e){return e.rowNumber}),p=a[0].indexOf("year"),h=[a[0]].concat(l.map(function(e){var n=a[e.rowNumber-1];return n[p]=t.fixedValues.year,n})),E={currencies:c.currencies};e.props.revalidateRows({originalValue:t.value,fixedValues:t.fixedValues,rowNumbers:m,source:h,schema:n,relations:E})}if("ERROR_FOREIGN_KEY"===i){var b=u.fixedReferenceTable;b&&b.forEach(function(t){e.props.deleteTableRow(t)}),f.forEach(function(t){e.props.addTableRow(t)})}e.props.submitModification(t),r+1<o.length&&s.length>0?d(r+1):e.props.hideModification()}}),r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement("div",null,r.a.createElement(p.Button,{isColor:"info",onClick:this.props.hideModification},"Back to summary")),r.a.createElement("span",{className:"has-text-danger has-text-weight-bold"},i+1," / ",o.length),r.a.createElement("div",null,0!==i&&r.a.createElement(p.Button,{isColor:"info",style:{marginLeft:"10px"},onClick:function(){i>0&&e.props.goPrevError()}},"Prev Error"),i!==o.length-1&&r.a.createElement(p.Button,{isColor:"info",style:{marginLeft:"10px"},onClick:function(){i<o.length-1&&e.props.goNextError()}},"Next Error")))))}}]),t}(r.a.Component),Ve=Object(o.b)(function(e){return{flows:e.flows.data,referenceTables:e.referenceTables.referenceTables,schema:be(e),modificationList:e.modification.modificationList,isModification:e.ui.isModification,modificationIndex:e.modification.modificationIndex}},{setStep:S,updateFlows:function(e){return{type:"UPDATE_FLOWS",payload:e}},addTableRow:function(e){return{type:"ADD_TABLE_ROW",payload:e}},deleteTableRow:function(e){return{type:"DELETE_TABLE_ROW",payload:e}},revalidateRows:function(e){return function(t){var a=e.rowNumbers,n=e.originalValue,r=e.fixedValues,l=e.source,i=e.schema,o=e.relations;t({type:"REVALIDATE_ROWS_REQUEST",payload:Object(h.a)({},e,{status:"loading"})}),t(Object(k.a)(F.a.mark(function e(){var c;return F.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.Table.load(l,{schema:i});case 3:return c=e.sent,e.next=6,c.read({forceCast:!0,relations:o});case 6:e.sent.filter(function(e){return e.errors}).length?t({type:"REVALIDATE_ROWS_FAILURE",payload:{status:"done",valid:!1,rowNumbers:a,originalValue:n,fixedValues:r}}):t({type:"REVALIDATE_ROWS_SUCCESS",payload:{status:"done",valid:!0,rowNumbers:a,originalValue:n,fixedValues:r}}),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0),t({type:"REVALIDATE_ROWS_FAILURE",payload:{status:"done",valid:!1,error:e.t0}});case 15:case"end":return e.stop()}},e,null,[[0,11]])})))}},hideModification:function(){return{type:y}},selectError:function(e){return{type:C,payload:e}},goNextError:function(){return{type:"GO_NEXT_ERROR"}},goPrevError:function(){return{type:"GO_PREV_ERROR"}},submitModification:function(e){return{type:"SUBMIT_MODIFICATION",payload:e}}})(Le),De=a(65),Me=a.n(De),Be=a(369),Ue=a.n(Be);function He(e,t,a){var n,r=e[0];switch(a){case"csv":var l=Object(M.b)(e);n=new File([l],t,{type:"text/csv;charset=utf-8"}),Ue.a.saveAs(n);break;case"xlsx":default:var i=Me.a.utils.aoa_to_sheet(e,{header:r}),o=Me.a.utils.book_new();Me.a.utils.book_append_sheet(o,i,"SheetJS"),Me.a.writeFile(o,t)}}var Pe=function(e){var t=e.groupedFlows,a=e.updatedTables;return r.a.createElement(p.Columns,null,r.a.createElement(p.Column,null,r.a.createElement("strong",null,"fixed flows table by source"),Object.keys(t).map(function(e){return r.a.createElement("p",null,e,".csv")})),r.a.createElement(p.Column,null,r.a.createElement("div",null,r.a.createElement("strong",null,"updated reference tables"),a.map(function(e){return r.a.createElement("p",null,'"',e.name,'" table: ',e.updatedRows.length," row(s)")}))))},Ge=a(46),Ke=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleChangeUser=function(e){a.setState({username:e.target.value})},a.handleChangeToken=function(e){a.setState({token:e.target.value})},a.handleChangeMessage=function(e){a.setState({message:e.target.value})},a.handleSubmit=function(){a.props.onSubmitAuth(a.state)},a.state={username:"",token:"",message:""},a}return Object(f.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.isActive,a=e.isCommit,n=e.closeModal,l=!this.state.username||!this.state.token;return a&&(l=Object(m.values)(this.state).find(function(e){return!e})),r.a.createElement(Ge.Modal,{isActive:t},r.a.createElement(Ge.ModalBackground,{onClick:n}),r.a.createElement(Ge.ModalCard,null,r.a.createElement(Ge.ModalCardBody,null,r.a.createElement(p.Field,null,r.a.createElement(p.Label,null,"username*:"),r.a.createElement(p.Control,null,r.a.createElement(p.Input,{value:this.state.username,onChange:this.handleChangeUser}))),r.a.createElement(p.Field,null,r.a.createElement(p.Label,null,"personal access token*:"),r.a.createElement(p.Control,null,r.a.createElement(p.Input,{type:"password",value:this.state.token,onChange:this.handleChangeToken}))),a&&r.a.createElement(p.Field,null,r.a.createElement(p.Label,null,"commit message*:"),r.a.createElement(p.Control,null,r.a.createElement(p.Input,{value:this.state.message,onChange:this.handleChangeMessage}))),r.a.createElement(p.Field,null,l&&r.a.createElement(p.Help,{isColor:"danger"},"requied field is missing"),r.a.createElement(p.Button,{isDisabled:l,isColor:"info",onClick:this.handleSubmit},a?"Commit":"Login")))),r.a.createElement(Ge.ModalClose,{onClick:n}))}}]),t}(r.a.Component),We=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleOpenModal=function(){a.setState({isModalShow:!0})},a.handleCloseModal=function(){a.setState({isModalShow:!1})},a.state={isModalShow:!1},a}return Object(f.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e,t=this,a=this.props,n=a.flows,l=a.repoData,i=a.referenceTables,o=a.originalLength,c=l.selectedBranch,s=l.remoteUpdateStatus,u=l.remoteResponse,d=l.tables;u&&(e=u.map(function(e){return e.error?{requestSuccess:!1,statusText:e.error.response.statusText,url:e.error.config.url,message:e.error.response.data.message}:{requestSuccess:!0,url:e.config.url}}));var f=[];Object.keys(i).forEach(function(e){i[e].length!==o[e]&&f.push({name:e,updatedRows:i[e].slice(o[e])})});var h=Object(M.c)(n.data.map(function(e){return e.join(",")}).join("\n")),E=Object(m.groupBy)(h,function(e){return e.source});return r.a.createElement("div",null,r.a.createElement(Pe,{groupedFlows:E,updatedTables:f}),r.a.createElement(p.Field,{isGrouped:!0},r.a.createElement(p.Control,null,r.a.createElement(p.Button,{isColor:"info",onClick:function(){var e=n.file;He(n.data,e.name,"xlsx")}},"Export fixed flows table")),r.a.createElement(p.Control,{style:{}},r.a.createElement(p.Button,{isColor:"info",onClick:this.handleOpenModal},'Publish tables to "',c.name,'" branch'))),r.a.createElement(p.Field,null,"loading"===s&&r.a.createElement(p.Help,{isColor:"success"},"updating files on github..."),e&&e.map(function(e){return e.requestSuccess?r.a.createElement(p.Help,{isColor:"success"},e.url):r.a.createElement(p.Help,{isColor:"danger"},e.url," - ",e.statusText," - ",e.message)})),r.a.createElement(Ke,{isActive:this.state.isModalShow,isCommit:!0,closeModal:this.handleCloseModal,onSubmitAuth:function(e){t.handleCloseModal();var a=Object.keys(E).map(function(e){return{fileName:"".concat(e,".csv"),data:E[e]}}),n=f.map(function(e){return{fileName:"".concat(e.name,".csv"),data:i[e.name],sha:d[e.name].sha}});t.props.updateRemoteFiles({auth:e,files:a.concat(n),branch:c.name})}}))}}]),t}(r.a.Component),qe=Object(o.b)(function(e){return{flows:e.flows,referenceTables:e.referenceTables.referenceTables,originalLength:e.referenceTables.originalLength,repoData:e.repoData}},{exportFlows:function(e){return{type:"EXPORT_FLOWS"}},updateRemoteFiles:function(e){return function(t){t({type:Z,payload:e});var a=e.files,n=e.branch,r=e.auth,l=a.map(function(e){var t={message:r.message||"update data",content:D.Base64.encode(Object(M.a)(e.data)),sha:e.sha,branch:n};return Object(P.put)("".concat(B.a,"/data/").concat(e.fileName),t,{auth:{username:r.username,password:r.token}}).catch(function(e){return{error:e}})});Object(P.all)(l).then(function(e){console.log(e),t({type:$,payload:{responses:e}})}).catch(function(e){console.error(e),t({type:ee,error:e})})}}})(We),Qe=a(372),Ye="LOGIN_GITHUB_SUCCESS",ze="LOGIN_GITHUB_FAILURE",Je={isLogined:!1};var Xe=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleShowLogin=function(){a.props.fetchBranches(),a.setState({isModalShow:!0})},a.handleCloseModal=function(){a.setState({isModalShow:!1})},a.handleLogin=function(e){a.props.loginGithub(e),a.handleCloseModal()},a.handleCreateBranch=function(){var e=a.props,t=e.auth,n=e.repoData,r=n.branches,l=n.branchToCreated,i=r.find(function(e){return"master"===e.name});i&&a.props.createBranch({branch:l,auth:t,reference:{sha:i.commit.sha}})},a.state={isModalShow:!1},a}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.props.fetchDatapackage()}},{key:"renderFetchTable",value:function(){var e=this,t=this.props,a=t.repoData,n=(t.auth,a.selectedBranch),l=a.branchToCreated,i=a.tables,o=a.isBranchCreated;return r.a.createElement("div",null,l&&r.a.createElement("div",null,r.a.createElement(p.Help,{isColor:"danger"},"No previous working branch"),r.a.createElement(p.Button,{isColor:"info",onClick:this.handleCreateBranch},"Create a new branch")),o?r.a.createElement(p.Help,{isColor:"success"},'branch "',n.name,'" is created'):r.a.createElement(p.Help,{isColor:"danger"},'could not create branch "',l,'"'),n&&!i&&r.a.createElement(p.Button,{isColor:"info",onClick:function(){e.props.fetchAllTables({branch:n.name})}},"Fetch table from branch ",n.name),n&&(i?r.a.createElement(p.Help,{isColor:"success"},"tables from ",n.name," branch are loaded"):r.a.createElement(p.Help,{isColor:"danger"},"tables from ",n.name," branch are not loaded")))}},{key:"render",value:function(){var e=this.props,t=e.repoData,a=e.isLogined;t.branches,t.selectedBranch,t.tables;return r.a.createElement("div",null,r.a.createElement(p.Button,{isColor:"info",onClick:this.handleShowLogin},r.a.createElement("span",null,a?"Re-Login":"Login"," to get branch")),a?r.a.createElement(p.Help,{isColor:"success"},"you are logined"):r.a.createElement(p.Help,{isColor:"danger"},"you are  not logined"),a&&this.renderFetchTable(),r.a.createElement(Ke,{isActive:this.state.isModalShow,isCommit:!1,closeModal:this.handleCloseModal,onSubmitAuth:this.handleLogin}))}}]),t}(r.a.Component),Ze=Object(o.b)(function(e){return{repoData:e.repoData,isLogined:e.auth.isLogined,auth:e.auth.auth}},{loginGithub:function(e){return function(t,a){t({type:"LOGIN_GITHUB_REQUEST",payload:e});var n=e.username,r=e.token,l=n;return Object(P.get)(B.d,{auth:{username:n,password:r}}).then(function(a){t({type:Ye,payload:e}),t(ne({branch:l}))}).catch(function(e){console.error(e),t({type:ze})})}},fetchBranches:function(e){return function(t){return t({type:"FETCH_BRANCHES_REQUEST",payload:e}),Object(P.get)(B.b).then(function(a){return t({type:z,payload:Object(h.a)({},e,{branches:a.data})})}).catch(function(a){return t({type:"FETCH_BRANCHES_FAILURE",payload:e,error:a})})}},createBranch:function(e){return function(t){t({type:"CREATE_BRANCH_REQUEST"});var a=e.auth,n=e.branch,r=e.reference,l={ref:"refs/heads/".concat(n),sha:r.sha};return Object(P.post)(B.c,l,{auth:{username:a.username,password:a.token}}).then(function(e){return t({type:J,payload:{name:a.username,ref:e.data}})}).catch(function(e){return t({type:X,error:e})})}},selectBranch:ne,fetchAllTables:function(e){return function(t){var a=e.branch;t({type:"FETCH_TABLES_REQUEST"}),Promise.all(ae.map(function(e){return Object(P.get)("".concat(B.a,"/").concat(e.path,"?ref=").concat(a))})).then(function(e){var a={};e.forEach(function(e){var t=e.data.name.split(".")[0];a[t]=e.data}),t({type:Y,payload:a})}).catch(function(a){return t({type:"FETCH_TABLES_FAILURE",payload:e,error:a})})}},fetchDatapackage:function(){return function(e){return e({type:"FETCH_DATAPACKAGE_REQUEST"}),Object(P.get)("".concat(B.a,"/datapackage.json?ref=master")).then(function(t){return e({type:Q,payload:t.data})}).catch(function(t){return e({type:"FETCH_DATAPACKAGE_FAILURE",error:t})})}}})(Xe),$e=function(e){var t,a=e.headerNames,n=e.fieldNames,l=a.length-n.length;t=l>0?Object(m.difference)(a,n):Object(m.difference)(n,a);var i=a.map(function(e,t){return n[t]&&n[t]===e?{name:e,valid:!0}:{name:e,valid:!1}});return r.a.createElement("div",{style:{}},t.length===l&&l>0&&r.a.createElement("div",{className:"has-text-danger"},r.a.createElement("span",null,"Extra headers - "),t.map(function(e){return r.a.createElement("span",null,'"',e,'" ')})),t.length===Math.abs(l)&&l<0&&r.a.createElement("div",{className:"has-text-danger has-text-weight-bold"},r.a.createElement("span",null,"Missing headers - "),t.map(function(e){return r.a.createElement("span",null,'"',e,'" ')})),r.a.createElement("div",{style:{display:"flex",justifyContent:"space-evenly"}},r.a.createElement("div",null,r.a.createElement("div",{className:"has-text-weight-bold"},"headers "),i.map(function(e,t){return r.a.createElement("div",{key:t,className:e.valid?"has-text-black":"has-text-danger"},e.name)})),r.a.createElement("div",null,r.a.createElement("div",{className:"has-text-weight-bold"},"schema fields"),n.map(function(e,t){return r.a.createElement("div",{key:t},e)}))))};var et=Object(o.b)(function(e){return{schema:e.repoData.descriptor&&be(e),flows:e.flows,tables:e.repoData.tables,headerFeedback:e.schemaValidation.headerFeedback}},{importFlows:function(e){return{type:"IMPORT_FLOWS",payload:e}},setStep:S,validateHeader:function(e){return function(t){var a=e.source,n=e.schema;t({type:ce,payload:Object(h.a)({},e,{status:"loading"})}),t(Object(k.a)(F.a.mark(function e(){var r;return F.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.Table.load(a.slice(0,2),{schema:n});case 3:return r=e.sent,e.next=6,r.read({limit:1});case 6:t({type:se,payload:{status:"done",valid:!0,headers:r.headers}}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0),"ERROR_HEADER"!==e.t0.type?t({type:se,payload:{status:"done",valid:!0,headers:r.headers}}):t({type:ue,valid:!1,status:"done",payload:e.t0});case 13:case"end":return e.stop()}},e,null,[[0,9]])})))}}})(function(e){var t=e.schema,a=e.tables,n=e.flows,l=e.headerFeedback,i=e.setStep,o=e.importFlows,c=e.validateHeader;return r.a.createElement("div",null,r.a.createElement(Ze,null),a&&r.a.createElement(p.DropZone,{maxSize:1e7,onDrop:function(e){var a=Object(Qe.a)(e,1)[0];"xlsx"===a.name.split(".")[1]?function(e){return new Promise(function(t,a){var n=new FileReader;n.onload=function(e){var a=e.target.result,r=Me.a.read(a,{type:"binary"}),l=r.SheetNames[0],i=r.Sheets[l],o=Me.a.utils.sheet_to_json(i,{header:1,defval:"",blankrows:!1});t(o),n=void 0},n.onerror=function(e){a(e.target.error),n=void 0},n.readAsBinaryString(e)})}(a).then(function(e){o({file:{name:a.name},data:e}),c({source:e,schema:t})}).catch(function(e){console.error(e),console.error("fail to parse file")}):function(e){return new Promise(function(t,a){var n=new FileReader;return n.onload=function(a){var r;r="csv"===e.name.split(".")[1]?Object(M.d)(a.target.result):Object(M.e)(a.target.result),t(r),n=void 0},n.onerror=function(e){a(e.target.error),n=void 0},n.readAsText(e)})}(a).then(function(e){o({file:{name:a.name},data:e}),c({source:e,schema:t})}).catch(function(e){return console.error("fail to parse file")})},onDropRejected:function(e,t){console.log("file is invalid")},isSize:"small"},r.a.createElement("span",{className:"tech-info"},"Drag and drop .xlsx, .csv file here(maximum 10MB)")),l&&"loading"===l.status&&r.a.createElement("span",null,"Validating Headers"),l&&l.valid&&r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement("span",{className:"has-text-success has-text-weight-bold"},'Headers of "',n.file.name,'" are valid'),r.a.createElement(p.Button,{isColor:"info",onClick:function(){return i({id:"1"})}},"Next Step")),l&&!l.valid&&"ERROR_HEADER"===l.type&&r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("span",{className:"has-text-danger has-text-weight-bold"},'Headers of "',n.file.name,'" do not match schema fields, please fix your file and re-upload'),r.a.createElement($e,{headerNames:l.headerNames,fieldNames:l.fieldNames})))}),tt=function(e){e.flows,e.referenceTables;var t=e.onSelectDiscard,a=e.onSelectDownload,n=e.isActive,l=e.closeModal;return r.a.createElement("div",null,r.a.createElement(p.Modal,{isActive:n},r.a.createElement(p.ModalBackground,{onClick:l}),r.a.createElement(p.ModalContent,null,r.a.createElement(p.Card,{bodyContent:"Leave this step, you might lost your modification?",onAction:function(e,n){switch(e){case"cacnel":default:l();break;case"download":a();break;case"discard":t()}},footerActions:[{label:"Download",id:"download",isColor:"success"},{label:"Discard",id:"discard",isColor:"danger"},{label:"Cancel",id:"cancel",isColor:"info"}]})),r.a.createElement(p.ModalClose,{onClick:l})))},at=function(e){var t=e.className,a=e.collectedErrors,n=["Field","Error Type","Error Overview"],l=Object(m.sortBy)(a,function(e){return H[e.name]});return r.a.createElement("div",{style:{position:"relative",width:"100%",height:"70vh"}},r.a.createElement("div",{className:"action-table ".concat(t)},r.a.createElement("div",{className:"action-table-header"},n.map(function(e,t){return r.a.createElement("div",{key:t,className:"table-cell"},e)})),r.a.createElement("div",{className:"action-table-main"},l.map(function(e,t){var a=e.errors.length,l=Object(m.groupBy)(e.errors,function(e){return e.value}),i=Object.keys(l).length;return r.a.createElement("div",{key:t,className:"table-row"},n.map(function(t,n){var l;return l=0===n?e.name:1===n?e.errorType:"".concat(i," different invalid values, ").concat(a," rows affected in total"),r.a.createElement("div",{key:n,className:"table-cell"},l)}))}))))},nt=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.flows,a=e.schema,n=e.relations;e.schemaFeedback||this.props.validateTable({source:t,schema:a,relations:n})}},{key:"render",value:function(){var e=this,t=this.props,a=t.schemaFeedback,n=t.modificationList,l=!1;a&&a.collectedErrors&&(l=a.collectedErrors.reporting&&"ERROR_FORMAT"===a.collectedErrors.reporting.errorType||a.collectedErrors.partner&&"ERROR_FORMAT"===a.collectedErrors.partner.errorType);return r.a.createElement("div",null,a&&"loading"===a.status&&r.a.createElement("span",null,a.loader),a&&!a.valid&&a.collectedErrors&&r.a.createElement("div",null,r.a.createElement("span",{className:"has-text-danger has-text-weight-bold"},"Found errors in ",a.errors.length," rows of ",Object.keys(a.collectedErrors).length," fields",l&&r.a.createElement("span",null,", value of required field is missing, please fix it locally first")),r.a.createElement(at,{collectedErrors:a.collectedErrors}),r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement(p.Button,{isColor:"info",onClick:function(){return e.props.setStep({id:"0"})}},"Previous Step"),r.a.createElement(p.Button,{isColor:"info",isDisabled:l,onClick:function(){if(!n){var t=function(e){var t=Object(m.values)(e).reduce(function(e,t){return e.concat(t.errors)},[]),a=Object(m.values)(Object(m.groupBy)(t,function(e){return e.field+e.value})).map(function(e,t){return{index:t,field:e[0].field,errorType:e[0].errorType,fixed:!1,message:e[0].message.replace(Ee,"".concat(e.length," rows")),originalValue:e[0].value,value:e[0].value,errors:e}});return Object(m.sortBy)(a,function(e){return H[e.name]})}(a.collectedErrors);e.props.startModification(t)}e.props.setStep({id:"2"})}},"Review Errors"))),a&&a.valid&&r.a.createElement("span",{className:"has-text-success has-text-weight-bold"},"Flows data is valid"))}}]),t}(r.a.Component),rt=Object(o.b)(function(e){return{flows:e.flows.data,schema:be(e),relations:ve(e),schemaFeedback:e.schemaValidation.schemaFeedback,modificationList:e.modification.modificationList}},{validateTable:function(e){return function(t){var a=e.source,n=e.schema,r=e.relations;t(Object(k.a)(F.a.mark(function e(){return F.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.delegateYield(F.a.mark(function e(){var l,i,o,c,s;return F.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:l=a.length,i=100,o=0,c=[],s=F.a.mark(function e(){var l,s,u,d,f;return F.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:le,payload:{status:"loading",loader:"validating ".concat(o," rows")}}),l=o/i,s=[a[0]].concat(a.slice(o+1-l,o+i-l)),e.next=5,V.Table.load(s,{schema:n});case 5:return u=e.sent,e.next=8,u.read({forceCast:!0,relations:r});case 8:d=e.sent,(f=d.filter(function(e){return e.errors})).length&&(f.forEach(function(e){e.rowNumber=e.rowNumber+i*l-l}),c=c.concat(f));case 11:case"end":return e.stop()}},e)});case 6:if(!(o<l)){e.next=11;break}return e.delegateYield(s(),"t0",8);case 8:o+=i,e.next=6;break;case 11:c.length?t({type:oe,payload:{status:"done",valid:!1,errors:c,collectedErrors:fe(a,n,c)}}):t({type:ie,payload:{status:"done",valid:!0}});case 12:case"end":return e.stop()}},e)})(),"t0",2);case 2:e.next=8;break;case 4:e.prev=4,e.t1=e.catch(0),console.error(e.t1),t({type:oe,payload:e.t1});case 8:case"end":return e.stop()}},e,null,[[0,4]])})))}},setStep:S,startModification:function(e){return{type:b,payload:e}}})(nt),lt=function(e){var t=e.steps,a=e.selectedStep,n=e.onSetStep,l=e.children;return r.a.createElement(p.LayoutWrapper,{hasConfig:!0},r.a.createElement(p.LayoutHeader,null,r.a.createElement(p.AppTitle,null,"Ricardo Data App"),r.a.createElement(p.RunningTitle,null,a.title)),r.a.createElement(p.LayoutContainer,null,r.a.createElement(p.LayoutContent,null,r.a.createElement(p.LayoutContentColumn,{isConfig:!0},t.map(function(e,t){var l=a.id===e.id,i=e.id>a.id;return r.a.createElement(p.ButtonContainer,{key:t},r.a.createElement(p.Button,{isColor:l?"info":null,isDisabled:i,onClick:function(){return n(e)}},e.name))})),r.a.createElement(p.LayoutContentColumn,{isWorkspace:!0},l)),r.a.createElement(p.LayoutFooter,null,r.a.createElement(p.LayoutFooterColumn,{isSecondary:!0},r.a.createElement("h3",null,"m\xe9dialab SciencesPo")),r.a.createElement(p.LayoutFooterColumn,{isPrimary:!0},"Ricardo Data App"))))},it=(a(965),a(966),Object(o.b)(function(e){return{steps:e.ui.steps,isModalDisplay:e.ui.isModalDisplay,flows:e.flows,referenceTables:e.referenceTables,selectedStep:e.ui.selectedStep,modificationList:e.modification.modificationList,repoData:e.repoData}},{initTables:function(){return{type:K}},showModal:function(){return{type:R}},hideModal:function(){return{type:O}},setStep:S})(function(e){var t=e.steps,a=e.isModalDisplay,n=e.selectedStep,l=(e.repoData,e.flows),i=e.referenceTables,o=e.modificationList,c=e.initTables,s=e.setStep,u=e.showModal,d=e.hideModal;return r.a.createElement("div",{className:"App"},r.a.createElement(lt,{steps:t,selectedStep:n,onSetStep:function(e){var t;o&&(t=o.filter(function(e){return e.fixed})),t&&"0"===e.id?u():s(e)}},function(){switch(n.id){case"0":default:return r.a.createElement(et,null);case"1":return r.a.createElement(rt,null);case"2":return r.a.createElement(Ve,null);case"3":return r.a.createElement(qe,null)}}()),r.a.createElement(tt,{referenceTables:i,isActive:a,onSelectDiscard:function(){c(),s(t[0])},onSelectDownload:function(){var e=l.file;He(l.data,e.name,"xlsx")},closeModal:d}))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ot=a(26),ct=a(201),st=a(370),ut=a(139),dt=Object(ot.combineReducers)({ui:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1?arguments[1]:void 0,a=t.payload;switch(t.type){case w:return Object(h.a)({},j,{selectedStep:x.find(function(e){return a.id===e.id})});case R:return Object(h.a)({},e,{isModalDisplay:!0});case O:return Object(h.a)({},e,{isModalDisplay:!1});case b:return Object(h.a)({},e,{isModification:!0});case y:return Object(h.a)({},e,{isModification:!1});case C:return Object(h.a)({},e,{isModification:!0});default:return e}},auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Je,t=arguments.length>1?arguments[1]:void 0,a=t.payload;switch(t.type){case Ye:return Object(h.a)({},e,{isLogined:!0,auth:a});case ze:return Object(h.a)({},e,{isLogined:!1,auth:null});default:return e}},flows:T,referenceTables:q,schemaValidation:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:me,t=arguments.length>1?arguments[1]:void 0,a=t.payload;switch(t.type){case w:return"0"===a.id?Object(h.a)({},e,{schemaFeedback:null,headerFeedback:null}):e;case Q:return Object(h.a)({},e,{descriptor:JSON.parse(D.Base64.decode(a.content))});case ce:case ue:case se:return Object(h.a)({},e,{headerFeedback:a});case le:case oe:case ie:return Object(h.a)({},e,{schemaFeedback:a});default:return e}},modification:g,repoData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re,t=arguments.length>1?arguments[1]:void 0,a=t.payload;switch(t.type){case K:return Object(h.a)({},e,{tables:null,remoteUpdateStatus:null,remoteResponse:null});case Y:return Object(h.a)({},e,{tables:a});case Q:return Object(h.a)({},e,{datapackage:a,descriptor:JSON.parse(D.Base64.decode(a.content))});case z:return Object(h.a)({},e,{branches:a.branches});case J:return Object(h.a)({},e,{selectedBranch:a,isBranchCreated:!0,branchToCreated:null});case X:return Object(h.a)({},e,{selectedBranch:null,isBranchCreated:!1});case te:var n=e.branches.find(function(e){return e.name===a.branch});return n?Object(h.a)({},e,{selectedBranch:n,isBranchCreated:!0,tables:null}):Object(h.a)({},e,{branchToCreated:a.branch,isBranchCreated:!1,selectedBranch:null,tables:null});case Z:return Object(h.a)({},e,{remoteUpdateStatus:"loading"});case $:var r=a.responses;return Object(h.a)({},e,{remoteUpdateStatus:"updated",remoteResponse:r});case ee:return Object(h.a)({},e,{remoteUpdateStatus:"fail"});default:return e}}}),ft={key:"root",storage:st},mt=Object(ct.a)(ft,dt);var pt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[ut.a],a=ot.compose.apply(void 0,[ot.applyMiddleware.apply(void 0,t)].concat([])),n=Object(ot.createStore)(mt,e,a);return{store:n,persistor:Object(ct.b)(n)}}({}).store;i.a.render(r.a.createElement(o.a,{store:pt},r.a.createElement(it,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[374,1,2]]]);
//# sourceMappingURL=main.f876292c.chunk.js.map