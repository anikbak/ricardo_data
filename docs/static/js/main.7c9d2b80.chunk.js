(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{356:function(e,t){},366:function(e,t,a){e.exports=a(959)},377:function(e,t,a){},631:function(e,t){},633:function(e,t){},675:function(e,t,a){var n={"./geojson.json":260,"./table-schema.json":676,"./topojson.json":261};function r(e){var t=i(e);return a(t)}function i(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=i,e.exports=r,r.id=675},755:function(e,t){},756:function(e,t){},78:function(e){e.exports={b:"https://raw.githubusercontent.com/medialab/ricardo_data/master",a:"https://api.github.com/repos/medialab/ricardo_data/contents"}},864:function(e,t,a){var n={"./geojson.json":344,"./table-schema.json":865,"./topojson.json":345};function r(e){var t=i(e);return a(t)}function i(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=i,e.exports=r,r.id=864},903:function(e,t,a){var n={"./data-package.json":904,"./data-resource.json":905,"./fiscal-data-package.json":906,"./registry.json":907,"./tabular-data-package.json":908,"./tabular-data-resource.json":909};function r(e){var t=i(e);return a(t)}function i(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=i,e.exports=r,r.id=903},955:function(e,t){},956:function(e,t){},958:function(e,t,a){},959:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(94),o=a.n(i),c=a(26),l=(a(377),a(35)),s=a(36),u=a(38),d=a(37),m=a(39),f=a(8),p=a(134),h=a(78),E=a(96),v="FETCH_DATAPACKAGE_SUCCESS",b="FETCH_TABLES_SUCCESS",y=[{name:"sources",path:"data/sources.csv"},{name:"currencies",path:"data/currencies.csv"},{name:"entity_names",path:"data/entity_names.csv"},{name:"expimp_spegen",path:"data/expimp_spegen.csv"}],g={};var O=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.repoData;e.tables||e.datapackage||(this.props.fetchDatapackage(),this.props.fetchAllTables({branch:"master"}))}},{key:"render",value:function(){var e=this.props.repoData;return r.a.createElement("div",null,!e.tables&&r.a.createElement("span",null,"loading tables"),!e.datapackage&&r.a.createElement("span",null,"loading datapackage"))}}]),t}(r.a.Component),x=Object(c.b)(function(e){return{repoData:e.repoData}},{fetchAllTables:function(e){return function(t){var a=e.branch;t({type:"FETCH_TABLES_REQUEST"}),Promise.all(y.map(function(e){return Object(p.get)("".concat(h.a,"/").concat(e.path,"?ref=").concat(a))})).then(function(e){var a={};e.forEach(function(e){var t=e.data.name.split(".")[0];a[t]=e.data}),t({type:b,payload:a})}).catch(function(a){return t({type:"FETCH_TABLES_FAILURE",payload:e,error:a})})}},fetchDatapackage:function(){return function(e){return e({type:"FETCH_DATAPACKAGE_REQUEST"}),Object(p.get)("".concat(h.a,"/datapackage.json?ref=master")).then(function(t){return e({type:v,payload:t.data})}).catch(function(t){return e({type:"FETCH_DATAPACKAGE_FAILURE",error:t})})}}})(O),j=a(1),w=a(132),S="START_MODIFICATION",k={modificationList:null},C=Object(w.a)(k,{SET_STEP:function(e,t){if("0"===t.payload.id)return k},START_MODIFICATION:function(e,t){var a=t.payload;e.modificationList=a},SUBMIT_MODIFICATION:function(e,t){var a=t.payload;e.modificationList[a.index]=Object(f.a)({},e.modificationList[a.index],{fixed:!0,fixedValue:a.fixedValue})}}),N="SET_STEP",_="HIDE_MODIFICATION",F="GO_NEXT_ERROR",R="GO_PREV_ERROR",T="SELECT_ERROR",I=function(e){return{type:N,payload:e}},A=[{id:"0",name:"Upload file",title:"Choose a file"},{id:"1",name:"Schema Validation",title:"Schema validation against datapackage"},{id:"2",name:"Error Fixing",title:"Fix errors by fields"},{id:"3",name:"Export/Publish Data",title:"Export or Publish your data to Github"}],D={steps:A,selectedStep:A[0],isModification:!1,modificationIndex:0,fixedIndex:[]};var L={},V=Object(w.a)(L,{SET_STEP:function(e,t){if("0"===t.payload.id)return L},IMPORT_FLOWS:function(e,t){return t.payload},UPDATE_FLOWS:function(e,t){var a=t.payload,n=a.errors,r=a.field,i=a.fixedValue,o=e.data[0].indexOf(r);n.forEach(function(t){e.data[t.rowNumber-1][o]=i})}}),M=a(27),B=function(e){var t=e.className,a=e.modificationList,n=e.onSelectError,i=["","Field","Value","Rows",""];return r.a.createElement("div",{style:{position:"relative",width:"100%",height:"70vh"}},r.a.createElement("div",{className:"action-table ".concat(t)},r.a.createElement("div",{className:"action-table-header"},i.map(function(e,t){return r.a.createElement("div",{key:t,className:"table-cell"},r.a.createElement("span",{className:"Value"===e?"has-text-danger":"has-text-black"},e))})),r.a.createElement("div",{className:"action-table-main"},a.map(function(e,t){var a=e.field,o=e.errors,c=e.value,l=e.message,s=function(){n(t)};return r.a.createElement("div",{key:t,className:"table-row"},i.map(function(n,i){switch(i){case 0:default:return r.a.createElement("div",{key:i,className:"table-cell"},t+1);case 1:return r.a.createElement("div",{key:i,className:"table-cell"},a);case 2:return r.a.createElement("div",{key:i,className:"table-cell"},r.a.createElement("span",{className:"has-text-danger"},Object(M.isNull)(c)?"null":c),r.a.createElement(j.HelpPin,null,l));case 3:return r.a.createElement("div",{key:i,className:"table-cell"},r.a.createElement("span",{className:e.fixed?"has-text-success":"has-text-black"},o.length," ",e.fixed&&"rows affected"));case 4:return r.a.createElement("div",{key:i,className:"table-cell"},r.a.createElement(j.Button,{isOutlined:!0,isColor:e.fixed?"success":"info",onClick:s},e.fixed?"fixed":"fix error"))}}))}))))},P=function(e){var t=e.className,a=e.flows,n=e.modificationItem,i=a[0],o=n.errors,c=n.field;return r.a.createElement("div",{style:{position:"relative",width:"100%",height:"20vh"}},r.a.createElement("div",{className:"action-table ".concat(t)},r.a.createElement("div",{className:"action-table-header"},i.map(function(e,t){var a=-1!==c.indexOf(e);return r.a.createElement("div",{key:t,className:"table-cell"},r.a.createElement("span",{className:a?"has-text-danger":"has-text-black"},e))})),r.a.createElement("div",{className:"action-table-main"},o.map(function(e,t){return r.a.createElement("div",{key:t,className:"table-row"},i.map(function(t,n){var i=-1!==c.indexOf(t);return r.a.createElement("div",{key:n,className:"table-cell",style:{wordBreak:"break-all"}},r.a.createElement("span",{className:i?"has-text-danger":"has-text-black"},a[e.rowNumber-1][n]))}))}))))},U=a(77),H=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).hydrateState=function(){var e=a.props,t=e.modificationItem,n=e.descriptor,r=new U.Field(n),i="";return t.fixedValue?i=t.fixedValue:r.constraints&&r.constraints.enum&&(i=r.constraints.enum[0]),{fieldSchema:r,fixedValue:i,fieldError:null}},a.validateField=function(e){var t=a.state.fieldSchema;try{var n=t.castValue(e);a.setState({fixedValue:n,fieldError:null})}catch(r){a.setState({fieldError:r})}},a.handleChange=function(e){a.setState({fixedValue:e.target.value}),a.validateField(e.target.value)},a.handleSubmitForm=function(){var e=a.state,t=e.fixedValue,n=e.fieldError;t&&0!==t.length&&!n&&a.props.onSubmitForm(t)},a.state=a.hydrateState(),a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidUpdate",value:function(e){if(this.props.modificationIndex!==e.modificationIndex){var t=this.hydrateState();this.setState(Object(f.a)({},t))}}},{key:"render",value:function(){var e=this.props.modificationItem,t=e.value,a=e.message,n=e.errors,i=this.state,o=i.fieldSchema,c=i.fixedValue,l=i.fieldError,s=!c||0===c.length||l;return r.a.createElement("div",{style:{height:"60vh"}},r.a.createElement("form",null,r.a.createElement(j.Columns,null,r.a.createElement(j.Column,{isSize:"1/2"},r.a.createElement(j.Field,null,r.a.createElement(j.Label,null,'Original value of "',o.name,'":'),r.a.createElement("div",{className:"has-text-danger"},t),r.a.createElement(j.Help,{isColor:"danger"},a)),(!o.constraints||!o.constraints.enum)&&r.a.createElement(j.Field,null,r.a.createElement(j.Label,null,'Input a new value of "',o.name,'"'),r.a.createElement(j.Control,null,r.a.createElement(j.Input,{value:this.state.fixedValue,onChange:this.handleChange})),l&&r.a.createElement(j.Help,{isColor:"danger"},l.message),!s&&r.a.createElement(j.Help,{isColor:"success"},"change ",t," to ",this.state.fixedValue,", total ",n.length," rows affected")),o.constraints&&o.constraints.enum&&r.a.createElement(j.Field,null,r.a.createElement(j.Label,null,'Select a value of "',o.name,'" from:'),r.a.createElement(j.Control,null,r.a.createElement(j.Select,{value:this.state.fixedValue,onChange:this.handleChange},o.constraints.enum.map(function(e,t){return r.a.createElement("option",{key:t},e)})),!s&&r.a.createElement(j.Help,{isColor:"success"},"change ",t," to ",this.state.fixedValue,", total ",n.length," rows affected"))),r.a.createElement(j.Field,null,r.a.createElement(j.Control,null,r.a.createElement(j.Button,{isColor:"info",isDisabled:s,onClick:this.handleSubmitForm},"Confirm this fix")))))))}}]),t}(r.a.Component),G=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).hydrateState=function(){var e=a.props,t=e.modificationItem;e.schema,t.field;return{}},a.handleChange=function(e){a.setState({fixedValue:e.target.value}),a.validateField(e.target.value)},a.handleSubmitForm=function(){var e=a.state,t=e.fixedValue,n=e.fieldError;t&&0!==t.length&&!n&&a.props.onSubmitForm(t)},a.state=a.hydrateState(),a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidUpdate",value:function(e){if(this.props.modificationIndex!==e.modificationIndex){var t=this.hydrateState();this.setState(Object(f.a)({},t))}}},{key:"render",value:function(){var e=this.props,t=e.modificationItem,a=(e.schema,t.value),n=t.message,i=t.errors,o=t.field,c=this.state,l=(c.fieldSchema,c.fixedValue),s=c.fieldError,u=!l||0===l.length||s;return r.a.createElement("div",{style:{height:"60vh"}},r.a.createElement("form",null,r.a.createElement(j.Columns,null,r.a.createElement(j.Column,{isSize:"1/2"},r.a.createElement(j.Field,null,r.a.createElement(j.Label,null,'Original value of "',o,'":'),r.a.createElement("div",{className:"has-text-danger"},a),r.a.createElement(j.Help,{isColor:"danger"},n)),r.a.createElement(j.Field,null,r.a.createElement(j.Control,null,r.a.createElement(j.Button,{isColor:"info",isDisabled:u,onClick:this.handleSubmitForm},"Confirm this fix")))))),!u&&r.a.createElement("span",null,"change ",a," to ",this.state.fixedValue,", total ",i.length," rows affected"))}}]),t}(r.a.Component),K=function(e){e.className;var t=e.flows,a=e.schema,n=e.modificationItem,i=e.modificationIndex,o=e.onSubmitModification,c=function(e){return o(Object(f.a)({},n,{fixedValue:e,index:i}))},l=function(){var e=n.field;return a.fields.find(function(t){return t.name===e})};return r.a.createElement("div",null,r.a.createElement("div",null,"ERROR_FORMAT"===n.errorType&&r.a.createElement(H,{descriptor:l(),modificationItem:n,modificationIndex:i,onSubmitForm:c}),"ERROR_FOREIGN_KEY"===n.errorType&&r.a.createElement(G,{descriptor:l(),modificationItem:n,modificationIndex:i,onSubmitForm:c}),r.a.createElement(P,{flows:t,modificationItem:n})))},W=a(95),Y=a(10),J=a.n(Y),z=a(135),Q=(a(727),a(361),a(61)),X={id:0,flow:1,unit:2,species_bullions:3,transport_type:4,statistical_period:5,partner_sum:6,world_trade_type:7,notes:8,source:9,reporting:10,partner:11,"export_import|special_general":12,"currency|year|reporting":13},Z="VALIDATE_TABLE_REQUEST",$="VALIDATE_TABLE_SUCCESS",q="VALIDATE_TABLE_FAILURE",ee="VALIDATE_HEADER_REQUEST",te="VALIDATE_HEADER_SUCCESS",ae="VALIDATE_HEADER_FAILURE",ne=function(e){return"string"===typeof e?e:e.join("|")},re=function(e,t,a){var n=t.fields,r=t.foreignKeys,i=n.map(function(e){return e.name}),o=function(e){return e.reduce(function(e,t){return"string"===typeof t?e.concat([t]):e.concat(t)},[])}(r.map(function(e){return e.fields})),c=n.filter(function(e){return-1===o.indexOf(e.name)}),l=r.map(function(e){return ne(e.fields)}),s=["ERROR_FORMAT","ERROR_FOREIGN_KEY"],u=c.reduce(function(e,t){return Object(f.a)({},e,Object(W.a)({},t.name,{name:t.name,schema:t,errorType:"ERROR_FORMAT",errors:[]}))},{}),d=r.reduce(function(e,t){var a=ne(t.fields);return Object(f.a)({},e,Object(W.a)({},a,Object(f.a)({name:a},t,{errorType:"ERROR_FOREIGN_KEY",errors:[]})))},{});return a.forEach(function(t){var a=e[t.rowNumber-1],n=t.rowNumber;s.forEach(function(e){var r=t.errors.find(function(t){return t.type===e});r&&("ERROR_FORMAT"===e?i.forEach(function(t,i){r.errors.forEach(function(r){if(r.columnNumber===i+1&&-1===o.indexOf(t)){var c={rowNumber:n,errorType:e,columnNumber:r.columnNumber,field:t,value:a[i],message:r.message};u[t].errors.push(c)}})}):"ERROR_FOREIGN_KEY"===e&&l.forEach(function(t){r.errors.forEach(function(r){var o=ne(r.columnName);if(o===t){var c=r.columnName.map(function(e){var t=i.indexOf(e);return a[t]}),l={rowNumber:n,errorType:e,columnName:r.columnName,field:o,value:c.join("|"),message:r.message};d[t].errors.push(l)}})}))})}),Object.keys(u).forEach(function(e){u[e].errors.length||delete u[e]}),Object.keys(d).forEach(function(e){d[e].errors.length||delete d[e]}),Object(f.a)({},u,d)},ie={tableValidated:"flows",schemaFeedback:null,headerFeedback:null,tables:null};var oe=function(e){var t=e.schemaValidation.tableValidated;return e.schemaValidation.descriptor.resources.find(function(e){return e.name===t}).schema},ce=function(e){var t=le(e),a={};return t.forEach(function(t){var n=t.reference.resource;a[n]=e.schemaValidation.tables[n]}),a},le=function(e){var t=e.schemaValidation.tableValidated;return e.schemaValidation.descriptor.resources.find(function(e){return e.name===t}).schema.foreignKeys},se=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.flows,n=t.schema,i=t.isModification,o=t.modificationIndex,c=t.modificationList,l=c.filter(function(e){return!1===e.fixed}),s=function(t){t<c.length&&e.props.selectError({index:t})};return r.a.createElement("div",null,!i&&r.a.createElement("div",null,c.length>0&&r.a.createElement("div",{className:"has-text-danger has-text-weight-bold"},c.length," different errors need to modify"),c&&r.a.createElement(B,{modificationList:c,onSelectError:s}),r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement(j.Button,{isColor:"info",onClick:function(){return e.props.setStep({id:"1"})}},"Previous Step"),0===l.length?r.a.createElement(j.Button,{isColor:"info",onClick:function(){return e.props.setStep({id:"3"})}},"Ready to publish"):r.a.createElement(j.Button,{isColor:"info",onClick:function(){e.props.selectError({index:l[0].index})}},"Start fix error"))),i&&r.a.createElement("div",null,r.a.createElement(K,{flows:a,schema:n,modificationIndex:o,modificationItem:c[o],onSubmitModification:function(t){var a=t.index;e.props.submitModification(t),e.props.updateFlows(t),a+1<c.length&&l.length>0?s(a+1):e.props.hideModification()}}),r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement("div",null,r.a.createElement(j.Button,{isColor:"info",onClick:this.props.hideModification},"Back to summary")),r.a.createElement("span",{className:"has-text-danger has-text-weight-bold"},o+1," / ",c.length),r.a.createElement("div",null,0!==o&&r.a.createElement(j.Button,{isColor:"info",style:{marginLeft:"10px"},onClick:function(){o>0&&e.props.goPrevError()}},"Prev Error"),o!==c.length-1&&r.a.createElement(j.Button,{isColor:"info",style:{marginLeft:"10px"},onClick:function(){o<c.length-1&&e.props.goNextError()}},"Next Error")))))}}]),t}(r.a.Component),ue=Object(c.b)(function(e){return{flows:e.flows.data,schema:e.schemaValidation.descriptor&&oe(e),schemaFeedback:e.schemaValidation.schemaFeedback,modificationList:e.modification.modificationList,isModification:e.ui.isModification,modificationIndex:e.ui.modificationIndex}},{setStep:I,updateFlows:function(e){return{type:"UPDATE_FLOWS",payload:e}},hideModification:function(){return{type:_}},selectError:function(e){return{type:T,payload:e}},goNextError:function(){return{type:F}},goPrevError:function(){return{type:R}},submitModification:function(e){return{type:"SUBMIT_MODIFICATION",payload:e}}})(se),de=a(55),me=a.n(de),fe=a(362),pe=a.n(fe);var he=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(j.Button,{onClick:function(){var t=e.props.flows,a=t.file;!function(e,t,a){var n,r=e[0];switch(a){case"csv":var i=Object(Q.a)(e);n=new File([i],t,{type:"text/csv;charset=utf-8"}),pe.a.saveAs(n);break;case"xlsx":default:var o=me.a.utils.aoa_to_sheet(e,{header:r}),c=me.a.utils.book_new();me.a.utils.book_append_sheet(c,o,"SheetJS"),me.a.writeFile(c,t)}}(t.data,a.name,"xlsx")}},"Export fixed data"))}}]),t}(r.a.Component),Ee=Object(c.b)(function(e){return{flows:e.flows}},{exportFlows:function(e){return{type:"EXPORT_FLOWS"}}})(he),ve=a(364),be=function(e){var t,a=e.headerNames,n=e.fieldNames,i=a.length-n.length;t=i>0?Object(M.difference)(a,n):Object(M.difference)(n,a);var o=a.map(function(e,t){return n[t]&&n[t]===e?{name:e,valid:!0}:{name:e,valid:!1}});return r.a.createElement("div",{style:{}},t.length===i&&i>0&&r.a.createElement("div",{className:"has-text-danger"},r.a.createElement("span",null,"Extra headers - "),t.map(function(e){return r.a.createElement("span",null,'"',e,'" ')})),t.length===Math.abs(i)&&i<0&&r.a.createElement("div",{className:"has-text-danger has-text-weight-bold"},r.a.createElement("span",null,"Missing headers - "),t.map(function(e){return r.a.createElement("span",null,'"',e,'" ')})),r.a.createElement("div",{style:{display:"flex",justifyContent:"space-evenly"}},r.a.createElement("div",null,r.a.createElement("div",{className:"has-text-weight-bold"},"headers "),o.map(function(e,t){return r.a.createElement("div",{key:t,className:e.valid?"has-text-black":"has-text-danger"},e.name)})),r.a.createElement("div",null,r.a.createElement("div",{className:"has-text-weight-bold"},"schema fields"),n.map(function(e,t){return r.a.createElement("div",{key:t},e)}))))};var ye=Object(c.b)(function(e){return{schema:e.schemaValidation.descriptor&&oe(e),flows:e.flows,headerFeedback:e.schemaValidation.headerFeedback}},{importFlows:function(e){return{type:"IMPORT_FLOWS",payload:e}},setStep:I,validateHeader:function(e){return function(t){var a=e.source,n=e.schema;t({type:ee,payload:Object(f.a)({},e,{status:"loading"})}),t(Object(z.a)(J.a.mark(function e(){var r;return J.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,U.Table.load(a.slice(0,2),{schema:n});case 3:return r=e.sent,e.next=6,r.read({limit:1});case 6:t({type:te,payload:{status:"done",valid:!0,headers:r.headers}}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0),"ERROR_HEADER"!==e.t0.type?t({type:te,payload:{status:"done",valid:!0,headers:r.headers}}):t({type:ae,valid:!1,status:"done",payload:e.t0});case 13:case"end":return e.stop()}},e,null,[[0,9]])})))}}})(function(e){var t=e.schema,a=e.flows,n=e.headerFeedback,i=e.setStep,o=e.importFlows,c=e.validateHeader;return r.a.createElement("div",null,r.a.createElement(j.DropZone,{maxSize:1e7,onDrop:function(e){var a=Object(ve.a)(e,1)[0];"xlsx"===a.name.split(".")[1]?function(e){return new Promise(function(t,a){var n=new FileReader;n.onload=function(e){var a=e.target.result,r=me.a.read(a,{type:"binary"}),i=r.SheetNames[0],o=r.Sheets[i],c=me.a.utils.sheet_to_json(o,{header:1,defval:"",blankrows:!1});t(c),n=void 0},n.onerror=function(e){a(e.target.error),n=void 0},n.readAsBinaryString(e)})}(a).then(function(e){o({file:{name:a.name},data:e}),c({source:e,schema:t})}).catch(function(e){return console.error("fail to parse file")}):function(e){return new Promise(function(t,a){var n=new FileReader;return n.onload=function(a){var r;r="csv"===e.name.split(".")[1]?Object(Q.c)(a.target.result):Object(Q.d)(a.target.result),t(r),n=void 0},n.onerror=function(e){a(e.target.error),n=void 0},n.readAsText(e)})}(a).then(function(e){o({file:{name:a.name},data:e}),c({source:e,schema:t})}).catch(function(e){return console.error("fail to parse file")})},onDropRejected:function(e,t){console.log("file is invalid")},isSize:"small"},r.a.createElement("span",{className:"tech-info"},"Drag and drop .xlsx, .csv file here(maximum 10MB)")),n&&"loading"===n.status&&r.a.createElement("span",null,"Validating Headers"),n&&n.valid&&r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement("span",{className:"has-text-success has-text-weight-bold"},'Headers of "',a.file.name,'" are valid'),r.a.createElement(j.Button,{isColor:"info",onClick:function(){return i({id:"1"})}},"Next Step")),n&&!n.valid&&"ERROR_HEADER"===n.type&&r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("span",{className:"has-text-danger has-text-weight-bold"},'Headers of "',a.file.name,'" do not match schema fields, please fix your file and re-upload'),r.a.createElement(be,{headerNames:n.headerNames,fieldNames:n.fieldNames})))}),ge=function(e){var t=e.className,a=e.collectedErrors,n=["Field","Error Type","Error Overview"],i=Object(M.sortBy)(a,function(e){return X[e.name]});return r.a.createElement("div",{style:{position:"relative",width:"100%",height:"70vh"}},r.a.createElement("div",{className:"action-table ".concat(t)},r.a.createElement("div",{className:"action-table-header"},n.map(function(e,t){return r.a.createElement("div",{key:t,className:"table-cell"},e)})),r.a.createElement("div",{className:"action-table-main"},i.map(function(e,t){var a=e.errors.length,i=Object(M.groupBy)(e.errors,function(e){return e.value}),o=Object.keys(i).length;return r.a.createElement("div",{key:t,className:"table-row"},n.map(function(t,n){var i;return i=0===n?e.name:1===n?e.errorType:"".concat(a," rows affected in total, ").concat(o," different invalid values"),r.a.createElement("div",{key:n,className:"table-cell"},i)}))}))))},Oe=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.flows,a=e.schema,n=e.relations;e.schemaFeedback||this.props.validateTable({source:t,schema:a,relations:n})}},{key:"render",value:function(){var e=this,t=this.props,a=t.schemaFeedback,n=t.modificationList,i=/row\s\d*/;return r.a.createElement("div",null,a&&"loading"===a.status&&r.a.createElement("span",null,a.loader),a&&!a.valid&&a.collectedErrors&&r.a.createElement("div",null,r.a.createElement("span",{className:"has-text-danger has-text-weight-bold"},"Found errors in ",a.errors.length," rows of ",Object.keys(a.collectedErrors).length," fields"),r.a.createElement(ge,{collectedErrors:a.collectedErrors}),r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement(j.Button,{isColor:"info",onClick:function(){return e.props.setStep({id:"0"})}},"Previous Step"),r.a.createElement(j.Button,{isColor:"info",onClick:function(){if(!n){var t=function(e){var t=Object(M.values)(e).reduce(function(e,t){return e.concat(t.errors)},[]),a=Object(M.values)(Object(M.groupBy)(t,function(e){return e.field+e.value})).map(function(e,t){return{index:t,field:e[0].field,errorType:e[0].errorType,fixed:!1,message:e[0].message.replace(i,"".concat(e.length," rows")),value:e[0].value,errors:e}});return Object(M.sortBy)(a,function(e){return X[e.name]})}(a.collectedErrors);e.props.startModification(t)}e.props.setStep({id:"2"})}},"Review Errors"))),a&&a.valid&&r.a.createElement("span",{className:"has-text-success has-text-weight-bold"},"Flows data is valid"))}}]),t}(r.a.Component),xe=Object(c.b)(function(e){return{flows:e.flows.data,schema:e.schemaValidation.descriptor&&oe(e),relations:e.schemaValidation.descriptor&&ce(e),foreignKeys:e.schemaValidation.descriptor&&le(e),schemaFeedback:e.schemaValidation.schemaFeedback,modificationList:e.modification.modificationList}},{validateTable:function(e){return function(t){var a=e.source,n=e.schema,r=e.relations;t(Object(z.a)(J.a.mark(function e(){return J.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.delegateYield(J.a.mark(function e(){var i,o,c,l,s;return J.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=a.length,o=10,c=0,l=[],s=J.a.mark(function e(){var i,s,u,d,m;return J.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:Z,payload:{status:"loading",loader:"validating ".concat(c," rows")}}),i=c/o,s=[a[0]].concat(a.slice(c+1-i,c+o-i)),e.next=5,U.Table.load(s,{schema:n});case 5:return u=e.sent,e.next=8,u.read({forceCast:!0,relations:r});case 8:d=e.sent,(m=d.filter(function(e){return e.errors})).length&&(m.forEach(function(e){e.rowNumber=e.rowNumber+o*i-i}),l=l.concat(m));case 11:case"end":return e.stop()}},e)});case 6:if(!(c<i)){e.next=11;break}return e.delegateYield(s(),"t0",8);case 8:c+=o,e.next=6;break;case 11:l.length?t({type:q,payload:{status:"done",valid:!1,errors:l,collectedErrors:re(a,n,l)}}):t({type:$,payload:{status:"done",valid:!0}});case 12:case"end":return e.stop()}},e)})(),"t0",2);case 2:e.next=8;break;case 4:e.prev=4,e.t1=e.catch(0),console.error(e.t1),t({type:q,payload:e.t1});case 8:case"end":return e.stop()}},e,null,[[0,4]])})))}},setStep:I,startModification:function(e){return{type:S,payload:e}}})(Oe),je=function(e){var t=e.steps,a=e.selectedStep,n=e.onSetStep,i=e.children;return r.a.createElement(j.LayoutWrapper,{hasConfig:!0},r.a.createElement(j.LayoutHeader,null,r.a.createElement(j.AppTitle,null,"Ricardo Data App"),r.a.createElement(j.RunningTitle,null,a.title)),r.a.createElement(j.LayoutContainer,null,r.a.createElement(j.LayoutContent,null,r.a.createElement(j.LayoutContentColumn,{isConfig:!0},t.map(function(e,t){var i=a.id===e.id,o=e.id>a.id;return r.a.createElement(j.ButtonContainer,{key:t},r.a.createElement(j.Button,{isColor:i?"info":null,isDisabled:o,onClick:function(){return n(e)}},e.name))})),r.a.createElement(j.LayoutContentColumn,{isWorkspace:!0},i)),r.a.createElement(j.LayoutFooter,null,r.a.createElement(j.LayoutFooterColumn,{isSecondary:!0},r.a.createElement("h3",null,"m\xe9dialab SciencesPo")),r.a.createElement(j.LayoutFooterColumn,{isPrimary:!0},"Ricardo Data App"))))},we=(a(957),a(958),Object(c.b)(function(e){return{steps:e.ui.steps,selectedStep:e.ui.selectedStep,repoData:e.repoData}},{setStep:I})(function(e){var t=e.steps,a=e.selectedStep,n=e.repoData,i=e.setStep;return r.a.createElement("div",{className:"App"},r.a.createElement(x,null),n.descriptor&&r.a.createElement(je,{steps:t,selectedStep:a,onSetStep:i},function(){switch(a.id){case"0":default:return r.a.createElement(ye,null);case"1":return r.a.createElement(xe,null);case"2":return r.a.createElement(ue,null);case"3":return r.a.createElement(Ee,null)}}()))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Se=a(17),ke=a(194),Ce=a(363),Ne=a(133),_e=Object(Se.combineReducers)({ui:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0,a=t.payload;switch(t.type){case N:return Object(f.a)({},D,{selectedStep:A.find(function(e){return a.id===e.id})});case S:return Object(f.a)({},e,{isModification:!0,modificationIndex:0});case _:return Object(f.a)({},e,{isModification:!1,modificationIndex:0});case T:return Object(f.a)({},e,{isModification:!0,modificationIndex:a.index});case F:return Object(f.a)({},e,{modificationIndex:e.modificationIndex+1});case R:if(0===e.modificationIndex)return;return Object(f.a)({},e,{modificationIndex:e.modificationIndex-1});default:return e}},flows:V,schemaValidation:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ie,t=arguments.length>1?arguments[1]:void 0,a=t.payload;switch(t.type){case N:return"0"===a.id?Object(f.a)({},e,{schemaFeedback:null,headerFeedback:null}):e;case b:var n={};return Object.keys(a).forEach(function(e){n[e]=Object(Q.b)(E.Base64.decode(a[e].content),function(e){return e.year?Object(f.a)({},e,{year:+e.year}):e})}),Object(f.a)({},e,{tables:n});case v:return Object(f.a)({},e,{descriptor:JSON.parse(E.Base64.decode(a.content))});case ee:case ae:case te:return Object(f.a)({},e,{headerFeedback:a});case Z:case q:case $:return Object(f.a)({},e,{schemaFeedback:a});default:return e}},modification:C,repoData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0,a=t.payload;switch(t.type){case b:return Object(f.a)({},e,{tables:a});case v:return Object(f.a)({},e,{datapackage:a,descriptor:JSON.parse(E.Base64.decode(a.content))});default:return e}}}),Fe={key:"root",storage:Ce},Re=Object(ke.a)(Fe,_e);var Te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[Ne.a],a=Se.compose.apply(void 0,[Se.applyMiddleware.apply(void 0,t)].concat([])),n=Object(Se.createStore)(Re,e,a);return{store:n,persistor:Object(ke.b)(n)}}({}).store;o.a.render(r.a.createElement(c.a,{store:Te},r.a.createElement(we,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[366,1,2]]]);
//# sourceMappingURL=main.7c9d2b80.chunk.js.map