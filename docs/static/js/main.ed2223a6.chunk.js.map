{"version":3,"sources":["../node_modules/tableschema/lib/profiles sync /^/.//.*/.json$","../node_modules/datapackage/node_modules/tableschema/lib/profiles sync /^/.//.*/.json$","../node_modules/datapackage/lib/profiles sync /^/.//.*/.json$","redux/modules/modification.js","redux/modules/ui.js","redux/modules/flows.js","components/SummaryTable.js","components/ContextTable.js","components/FormatCorrection.js","constants.js","redux/modules/repoData.js","redux/modules/schemaValidation.js","components/NewResourceForm.js","components/ForeignkeyCorrection.js","redux/modules/tables.js","containers/DataModification/ModificationComponent.js","containers/DataModification/DataModification.js","containers/DataModification/index.js","utils/fileExporter.js","containers/DataPublish/DataPublish.js","containers/DataPublish/index.js","containers/DataPrep/DataPrep.js","containers/DataPrep/index.js","components/HeaderValidation.js","containers/FileUpload/FileUpload.js","containers/FileUpload/index.js","utils/fileParser.js","components/ConfirmationModal.js","components/OverviewTable.js","containers/SchemaValidation/SchemaValidation.js","containers/SchemaValidation/index.js","containers/Layout/index.js","containers/Layout/Layout.js","App.js","serviceWorker.js","redux/rootReducer.js","redux/configureStore.js","index.js"],"names":["map","./geojson.json","./table-schema.json","./topojson.json","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","./data-package.json","./data-resource.json","./fiscal-data-package.json","./registry.json","./tabular-data-package.json","./tabular-data-resource.json","START_MODIFICATION","initialState","foreignKeyField","modificationIndex","modificationList","createReducer","SET_STEP","state","action","payload","HIDE_MODIFICATION","SELECT_ERROR","index","GO_NEXT_ERROR","GO_PREV_ERROR","SUBMIT_MODIFICATION","objectSpread","fixed","SHOW_CONFIRMATION_MODAL","HIDE_CONFIRMATION_MODAL","setStep","type","steps","name","title","isModalDisplay","selectedStep","isModification","fixedIndex","IMPORT_FLOWS","UPDATE_FLOWS","errors","fixedValues","fieldList","forEach","error","field","columnNumber","data","indexOf","rowNumber","SummaryTable","_ref","className","onSelectError","columnNames","react_default","a","createElement","style","position","width","height","concat","columnName","key","item","errorIndex","value","message","handleSelectError","columnIndex","isNull","components","length","fixedReferenceTable","isOutlined","isColor","onClick","ContextTable","flows","modificationItem","errorColumn","split","rowIndex","fixedValue","originalValue","errorColumnIndex","wordBreak","FormatCorrection","props","_this","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","hydrateState","_this$props","fieldDescriptor","fieldSchema","Field","constraints","enum","fieldValid","validateField","castValue","setState","valid","handleChange","event","target","handleSubmitForm","_this$state","defineProperty","onSubmitForm","prevProps","_this$state2","isSubmitDisabled","printValue","isSize","onChange","isDisabled","React","Component","RANKED_FIELDS","flow","unit","species_bullions","transport_type","statistical_period","partner_sum","world_trade_type","notes","source","reporting","partner","export_import|special_general","currency|year|reporting","FETCH_DATAPACKAGE_SUCCESS","FETCH_TABLES_SUCCESS","FETCH_BRANCHES_SUCCESS","SELECT_BRANCH","tablesList","path","selectedBranch","VALIDATE_TABLE_REQUEST","VALIDATE_TABLE_SUCCESS","VALIDATE_TABLE_FAILURE","VALIDATE_HEADER_REQUEST","VALIDATE_HEADER_SUCCESS","VALIDATE_HEADER_FAILURE","joinForeignKeyFields","fields","join","getCollectedErrors","schema","foreignKeys","allFields","foreignKeysList","reduce","res","getForeignKeyFields","d","formatFields","filter","foreignKeysFields","foreignKey","errorTypes","formatErrors","errorType","foreignKeyErrors","joinedFields","row","selectedErrors","find","err","push","joinedColumn","values","resourceName","schemaFeedback","headerFeedback","descriptor","tables","getResourceName","schemaValidation","getResources","resources","getResourceSchema","createSelector","resource","getRelations","selectedResource","relations","tableName","reference","console","log","FieldInput","getStateFromProps","options","fieldValue","getOptions","enumList","label","unshift","fieldName","FieldSlug","slugFields","NewResourceForm","_this2","resourceDescriptor","getSlug","preFields","f","capitalize","handleFieldChange","slug","_this3","fieldsValid","overflow","NewResourceForm_FieldSlug","NewResourceForm_FieldInput","isGrouped","onCancel","mapValues","onAddNew","ForeignKeyCorrection","initFixedValues","showNewForm","newRow","onUpdateTable","handleClickCreate","handleAddNewRow","handleCancel","handleSelectExist","_this$props2","referenceFieldResource","referenceField","generateValue","fixedValueSelected","react_select_browser_esm","isSearchable","isClearable","flex","components_NewResourceForm","connect","validateResource","dispatch","asyncToGenerator","regenerator_default","mark","_callee","wrap","_context","prev","next","Resource","load","read","t0","multiple","messages","stop","INIT_TABLES","csvParse","Base64","decode","content","year","_ref2","UPDATE_TABLE","_ref3","newTable","slice","splice","updateTable","onSubmitModification","handleSubmitModification","components_FormatCorrection","getFieldDescriptor","ForeignkeyCorrection","isEqual","getForeignKeyField","components_ContextTable","DataModification","nonFixedList","selectError","components_SummaryTable","display","justifyContent","DataModification_ModificationComponent","submitModification","updateFlows","hideModification","marginLeft","goPrevError","goNextError","modification","ui","downloadFile","array","fileName","ext","file","header","csvString","csvFormatRows","File","FileSaver","saveAs","sheet","XLSX","utils","aoa_to_sheet","wb","book_new","book_append_sheet","writeFile","DataPublish","_this$props$flows","exportFlows","DataPrep","fetchDatapackage","fetchBranches","repoData","branches","selectBranch","branch","fetchAllTables","get","branchUri","then","catch","Promise","all","table","apiUri","HeaderValidation","diff","headerNames","fieldNames","diffLength","difference","validationMap","Math","abs","FileUpload","importFlows","validateHeader","status","_callee2","_context2","Table","sent","limit","headers","containers_DataPrep","maxSize","onDrop","slicedToArray","reject","reader","FileReader","onload","bstr","result","wsname","SheetNames","ws","Sheets","sheet_to_json","defval","blankrows","undefined","onerror","readAsBinaryString","parseSheet","csvParseRows","tsvParse","readAsText","parseTable","onDropRejected","textAlign","components_HeaderValidation","ConfirmationModal","onSelectDiscard","onSelectDownload","isActive","closeModal","bodyContent","onAction","footerActions","OverviewTable","collectedErrors","orderedErrors","sortBy","totalErrors","groupedErrors","groupBy","v","distinctErrors","cellValue","SchemaValidation","validateTable","re","loader","components_OverviewTable","errorsList","groupedErrorsList","groupedValue","yearRange","years","min","max","replace","getOrderedErrors","startModification","_callee4","_context5","delegateYield","_callee3","tableLength","chunk","i","_loop","_context4","offset","chunkTable","rows","chunkErrors","_context3","forceCast","t1","Layout","onSetStep","children","hasConfig","isConfig","step","isSelectedStep","isStepDisabled","isWorkspace","isSecondary","isPrimary","initTables","showModal","hideModal","containers_Layout","containers_FileUpload","containers_SchemaValidation","containers_DataModification","containers_DataPublish","renderChildren","components_ConfirmationModal","Boolean","window","location","hostname","match","combineReducers","arguments","JSON","parse","datapackage","persistConfig","storage","persistedReducer","persistReducer","rootReducer","store","middleware","thunk","composedEnhancers","compose","apply","applyMiddleware","createStore","persistor","persistStore","configureStore","ReactDOM","render","es","src_App_0","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.ed2223a6.chunk.js","sourcesContent":["var map = {\n\t\"./geojson.json\": 261,\n\t\"./table-schema.json\": 665,\n\t\"./topojson.json\": 262\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 664;","var map = {\n\t\"./geojson.json\": 345,\n\t\"./table-schema.json\": 853,\n\t\"./topojson.json\": 346\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 852;","var map = {\n\t\"./data-package.json\": 892,\n\t\"./data-resource.json\": 893,\n\t\"./fiscal-data-package.json\": 894,\n\t\"./registry.json\": 895,\n\t\"./tabular-data-package.json\": 896,\n\t\"./tabular-data-resource.json\": 897\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 891;","import { createReducer } from 'redux-starter-kit';\n\nimport {SET_STEP} from './ui';\n\nexport const SUBMIT_MODIFICATION = 'SUBMIT_MODIFICATION';\nexport const START_MODIFICATION = 'START_MODIFICATION';\n\nexport const startModification = (payload) => ({\n  type: START_MODIFICATION,\n  payload\n});\n\nexport const submitModification = (payload) => ({\n  type: SUBMIT_MODIFICATION,\n  payload\n});\n\n\nconst initialState = {\n  foreignKeyField: null,\n  modificationIndex: 0,\n  modificationList: null\n}\n\nexport default createReducer(initialState, {\n  SET_STEP: (state, action) => {\n    const {payload} = action;\n    if (payload.id === '0') {\n      return initialState\n    }\n  },\n  START_MODIFICATION: (state, action) => {\n    const {payload} = action;\n    state.modificationList = payload\n    state.modificationIndex = 0\n  },\n  HIDE_MODIFICATION: (state, action) => {\n    state.modificationIndex = 0\n  },\n  SELECT_ERROR: (state, action) => {\n    const {payload} = action;\n    state.modificationIndex = payload.index;\n    // if (state.modificationList[payload.index].errorType === 'ERROR_FOREIGN_KEY') {\n    //   state.foreignKeyField = state.modificationList[payload.index].field\n    // }\n    // else {\n    //   state.foreignKeyField = null\n    // }\n  },\n  GO_NEXT_ERROR: (state, action) => {\n    state.modificationIndex = state.modificationIndex + 1\n  },\n  GO_PREV_ERROR: (state, action) => {\n    if (state.modificationIndex > 0) {\n      state.modificationIndex = state.modificationIndex - 1\n    }\n  },\n  SUBMIT_MODIFICATION: (state, action) => {\n    const {payload} = action;\n    state.modificationList[payload.index] = {\n      ...state.modificationList[payload.index],\n      ...payload,\n      fixed: true\n    }\n  }\n})\n\n// SELECTORS\n// const getModificationIndex = state => state.ui.modificationIndex;\n\n// const getReferenceResource = state => state.modification.referenceResource;\n\n// export const getTable = createSelector(\n  \n// )\n","import {\n  START_MODIFICATION,\n} from './modification';\n\nexport const SET_STEP = 'SET_STEP';\n\n// export const SHOW_MODIFICATION = 'SHOW_MODIFICATION';\nexport const HIDE_MODIFICATION = 'HIDE_MODIFICATION';\n\nexport const GO_NEXT_ERROR = 'GO_NEXT_ERROR';\nexport const GO_PREV_ERROR = 'GO_PREV_ERROR';\nexport const SELECT_ERROR = 'SELECT_ERROR';\n\nexport const SHOW_CONFIRMATION_MODAL = 'SHOW_CONFIRMATION_MODAL';\nexport const HIDE_CONFIRMATION_MODAL = 'HIDE_CONFIRMATION_MODAL';\n\nexport const setStep = (payload) => ({\n  type: SET_STEP,\n  payload\n});\n\nexport const showModal = () => ({\n  type: SHOW_CONFIRMATION_MODAL\n})\n\nexport const hideModal = () => ({\n  type: HIDE_CONFIRMATION_MODAL\n})\n\nexport const hideModification = () => ({\n  type: HIDE_MODIFICATION,\n});\n\nexport const selectError = (payload) => ({\n  type: SELECT_ERROR,\n  payload\n});\n\nexport const goPrevError = () => ({\n  type: GO_PREV_ERROR,\n});\n\nexport const goNextError = () => ({\n  type: GO_NEXT_ERROR,\n});\n\nconst steps = [\n  {\n    id: '0',\n    name: 'Upload file',\n    title: 'Choose a file'\n  },\n  {\n    id: '1',\n    name: 'Schema Validation',\n    title: 'Schema validation against datapackage'\n  },\n  {\n    id: '2',\n    name: 'Error Fixing',\n    title: 'Fix errors by fields'\n  },\n  {\n    id: '3',\n    name: 'Export/Publish Data',\n    title: 'Export or Publish your data to Github'\n  }\n];\n\nconst initialState = {\n  steps, \n  isModalDisplay: false,\n  selectedStep: steps[0],\n  isModification: false,\n  // modificationIndex: 0,\n  fixedIndex: []\n}\n\nexport default function reducer(state = initialState, action){\n  const {payload} = action;\n  switch (action.type){\n    case SET_STEP:\n      return {\n        ...initialState,\n        selectedStep: steps.find((step) => payload.id === step.id),\n      }\n    case SHOW_CONFIRMATION_MODAL:\n      return {\n        ...state,\n        isModalDisplay: true\n      }\n    case HIDE_CONFIRMATION_MODAL:\n      return {\n        ...state,\n        isModalDisplay: false\n      }\n    case START_MODIFICATION:\n      return {\n        ...state,\n        isModification: true,\n        // modificationIndex: 0\n      }\n    case HIDE_MODIFICATION:\n      return {\n        ...state,\n        isModification: false,\n        // modificationIndex: 0\n      }\n    case SELECT_ERROR: \n      return {\n        ...state,\n        isModification: true,\n        // modificationIndex: payload.index\n      }\n    // case GO_NEXT_ERROR:\n    //   return {\n    //     ...state,\n    //     modificationIndex: state.modificationIndex + 1\n    //   }\n    // case GO_PREV_ERROR:\n    //   if (state.modificationIndex === 0) return;\n    //   return {\n    //     ...state,\n    //     modificationIndex: state.modificationIndex - 1\n    //   }\n    default:\n     return state\n  }\n}","import { createReducer } from 'redux-starter-kit';\n\nimport {SET_STEP} from './ui';\n\nexport const UPDATE_FLOWS = 'UPDATE_FLOWS';\nexport const IMPORT_FLOWS = 'IMPORT_FLOWS';\nexport const EXPORT_FLOWS = 'EXPORT_FLOWS';\n\nexport const updateFlows = (payload) => ({\n  type: UPDATE_FLOWS,\n  payload\n});\n\nexport const importFlows = (payload) => ({\n  type: IMPORT_FLOWS,\n  payload\n});\n\nexport const exportFlows = (payload) => ({\n  type: EXPORT_FLOWS\n});\n\n\nconst initialState = {}\n\nexport default createReducer(initialState, {\n  SET_STEP: (state, action) => {\n    const {payload} = action;\n    if (payload.id === '0') {\n      return initialState\n    }\n  },\n  IMPORT_FLOWS: (state, action) => {\n    const {payload} = action;\n    return payload\n  },\n  UPDATE_FLOWS: (state, action) => {\n    const {payload} = action;\n    const {errors, fixedValues} = payload;\n    const fieldList = Object.keys(fixedValues)\n    errors.forEach((error) => {\n      fieldList.forEach((field) => {\n        const columnNumber = state.data[0].indexOf(field);\n        state.data[error.rowNumber -1][columnNumber] = fixedValues[field];\n      })\n    })\n  }\n})\n","import React from 'react';\nimport {isNull} from 'lodash';\nimport {\n  HelpPin,\n  Button,\n} from 'design-workshop';\n\nconst SummaryTable = ({\n  className,\n  modificationList,\n  onSelectError\n}) => {\n  const columnNames = ['', 'Field', 'Value', 'Rows', '']\n\n  return (\n    <div style={{position: 'relative', width: '100%', height: '70vh'}}>\n      \n      <div className={`action-table ${className}`}>\n        <div className={'action-table-header'}>\n          {\n            columnNames.map((columnName, index) => {\n              return (\n                <div key={index} className=\"table-cell\">\n                  <span className={columnName === 'Value' ? 'has-text-danger': 'has-text-black'}>{columnName}</span>\n                </div>\n              );\n            })\n          }\n        </div>\n        <div className={'action-table-main'}>\n          {\n            modificationList.map((item, errorIndex) => {\n              const {field, errors, value, message} = item;\n              const handleSelectError = () => {\n                onSelectError(errorIndex)\n              }\n              return (\n                <div key={errorIndex} className=\"table-row\">\n                  {\n                    columnNames.map((columnName, columnIndex) => {\n                      switch (columnIndex) {\n                        case 0:\n                        default:\n                          return (<div key={columnIndex} className=\"table-cell\">{errorIndex + 1}</div>)\n                        case 1:\n                          return (<div key={columnIndex} className=\"table-cell\">{field}</div>);\n                        case 2:\n                          return (\n                            <div key={columnIndex} className=\"table-cell\">\n                              <span className=\"has-text-danger\">{isNull(value)? 'null' : value }</span>\n                              <HelpPin>{message}</HelpPin>\n                            </div>);\n                        case 3:\n                          return (\n                            <div key={columnIndex} className=\"table-cell\">\n                              <span className={item.fixed ? 'has-text-success': 'has-text-black'}>{errors.length} {item.fixed && 'rows affected'}</span>\n                              <br/>\n                              {\n                                item.fixedReferenceTable && \n                                <span className=\"has-text-success\">new row added to \"{item.fixedReferenceTable}\" table</span>\n                              }\n                            </div>);\n                        case 4:\n                          return (\n                            <div key={columnIndex} className=\"table-cell\">\n                              <Button isOutlined isColor={item.fixed? 'success': 'info'} onClick={handleSelectError}>{item.fixed ? 'fixed': 'fix error'}</Button>\n                            </div>\n                          )\n                      }\n                    })\n                  }\n                </div>\n              )\n            })\n          }\n        </div>\n        {/* <div className={'action-table-footer'}></div> */}\n      </div>\n    </div>\n  );\n}\n\nexport default SummaryTable","import React from 'react';\n\nconst ContextTable = ({\n  className,\n  flows,\n  modificationItem\n}) => {\n  const columnNames = flows[0];\n  const {errors, field, value, fixedValues} = modificationItem;\n\n  return (\n    <div style={{position: 'relative', width: '100%', height: '20vh'}}>\n      <div className={`action-table ${className}`}>\n        <div className={'action-table-header'}>\n          {\n            columnNames.map((columnName, index) => {\n              const errorColumn = field.split('|').indexOf(columnName) !== -1 ? true : false\n              return (\n                <div key={index} className=\"table-cell\">\n                  <span className={errorColumn ? 'has-text-danger': 'has-text-black'}>{columnName}</span>\n                </div>\n              );\n            })\n          }\n        </div>\n        <div className={'action-table-main'} style={{height: '100%'}}>\n            {\n              errors.map((error, rowIndex) => {\n                return (\n                  <div key={rowIndex} className=\"table-row\">\n                    {\n                      columnNames.map((columnName, columnIndex) => {\n                        const errorColumn = field.split('|').indexOf(columnName) !== -1 ? true : false\n                        let fixedValue;\n                        let originalValue\n                        if (fixedValues && errorColumn) {\n                          const errorColumnIndex = field.split('|').indexOf(columnName)\n                          fixedValue = fixedValues[columnName]\n                          originalValue = value.split('|')[errorColumnIndex]\n                        }\n                      return (\n                        <div key={columnIndex} className=\"table-cell\" style={{ wordBreak: 'break-all' }}>\n                          <span className={errorColumn ? 'has-text-danger': 'has-text-black'}>\n                            {errorColumn ? originalValue: flows[error.rowNumber - 1][columnIndex]}\n                          </span>\n                          {\n                            fixedValue && \n                            <span  className=\"has-text-success\">->{fixedValue}</span>\n                          }\n                        </div>\n                      );\n                    })\n                  }\n                  </div>\n                );\n              })\n            }\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default ContextTable;","import React from 'react';\nimport {Field, Schema} from 'tableschema';\n\nimport {\n  Columns,\n  Column,\n  Button,\n  Field as FieldContainer,\n  Label,\n  Control,\n  Input,\n  Help,\n  Select\n} from 'design-workshop'\n\nclass FormatCorrection extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = this.hydrateState();\n  }\n\n  componentDidUpdate (prevProps) {\n   if (this.props.modificationIndex !== prevProps.modificationIndex) {\n      const state = this.hydrateState()\n      this.setState({\n        ...state\n      })\n   }\n  }\n\n  hydrateState = () => {\n    const {modificationItem, fieldDescriptor} = this.props;\n    const fieldSchema = new Field(fieldDescriptor);\n\n    let fixedValue = modificationItem.value;\n    if (modificationItem.fixedValues) fixedValue = modificationItem.fixedValues[fieldSchema.name];\n    else if (fieldSchema.constraints && fieldSchema.constraints.enum) {\n      fixedValue = fieldSchema.constraints.enum[0];\n    }\n    return {\n      fieldSchema,\n      fixedValue,\n      fieldValid: null\n    }\n  }\n\n  validateField = (value) => {\n    const {fieldSchema} = this.state;\n    try {\n      fieldSchema.castValue(value);\n      this.setState({\n        fixedValue: value,\n        fieldValid: {\n          valid: true\n        }\n      })\n    } catch(error) {\n      this.setState({\n        fixedValue: value,\n        fieldValid: {\n          valid: false,\n          error\n        }\n      })\n    }\n  }\n\n  handleChange = (event) => {\n    this.validateField(event.target.value)\n  }\n\n  handleSubmitForm = () => {\n    const {modificationItem} = this.props;\n    const {fixedValue, fieldValid} = this.state;\n    if(!fixedValue || fixedValue.length === 0 || !fieldValid.valid) return;\n    const fixedValues = {\n      [modificationItem.field]: fixedValue\n    }\n    this.props.onSubmitForm({fixedValues});\n  }\n\n  render() {\n    const {modificationItem} = this.props;\n    const {value, message, errors}= modificationItem;\n    const {fieldSchema, fixedValue, fieldValid} = this.state;\n    const isSubmitDisabled = !fieldValid || !fieldValid.valid\n    const printValue = fixedValue.length === 0 ? 'null' : fixedValue;\n\n    return (\n      <div style={{height: '60vh'}}>\n        <form>\n          <Columns>\n            <Column isSize='1/2'>\n              <FieldContainer>\n                <Label>Original value of \"{fieldSchema.name}\":</Label>\n                {/* <Input value={value} disabled /> */}\n                <div className=\"has-text-danger\">{value}</div>\n                <Help isColor=\"danger\">{message}</Help>\n              </FieldContainer>\n              {\n                (!fieldSchema.constraints || !fieldSchema.constraints.enum) &&\n                <FieldContainer>\n                  <Label>Fix with a new input</Label>\n                  <Control>\n                    <Input\n                      value={this.state.fixedValue}\n                      onChange={this.handleChange} />\n                  </Control>\n                  {\n                    fieldValid!==null && !fieldValid.valid && <Help isColor=\"danger\">{fieldValid.error.message}</Help>\n                  }\n                  {\n                    !isSubmitDisabled &&\n                    <Help isColor=\"success\">change {value} to {printValue}, total {errors.length} rows affected</Help>\n                  }\n                </FieldContainer>\n              }\n              \n              {\n                fieldSchema.constraints && fieldSchema.constraints.enum &&\n                <FieldContainer>\n                  <Label>Select a value of \"{fieldSchema.name}\" from:</Label>\n                  <Control>\n                    <Select value={this.state.fixedValue} onChange={this.handleChange}>\n                      {\n                        fieldSchema.constraints.enum.map((item, index) => {\n                          return (\n                            <option key={index}>{item}</option>\n                          )\n                        })\n                      }\n                    </Select>\n                    {\n                      !isSubmitDisabled &&\n                        <Help isColor=\"success\">change {value} to {printValue}, total {errors.length} rows affected</Help>\n                    }\n                  </Control>\n                </FieldContainer>\n              }\n  \n              <FieldContainer>\n                <Control>\n                  <Button isColor=\"info\" isDisabled={isSubmitDisabled} onClick={this.handleSubmitForm}>Confirm this fix</Button>\n                </Control>\n              </FieldContainer>\n            </Column>\n          </Columns>\n  \n        </form>    \n      </div>\n    )\n  }\n}\n\nexport default FormatCorrection;","export const MAXIMUM_FILE_SIZE = 10000000;\nexport const DEFAULT_CHUNK_SIZE = 100;\n\nexport const RANKED_FIELDS = {\n  \"id\": 0,\n  'flow': 1,\n  \"unit\": 2,\n  \"species_bullions\": 3,\n  \"transport_type\": 4,\n  \"statistical_period\": 5,\n  \"partner_sum\": 6,\n  \"world_trade_type\": 7,\n  \"notes\": 8,\n  \"source\": 9,\n  \"reporting\": 10,\n  \"partner\": 11,\n  \"export_import|special_general\": 12,\n  \"currency|year|reporting\": 13\n}","import {get} from 'axios';\nimport {apiUri, branchUri} from '../../config/default';\nimport { Base64 } from 'js-base64';\n\nexport const FETCH_TABLE_REQUEST = 'FETCH_TABLE_REQUEST';\nexport const FETCH_TABLE_SUCCESS = 'FETCH_TABLE_SUCCESS';\nexport const FETCH_TABLE_FAILURE = 'FETCH_TABLE_FAILURE';\n\nexport const FETCH_DATAPACKAGE_REQUEST = 'FETCH_DATAPACKAGE_REQUEST';\nexport const FETCH_DATAPACKAGE_SUCCESS = 'FETCH_DATAPACKAGE_SUCCESS';\nexport const FETCH_DATAPACKAGE_FAILURE = 'FETCH_DATAPACKAGE_FAILURE';\n\nexport const FETCH_TABLES_REQUEST = 'FETCH_TABLES_REQUEST';\nexport const FETCH_TABLES_SUCCESS = 'FETCH_TABLES_SUCCESS';\nexport const FETCH_TABLES_FAILURE = 'FETCH_TABLES_FAILURE';\n\nexport const FETCH_BRANCHES_REQUEST = 'FETCH_BRANCHES_REQUEST';\nexport const FETCH_BRANCHES_SUCCESS = 'FETCH_BRANCHES_SUCCESS';\nexport const FETCH_BRANCHES_FAILURE = 'FETCH_BRANCHES_FAILURE';\n\nexport const SELECT_BRANCH = 'SELECT_BRANCH';\n\nexport const tablesList = [\n  {\n    name: 'sources',\n    path: 'data/sources.csv'\n  },\n  // {\n  //   name: 'RICentities',\n  //   path: 'data/RICentities.csv'\n  // },\n  // {\n  //   name: 'RICentities_groups',\n  //   path: 'data/RICentities_groups.csv'\n  // },\n  {\n    name: 'currencies',\n    path: 'data/currencies.csv'\n  },\n  {\n    name: 'entity_names',\n    path: 'data/entity_names.csv'\n  },\n  // {\n  //   name: 'exchange_rates',\n  //   path: 'data/exchange_rates.csv'\n  // },\n  {\n    name: 'expimp_spegen',\n    path: 'data/expimp_spegen.csv'\n  }\n];\n\n/**\n * ACTIONS\n */\n\nexport const selectBranch = (payload) => ({\n  type: SELECT_BRANCH,\n  payload\n})\n\nexport const fetchBranches = (payload) => (dispatch) => {\n  dispatch({\n    type: FETCH_BRANCHES_REQUEST,\n    payload\n  });\n  return get(branchUri)\n  .then((res) => {\n    return dispatch({\n      type: FETCH_BRANCHES_SUCCESS,\n      payload: {\n        ...payload,\n        branches: res.data\n      }\n    })\n  }).catch((error) => dispatch({\n    type: FETCH_BRANCHES_FAILURE,\n    payload,\n    error\n  }))\n}\n\nexport const fetchTable = (payload) => (dispatch) => {\n  const {branch, table} = payload\n  dispatch({\n    type: FETCH_TABLE_REQUEST,\n    payload\n  });\n  return get(`${apiUri}/${table.path}?ref=${branch}`)\n    .then((res) => dispatch({\n      type: FETCH_TABLE_SUCCESS,\n      payload: {\n        ...payload,\n        data: res.data\n      }\n    })).catch((error) => dispatch({\n      type: FETCH_TABLE_FAILURE,\n      payload,\n      error\n    }))\n}\n\nexport const fetchAllTables = (payload) => (dispatch) => {\n  const {branch} = payload;\n  dispatch({\n    type: FETCH_TABLES_REQUEST,\n  });\n  Promise.all(tablesList.map((table) => {\n    return get(`${apiUri}/${table.path}?ref=${branch}`)\n  }))\n  .then((res) => {\n    let tables = {}\n    res.forEach((item) => {\n      const id = item.data.name.split('.')[0]\n      tables[id] = item.data\n    })\n    dispatch({\n      type: FETCH_TABLES_SUCCESS,\n      payload: tables\n    })\n  })\n  .catch((error) => dispatch({\n    type: FETCH_TABLES_FAILURE,\n    payload,\n    error\n  }))\n}\n\nexport const fetchDatapackage = () => (dispatch) => {\n  dispatch({\n    type: FETCH_DATAPACKAGE_REQUEST,\n  });\n  return get(`${apiUri}/datapackage.json?ref=master`)\n    .then((res) => dispatch({\n      type: FETCH_DATAPACKAGE_SUCCESS,\n      payload: res.data\n    })).catch((error) => dispatch({\n      type: FETCH_DATAPACKAGE_FAILURE,\n      error\n    }))\n}\n\n\n/**\n * REDUCER\n */\n\nconst initialState = {\n  selectedBranch: 'master'\n}\n\nexport default function reducer(state = initialState, action){\n  const {payload} = action;\n  switch (action.type){\n    case FETCH_TABLES_SUCCESS:\n      return {\n        ...state,\n        tables: payload\n      }\n    case FETCH_DATAPACKAGE_SUCCESS:\n      return {\n        ...state,\n        datapackage: payload,\n        descriptor: JSON.parse(Base64.decode(payload.content))\n      }\n    case FETCH_BRANCHES_SUCCESS:\n      return {\n        ...state,\n        branches: payload.branches\n      }\n    case SELECT_BRANCH:\n      return {\n        ...state,\n        selectedBranch: payload.branch,\n        tables: null\n      }\n    default:\n      return state\n  }\n}","import { createSelector } from 'reselect'\n\nimport {Package, Resource} from 'datapackage';\nimport {Table} from 'tableschema';\nimport {Base64} from 'js-base64';\n\nimport {\n  csvParse,\n} from 'd3-dsv';\n\nimport {repoUrl} from '../../config/default';\nimport {SET_STEP} from './ui';\nimport {IMPORT_FLOWS} from './flows';\n\nimport {DEFAULT_CHUNK_SIZE} from '../../constants';\n\nimport {\n  FETCH_TABLES_SUCCESS,\n  FETCH_DATAPACKAGE_SUCCESS,\n} from './repoData';\n\n\nexport const VALIDATE_RESOURCE_REQUEST = 'VALIDATE_RESOURCE_REQUEST';\nexport const VALIDATE_RESOURCE_SUCCESS = 'VALIDATE_RESOURCE_SUCCESS';\nexport const VALIDATE_RESOURCE_FAILURE = 'VALIDATE_RESOURCE_FAILURE';\n\nexport const VALIDATE_TABLE_REQUEST = 'VALIDATE_TABLE_REQUEST';\nexport const VALIDATE_TABLE_SUCCESS = 'VALIDATE_TABLE_SUCCESS';\nexport const VALIDATE_TABLE_FAILURE = 'VALIDATE_TABLE_FAILURE';\n\nexport const VALIDATE_HEADER_REQUEST = 'VALIDATE_HEADER_REQUEST';\nexport const VALIDATE_HEADER_SUCCESS = 'VALIDATE_HEADER_SUCCESS';\nexport const VALIDATE_HEADER_FAILURE = 'VALIDATE_HEADER_FAILURE';\n\n// not used yet\nexport const validateResource = (payload) => (dispatch) => {\n  const {descriptor} = payload;\n  dispatch(async () => {\n    let resource;\n    try {\n      // const dataPackage = await Package.load(descriptor);\n      // resource = dataPackage.getResource(resourceName);\n      resource = Resource.load(descriptor);\n      await resource.read()\n      \n      dispatch({\n        type: VALIDATE_RESOURCE_SUCCESS,\n        payload: {\n          valid: true\n        }\n      })\n    } catch (error) {\n      console.log(error)\n      if (error.multiple) {\n        dispatch({\n          type: VALIDATE_RESOURCE_FAILURE,\n          payload : {\n            rowNumber: error.rowNumber,\n            messages: error.errors.map((err) => { \n              return {\n              ...err,\n              message: err.message\n              }\n            })\n          }\n        })\n      } else {\n        dispatch({\n          type: VALIDATE_RESOURCE_FAILURE,\n          payload : {\n            rowNumber: error.rowNumber,\n            messages: [\n              {\n                ...error,\n                message: error.message\n              }\n            ]\n          }\n        })\n      }\n    }\n  })\n}\n\nexport const validateHeader = (payload) => (dispatch) => {\n  const {source, schema} = payload;\n  dispatch({\n    type: VALIDATE_HEADER_REQUEST,\n    payload: {\n      ...payload,\n      status: 'loading'\n    }\n  })\n  dispatch(async() => {\n    let table;\n    try {\n      table = await Table.load(source.slice(0,2), {schema});\n      await table.read({limit: 1});\n      dispatch({\n        type: VALIDATE_HEADER_SUCCESS,\n        payload: {\n          status: 'done',\n          valid: true,\n          headers: table.headers\n        }\n      })\n    } catch (error) {\n      console.error(error)\n      if (error.type !== 'ERROR_HEADER') {\n        dispatch({\n          type: VALIDATE_HEADER_SUCCESS,\n          payload: {\n            status: 'done',\n            valid: true,\n            headers: table.headers\n          }\n        })\n      } else {\n        dispatch({\n          type: VALIDATE_HEADER_FAILURE,\n          valid: false,\n          status: 'done',\n          payload: error\n        })\n      }\n    }\n  })\n}\n\nconst joinForeignKeyFields = (fields) => {\n  if (typeof(fields) === 'string') return fields;\n  else return fields.join('|');\n};\n\nconst getForeignKeyFields = (fields) => {\n  return fields.reduce((res, field) => {\n    if (typeof(field) === 'string') return res.concat([field]);\n    else return res.concat(field)\n  }, []);\n} \n\nconst getCollectedErrors = (flows, schema, errors) => {\n  const {fields, foreignKeys} = schema;\n\n  const allFields = fields.map((field)=> field.name);\n  const foreignKeysList = getForeignKeyFields(foreignKeys.map((d) => d.fields));\n\n  const formatFields = fields.filter((field) => foreignKeysList.indexOf(field.name) === -1)\n  const foreignKeysFields = foreignKeys.map((foreignKey) => joinForeignKeyFields(foreignKey.fields));\n\n  const errorTypes = ['ERROR_FORMAT', 'ERROR_FOREIGN_KEY'];\n\n  const formatErrors = formatFields.reduce((res, field) => {\n    return {\n      ...res,\n      [field.name]: {\n        name: field.name,\n        schema: field,\n        errorType: 'ERROR_FORMAT',\n        errors: []\n      }\n    }\n  }, {});\n\n  const foreignKeyErrors = foreignKeys.reduce((res, foreignKey) => {\n    const joinedFields = joinForeignKeyFields(foreignKey.fields);\n    // const foreignKeySchema = fields.find((field) => field.name === foreignKey.fields)\n    return {\n      ...res,\n      [joinedFields]: {\n        name: joinedFields,\n        ...foreignKey,\n        errorType: 'ERROR_FOREIGN_KEY',\n        errors: []\n      }\n    }\n  }, {});\n\n  errors.forEach((error)=>{\n    const row = flows[error.rowNumber -1];\n    const rowNumber = error.rowNumber;\n    errorTypes.forEach((errorType) => {\n      const selectedErrors = error.errors.find((err) => err.type === errorType)\n      if(!selectedErrors) return;\n      if(errorType === 'ERROR_FORMAT') {\n        allFields.forEach((field, columnIndex) => {\n          selectedErrors.errors.forEach((err) => {\n            if (err.columnNumber === columnIndex + 1 && foreignKeysList.indexOf(field) === -1) {\n              const item = {\n                rowNumber,\n                errorType,\n                columnNumber: err.columnNumber,\n                field,\n                value: row[columnIndex],\n                message: err.message\n              }\n              formatErrors[field].errors.push(item)\n            }\n          })\n        })\n      }\n\n      else if (errorType === 'ERROR_FOREIGN_KEY') {\n        foreignKeysFields.forEach((fields) => {\n          selectedErrors.errors.forEach((err) => {\n            // const fieldsList = fields.split('|');\n            const joinedColumn = joinForeignKeyFields(err.columnName);\n            if (joinedColumn === fields) {\n              const values = err.columnName.map((field) => {\n                const columnIndex = allFields.indexOf(field);\n                return row[columnIndex]\n              })\n              const item = {\n                rowNumber,\n                errorType,\n                columnName: err.columnName,\n                field: joinedColumn,\n                value: values.join('|'),\n                message: err.message\n              }\n              foreignKeyErrors[fields].errors.push(item)\n            }\n          })\n        })\n      }\n    })\n  });\n\n  Object.keys(formatErrors).forEach((columnName) => {\n    if(!formatErrors[columnName].errors.length) {\n      delete formatErrors[columnName]\n    }\n  });\n\n  Object.keys(foreignKeyErrors).forEach((columnName) => {\n    if(!foreignKeyErrors[columnName].errors.length) {\n      delete foreignKeyErrors[columnName]\n    }\n  });\n  \n  return {\n    ...formatErrors,\n    ...foreignKeyErrors\n  }\n}\n\nexport const validateTable = (payload) => (dispatch) => {\n  const {source, schema, relations} = payload;\n  console.log(relations)\n  dispatch(async() => {\n    try {\n      const tableLength = source.length;\n      const chunk = DEFAULT_CHUNK_SIZE;\n      let i = 0\n      let errors = []\n      for(i; i < tableLength; i += chunk) {\n        dispatch({\n          type: VALIDATE_TABLE_REQUEST,\n          payload: {  \n            status: 'loading',\n            loader: `validating ${i} rows`\n          }\n        })\n        const offset = i / chunk\n        const chunkTable = [source[0]].concat(source.slice(i+1-offset, i+chunk-offset))\n        const table = await Table.load(chunkTable, {schema});\n        const rows = await table.read({forceCast: true, relations});\n        const chunkErrors = rows.filter((row) => row.errors)\n        if (chunkErrors.length) {\n          chunkErrors.forEach((error) => {\n            error.rowNumber = error.rowNumber + chunk * offset - offset\n          });\n          errors = errors.concat(chunkErrors)\n        }\n      }\n      // const table = await Table.load(source, {schema});\n      // const rows = await table.read({forceCast: true});\n      // const errors = rows.filter((row) => row.errors)\n      if (errors.length) {\n        dispatch({\n          type: VALIDATE_TABLE_FAILURE,\n          payload: {\n            status: 'done',\n            valid: false,\n            errors,\n            collectedErrors: getCollectedErrors(source, schema, errors)\n          }\n        })\n      } else {\n        dispatch({\n          type: VALIDATE_TABLE_SUCCESS,\n          payload: {\n            status: 'done',\n            valid: true\n          }\n        })\n      }\n    } catch (error) {\n      console.error(error)\n      dispatch({\n        type: VALIDATE_TABLE_FAILURE,\n        payload: error\n      })\n    }\n  })\n}\n\n/**\n * REDUCER\n */\n\nconst initialState = {\n  resourceName: 'flows',\n  schemaFeedback: null,\n  headerFeedback: null,\n  descriptor: null,\n  tables: null\n}\n\nexport default function reducer(state = initialState, action){\n  const {payload} = action;\n  switch (action.type){\n    case SET_STEP: \n      if (payload.id === '0') {\n        return {\n          ...state,\n          schemaFeedback: null,\n          headerFeedback: null,\n        }\n      }\n      return state;\n    // case INIT_TABLES:\n    // case FETCH_TABLES_SUCCESS:\n    //   const tables = {}\n    //   Object.keys(payload).forEach((id) => {\n    //     tables[id] = csvParse(Base64.decode(payload[id].content), (d) => {\n    //       if (d.year) {\n    //         return {\n    //           ...d,\n    //           year: +d.year\n    //         }\n    //       }\n    //       return d\n    //     })\n    //   })\n    //   return {\n    //     ...state,\n    //     tables\n    //   }\n    case FETCH_DATAPACKAGE_SUCCESS:\n      return {\n        ...state,\n        descriptor: JSON.parse(Base64.decode(payload.content))\n      }\n    // case UPDATE_TABLE:\n    //   const {row, resourceName} = payload;\n    //   const newTable = state.tables[resourceName].slice();\n    //   newTable.splice(newTable.length, 0, row);\n    //   delete state.tables[resourceName]      \n    //   return {\n    //     ...state,\n    //     tables: {\n    //       ...state.tables,\n    //       [resourceName]: newTable\n    //     }\n    //   }\n    case VALIDATE_HEADER_REQUEST: \n    case VALIDATE_HEADER_FAILURE:\n    case VALIDATE_HEADER_SUCCESS:\n      return {\n        ...state,\n        headerFeedback: payload\n      }\n    case VALIDATE_TABLE_REQUEST: \n    case VALIDATE_TABLE_FAILURE:\n    case VALIDATE_TABLE_SUCCESS: \n      return {\n        ...state,\n        schemaFeedback: payload\n      }\n    default:\n    return state\n  }\n}\n\n/** \n* SELECTORS\n*/\n\nconst getResourceName = state => state.schemaValidation.resourceName;\nconst getResources = state => state.schemaValidation.descriptor.resources;\nconst getTables = state => state.tables.tables;\n\nexport const getResourceSchema = createSelector(\n  getResourceName,\n  getResources,\n  (resourceName, resources) => {\n    const selectedResource = resources.find((resource) => resource.name === resourceName);\n    return selectedResource.schema\n})\n\nexport const getRelations = createSelector(\n  getResourceName,\n  getResources,\n  getTables,\n  (resourceName, resources, tables) => {\n    const selectedResource = resources.find((resource) => resource.name === resourceName);\n    const relations = {};\n    selectedResource.schema.foreignKeys.forEach((key) => {\n      const tableName = key.reference.resource;\n      relations[tableName] = tables[tableName]\n      console.log(tables)\n    });\n    return relations;\n})","import React from 'react';\n\nimport {Field, Schema} from 'tableschema';\nimport {values, mapValues, capitalize} from 'lodash';\nimport {\n  Button,\n  Field as FieldContainer,\n  Label,\n  Control,\n  Input,\n  Help,\n  Select\n} from 'design-workshop'\n\nclass FieldInput extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = this.getStateFromProps();\n  }\n\n  getStateFromProps = () => {\n    const {fieldDescriptor, fieldValue} = this.props;\n    const fieldSchema = new Field(fieldDescriptor);\n\n    let value;\n    let options;\n    if (fieldValue) value = fieldValue\n    else if (fieldSchema.constraints && fieldSchema.constraints.enum) {\n      options = this.getOptions(fieldSchema.constraints.enum)\n      value = options[0].value\n    }\n    return {\n      fieldSchema,\n      value,\n      fieldValid: null,\n      options\n    }\n  }\n\n  getOptions = (enumList) => {\n    const options = enumList.map((e) => {\n      return {\n        label: e,\n        value: e\n      }\n    })\n    options.unshift({\n      value: '',\n      label: 'none'\n    })\n    return options\n  }\n\n  validateField = (value) => {\n    const {fieldSchema} = this.state;\n    let payload\n    try {\n      fieldSchema.castValue(value);\n      payload  = {\n        value,\n        fieldValid: {\n          valid: true\n        }\n      }\n      this.setState(payload)\n      this.props.onChange({\n        fieldName: this.state.fieldSchema.name,\n        ...payload\n      })\n    } catch(error) {\n      payload = {\n        value,\n        fieldValid: {\n          valid: false,\n          error\n        }\n      }\n      this.setState(payload)\n      this.props.onChange({\n        fieldName: this.state.fieldSchema.name,\n        ...payload\n      });\n    }\n  }\n\n  handleChange = (event) => {\n    this.validateField(event.target.value);\n  }\n\n  render() {\n    const {fieldSchema, fieldValid,value} = this.state;\n\n    return (\n      <div>\n        {\n          (!fieldSchema.constraints || !fieldSchema.constraints.enum) &&\n          <FieldContainer>\n            <Label>{fieldSchema.name}</Label>\n            <Control>\n              <Input\n                value={value}\n                onChange={this.handleChange} />\n            </Control>\n            {\n              fieldValid!==null && !fieldValid.valid && <Help isColor=\"danger\">{fieldValid.error.message}</Help>\n            }\n          </FieldContainer>\n        }  \n        {\n          fieldSchema.constraints && fieldSchema.constraints.enum &&\n          <FieldContainer>\n            <Label>{fieldSchema.name}</Label>\n            <Control>\n              <Select value={value} onChange={this.handleChange}>\n                {\n                  this.state.options.map((item, index) => {\n                    return (\n                      <option key={index} value={item.value}>{item.label}</option>\n                    )\n                  })\n                }\n              </Select>\n            </Control>\n          </FieldContainer>\n        }\n      </div>\n    )\n  }\n}\n\nconst FieldSlug = ({fieldDescriptor, field}) => {\n  console.log(field)\n  return (\n    <FieldContainer>\n      <Label>slug</Label>\n      <Control>\n        <span>{field.value}</span>\n      </Control>\n    </FieldContainer>\n  )\n}\n\nconst slugFields = ['author','name', 'country', 'volume_date', 'volume_number', 'pages'];\n\nclass NewResourceForm extends React.Component {\n  \n  constructor(props) {\n    super(props);\n    this.state = this.getStateFromProps()\n  }\n\n  // componentDidUpdate (prevProps) {\n  //   this.state = this.getStateFromProps()\n  // }\n\n  getStateFromProps = () => {\n    const {resourceDescriptor} = this.props;\n    const {schema} = resourceDescriptor;\n    const fields = schema.fields.reduce((res, field) => {\n      return {\n        ...res,\n        [field.name]: {}\n      }\n    }, {});\n    return {\n      fields\n    }\n  }\n\n  getSlug = (payload) => {\n    const preFields = {\n      ...this.state.fields,\n      [payload.fieldName]: payload\n    };\n    const value = slugFields.reduce((res, f)=> {\n      const printValue = preFields[f].value || ''\n      return res + capitalize(printValue)\n    }, '');\n    return {\n      fieldName: 'slug',\n      value\n    }\n  }\n\n  handleFieldChange = (payload) => {\n    if (this.state.fields['slug'] && slugFields.indexOf(payload.fieldName) !== -1) {\n      const slug = this.getSlug(payload);\n      this.setState({\n        fields: {\n          ...this.state.fields,\n          slug,\n          [payload.fieldName]: payload\n        }\n      });\n      return;\n    }\n    this.setState({\n      fields: {\n        ...this.state.fields,\n        [payload.fieldName]: payload\n      },  \n\n    })\n  }\n\n  render() {\n    const {resourceDescriptor} = this.props;\n    const {schema} = resourceDescriptor;\n    const fieldsValid = values(this.state.fields).filter((field) => field.fieldValid && !field.fieldValid.valid);\n\n    const handleAddNew = () => {\n      const data = mapValues(this.state.fields, (item) => item.value || '')\n      this.props.onAddNew(data)\n    }\n    return (\n      <div>\n        <div style={{height: '40vh', overflow:'auto'}}>\n          <h3>Add a new row to \"{resourceDescriptor.name}\" table</h3>\n          {\n            schema.fields.map((field) => {\n              if (field.name === 'slug') {\n                return <FieldSlug fieldDescriptor={field} field={this.state.fields['slug']} />\n              }\n              return (\n                <FieldInput fieldDescriptor={field} onChange={this.handleFieldChange} />\n              )\n          })\n          }\n        </div>\n        <FieldContainer isGrouped>\n          <Control>\n            <Button isColor=\"info\" onClick={this.props.onCancel}>Cancel</Button>\n          </Control>\n          <Control>\n            <Button isColor=\"info\" isDisabled={fieldsValid.length>0} onClick={handleAddNew}>Add new</Button>\n          </Control>\n        </FieldContainer>\n      </div>\n    )\n  }\n}\nexport default NewResourceForm;","import React from 'react';\nimport {connect} from 'react-redux';\nimport {values, isNil} from 'lodash'\n\nimport {Field, Schema} from 'tableschema';\nimport Select from 'react-select';\n\nimport {\n  Columns,\n  Column,\n  Button,\n  Field as FieldContainer,\n  Label,\n  Control,\n  Input,\n  Help,\n} from 'design-workshop';\n\nimport {validateResource} from '../redux/modules/schemaValidation';\n\n\nimport NewResourceForm from './NewResourceForm';\n\nclass ForeignKeyCorrection extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = this.hydrateState()\n  }\n\n  componentDidUpdate (prevProps) {\n   if (this.props.modificationIndex !== prevProps.modificationIndex) {\n      const state = this.hydrateState();\n      this.setState({\n        ...state\n      })\n   }\n  }\n\n  initFixedValues = () => {\n    const {modificationItem} = this.props;\n    const fieldList = modificationItem.field.split('|');\n\n    return fieldList.reduce((res, field) => {\n      return {\n        ...res,\n        [field]: ''\n      }\n    }, {});\n  }\n\n  hydrateState = () => {\n    const {modificationItem} = this.props;\n\n    let fixedValues = this.initFixedValues()\n    if (modificationItem.fixedValues) fixedValues = modificationItem.fixedValues\n\n    return {\n      fixedValues,\n      showNewForm: false,\n      newRow: null,\n    }\n  }\n\n  handleSubmitForm = () => {\n    const resourceName = this.props.foreignKeyField.reference.resource;  \n    const {fixedValues, newRow} = this.state;\n    // if(!fixedValue || fixedValue.length === 0) return;\n    this.props.onSubmitForm({\n      fixedValues,\n      fixedReferenceTable: newRow ? resourceName :null,\n    });\n    if (newRow) {\n      this.props.onUpdateTable({\n        row: newRow,\n        resourceName\n      });\n    }\n  }\n\n  handleClickCreate = () => {\n    const fixedValues = this.initFixedValues()\n    this.setState({\n      fixedValues,\n      showNewForm: true\n    })\n  }\n\n  handleAddNewRow = (row) => {\n    // delete referenceFieldResource.path\n    // referenceFieldResource.data = tables[resourceName].push(values);\n    // this.props.validateResource(referenceFieldResource)\n    const {modificationItem, foreignKeyField} = this.props;\n\n    const fieldList = modificationItem.field.split('|');\n    const fixedValues = fieldList.reduce((res, field, index) => {\n      return {\n        ...res,\n        [field]: fieldList.length > 1 ? row[foreignKeyField.reference.fields[index]] : row[foreignKeyField.reference.fields]\n      }\n    }, {})\n    this.setState({\n      newRow: row,\n      fixedValues,\n      showNewForm: false\n    })\n  }\n\n  handleCancel = () => {\n    this.setState({\n      showNewForm: false,\n      newRow: null\n    })\n  }\n\n  handleSelectExist = (item) => {\n    const {modificationItem} = this.props;\n    if (!item) {\n      this.setState({\n        fixedValues: {\n          [modificationItem.field]: ''\n        }\n      })\n    }\n    else {\n      this.setState({\n        fixedValues: {\n          [modificationItem.field]: item.value\n        },\n        newRow: null\n      })\n    }\n  }\n\n  render() {\n    const {newRow, fixedValues} = this.state;\n    const {modificationItem, schema, foreignKeyField, tables, descriptor} = this.props;\n    const {value, message, errors, field, fixedReferenceTable}= modificationItem;\n    const resourceName = foreignKeyField.reference.resource;  \n    const referenceFieldResource = descriptor.resources.find((resource) => resource.name === resourceName);\n    const referenceField = foreignKeyField.reference.fields\n\n    const generateValue = (value) => {\n      return {\n        value,\n        label: value\n      }\n    }\n    const fixedValueSelected = this.state.newRow ? generateValue(''): generateValue(fixedValues[field])\n\n    const getOptions = () => {\n      const table = tables[resourceName];\n      return table.map((item) => {\n        return {\n          value: item[referenceField],\n          label: item[referenceField]\n        }\n      })\n    }\n\n    const isSubmitDisabled= !this.state.newRow && fixedValueSelected.value === '';\n\n    return (\n      <div style={{height: '60vh'}}>\n        <form>\n          <Columns>\n            <Column isSize='1/2'>\n              <FieldContainer>\n                <Label>Original value of \"{field}\":</Label>\n                {/* <Input value={value} disabled /> */}\n                <div className=\"has-text-danger\">{value}</div>\n                <Help isColor=\"danger\">{message}</Help>\n              </FieldContainer>\n              {\n                modificationItem.field === 'source' &&\n                <FieldContainer>\n                  <Label>Select from exist sources</Label>\n                  <Select \n                    isSearchable={true}\n                    isClearable={true}\n                    value={fixedValueSelected}\n                    onChange={this.handleSelectExist}\n                    options={getOptions()} />\n                  {\n                    fixedValueSelected.value !== '' && !fixedReferenceTable &&\n                      <Help isColor=\"success\">\n                        <li>change \"{modificationItem.value}\" to \"{values(fixedValues).join(\"|\")}\"</li>\n                        <li>total {modificationItem.errors.length} rows affected</li>\n                      </Help>\n                  }\n                </FieldContainer>\n              }\n\n              <FieldContainer>\n                <Control>\n                  <Label>Not found one</Label>\n                  <Button isColor=\"info\" onClick={this.handleClickCreate}>Create new item</Button>\n                  {\n                    (this.state.newRow) &&\n                    <Help isColor=\"success\">\n                      <li>change \"{modificationItem.value}\" to \"{values(fixedValues).join(\"|\")}\"</li>\n                      <li>total {modificationItem.errors.length} rows affected</li>\n                      <li>new row will be added to \"{resourceName}\" table</li>\n                    </Help>\n                  }\n                </Control>\n              </FieldContainer>\n            </Column>\n\n            {\n              this.state.showNewForm && \n              (modificationItem.field === 'source'|| modificationItem.field === 'export_import|special_general') &&\n              <Column isSize='1/2' className='new-resource-form' style={{flex: 'auto'}}>\n                <NewResourceForm \n                  resourceDescriptor={referenceFieldResource} \n                  onCancel={this.handleCancel}\n                  onAddNew={this.handleAddNewRow} />\n              </Column>\n            }\n          </Columns>\n          <FieldContainer>\n            <Control>\n              <Button isColor=\"info\" isDisabled={isSubmitDisabled} onClick={this.handleSubmitForm}>Confirm this fix</Button>\n              {\n                fixedReferenceTable &&\n                  <Help isColor=\"success\">\n                    <li>fixed \"{modificationItem.value}\" with \"{values(fixedValues).join(\"|\")}\"</li>\n                    <li>total {modificationItem.errors.length} rows affected</li>\n                    <li>new row is added to \"{resourceName}\" table</li>\n                  </Help>\n              }\n            </Control>\n          </FieldContainer>\n  \n        </form>\n      </div>\n    )\n  }\n}\nexport default connect(null, {\n  validateResource\n})(ForeignKeyCorrection);","import { createReducer } from 'redux-starter-kit';\n\nimport {\n  csvParse,\n} from 'd3-dsv';\nimport {Base64} from 'js-base64';\n\nimport {\n  FETCH_TABLES_SUCCESS,\n  FETCH_DATAPACKAGE_SUCCESS,\n\n} from './repoData';\n\nexport const UPDATE_TABLE = 'UPDATE_TABLE';\nexport const INIT_TABLES = 'INIT_TABLES';\n\nexport const initTables = (payload) => ({\n  type: INIT_TABLES,\n  payload\n})\n\nexport const updateTable = (payload) => ({\n  type: UPDATE_TABLE,\n  payload\n})\n\nconst initialState = {};\n\n\nexport default createReducer(initialState, {\n  INIT_TABLES: (state, {payload}) => {\n    const tables = {}\n    Object.keys(payload).forEach((id) => {\n      tables[id] = csvParse(Base64.decode(payload[id].content), (d) => {\n        if (d.year) {\n          return {\n            ...d,\n            year: +d.year\n          }\n        }\n        return d\n      })\n    })\n    state.tables = tables\n  },\n  FETCH_TABLES_SUCCESS: (state, {payload}) => {\n    const tables = {}\n    Object.keys(payload).forEach((id) => {\n      tables[id] = csvParse(Base64.decode(payload[id].content), (d) => {\n        if (d.year) {\n          return {\n            ...d,\n            year: +d.year\n          }\n        }\n        return d\n      })\n    })\n    state.tables = tables\n  },\n  UPDATE_TABLE: (state, {payload}) => {\n    const {row, resourceName} = payload;\n    const newTable = state.tables[resourceName].slice();\n    newTable.splice(newTable.length, 0, row)\n    state.tables[resourceName] = newTable\n  },\n})","import React from 'react';\nimport {connect} from 'react-redux';\n\nimport {isEqual} from 'lodash';\n\nimport ContextTable from '../../components/ContextTable'\nimport FormatCorrection from '../../components/FormatCorrection';\nimport ForeignkeyCorrection from '../../components/ForeignkeyCorrection';\n\nimport {updateTable} from '../../redux/modules/tables';\n\nconst ModificationComponent = ({\n  className,\n  flows,\n  tables,\n  descriptor,\n  schema,\n  modificationItem,\n  modificationIndex,\n  onSubmitModification,\n  updateTable,\n}) => {\n  const handleSubmitModification = (payload) => {\n    const {fixedValues, fixedReferenceTable} = payload;\n    console.log(payload)\n    return onSubmitModification({\n      ...modificationItem,\n      fixedValues,\n      fixedReferenceTable,\n      index: modificationIndex\n    })\n  }\n\n  const getFieldDescriptor = () => {\n    const {field}= modificationItem;\n    const descriptor = schema.fields.find((f) => f.name === field)\n    return descriptor;\n  }\n\n  const getForeignKeyField = () => {\n    let foreignKeyField;\n    if (modificationItem.field.indexOf('|') !== -1) {\n      const fieldList = modificationItem.field.split('|');\n      foreignKeyField = schema.foreignKeys.find((f) => isEqual(f.fields, fieldList));\n    }\n    else {\n      foreignKeyField = schema.foreignKeys.find((f) => f.fields === modificationItem.field);\n    }\n    return foreignKeyField;\n  }  \n  return (\n    <div>\n      {\n        modificationItem.errorType === 'ERROR_FORMAT' &&\n        <FormatCorrection \n          fieldDescriptor={getFieldDescriptor()} \n          modificationItem={modificationItem}\n          modificationIndex={modificationIndex}\n          onSubmitForm={handleSubmitModification} \n        /> \n      }\n      {\n        modificationItem.errorType === 'ERROR_FOREIGN_KEY' &&\n        <ForeignkeyCorrection \n          schema={schema}\n          descriptor={descriptor}\n          foreignKeyField={getForeignKeyField()}\n          tables={tables}\n          modificationItem={modificationItem}\n          modificationIndex={modificationIndex}\n          onUpdateTable={updateTable}\n          onSubmitForm={handleSubmitModification} \n        /> \n      }\n      <ContextTable flows={flows} modificationItem={modificationItem} />\n    </div>\n  );\n}\n\nconst mapStateToProps = state => ({\n  descriptor: state.schemaValidation.descriptor,\n  tables: state.tables.tables\n});\n\nexport default connect(mapStateToProps, {updateTable})(ModificationComponent);","import React from 'react';\nimport {connect} from 'react-redux';\n\n\nimport {\n  Button,\n} from 'design-workshop';\n\nimport {\n  setStep,\n  hideModification,\n  selectError,\n  goNextError,\n  goPrevError\n} from '../../redux/modules/ui';\n\nimport {updateFlows} from '../../redux/modules/flows';\n\nimport {submitModification} from '../../redux/modules/modification';\n\nimport SummaryTable from '../../components/SummaryTable';\nimport ModificationComponent from './ModificationComponent';\n\nimport {getResourceSchema} from '../../redux/modules/schemaValidation';\n\nclass DataModification extends React.Component {\n  \n  render() {\n    const {flows, schema, isModification, modificationIndex, modificationList} = this.props;\n    const nonFixedList = modificationList.filter((item) => item.fixed === false)\n\n    const handlePrevStep = () => this.props.setStep({id: '1'})\n    const handleNextStep = () => this.props.setStep({id: '3'})\n\n    const handlePrevError = () => {\n      if (modificationIndex > 0) this.props.goPrevError();\n    }\n\n    const handleNextError = () => {\n      if (modificationIndex < modificationList.length - 1) this.props.goNextError();\n    }\n\n    const handleSelectError = (index) => {\n      if (index < modificationList.length) {\n        this.props.selectError({\n          index\n        })\n      }\n    }\n\n    const handleSelectFirstError = () => {\n      this.props.selectError({\n        index: nonFixedList[0].index\n      })\n    }\n\n    const handleSubmitModification = (payload) => {\n      const {index} = payload;\n      this.props.submitModification(payload);\n      this.props.updateFlows(payload);\n      if ( index+1 < modificationList.length && nonFixedList.length > 0) {\n        handleSelectError(index+1)\n      }\n      else {\n        this.props.hideModification()\n      }\n    }\n    return (\n      <div>\n        {\n          !isModification &&\n            <div>\n              {\n                modificationList.length > 0 &&\n                <div className=\"has-text-danger has-text-weight-bold\">{modificationList.length} different errors need to modify</div>\n              }\n              {\n                modificationList && \n                <SummaryTable modificationList={modificationList} onSelectError={handleSelectError} />\n              }\n              <div style={{\n                display: 'flex',\n                justifyContent: 'space-between'\n              }}>\n                <Button \n                  isColor=\"info\" \n                  onClick={handlePrevStep}>\n                    Previous Step\n                </Button>\n                {\n                  nonFixedList.length === 0 ?\n                    <Button isColor=\"info\" onClick={handleNextStep}>\n                      Ready to publish\n                    </Button> :\n                    <Button isColor=\"info\" onClick={handleSelectFirstError}>\n                      Start fix error\n                    </Button>\n                }\n              </div>\n            </div>\n        }\n        {\n          isModification &&\n          <div>\n            <ModificationComponent \n              flows={flows}\n              schema={schema}\n              modificationIndex={modificationIndex}\n              modificationItem={modificationList[modificationIndex]} \n              onSubmitModification={handleSubmitModification} />\n            <div style={{\n              display: 'flex',\n              justifyContent: 'space-between'\n            }}>\n              <div>\n                <Button isColor=\"info\" onClick={this.props.hideModification}>\n                  Back to summary\n                </Button>\n              </div>\n              <span className=\"has-text-danger has-text-weight-bold\">{modificationIndex + 1} / {modificationList.length }</span>\n              <div>\n                {\n                  modificationIndex !==0 &&\n                    <Button isColor=\"info\" style={{marginLeft: '10px'}}\n                      onClick={handlePrevError}>\n                      Prev Error\n                    </Button>\n                }\n                {\n                  modificationIndex !== (modificationList.length-1) &&\n                    <Button isColor=\"info\" style={{marginLeft: '10px'}}\n                      onClick={handleNextError}>\n                      Next Error\n                    </Button>\n                }\n              </div>\n            </div>\n          </div>\n        }\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = state => ({\n  flows: state.flows.data,\n  schema: getResourceSchema(state),\n  schemaFeedback: state.schemaValidation.schemaFeedback,\n  modificationList: state.modification.modificationList,\n  isModification: state.ui.isModification,\n  modificationIndex: state.modification.modificationIndex\n})\n\nexport default connect(mapStateToProps, {\n  setStep,\n  updateFlows,\n  hideModification,\n  selectError,\n  goNextError,\n  goPrevError,\n  submitModification\n})(DataModification);","import DataModification from './DataModification'\n\nexport default DataModification","import XLSX from 'xlsx';\nimport {\n  csvFormatRows,\n} from 'd3-dsv';\n\nimport FileSaver from 'file-saver';\n\nexport function downloadFile ( array, fileName, ext) {\n  let file;\n  const header = array[0]\n  switch(ext) {\n    case 'csv': {\n      const csvString = csvFormatRows(array)\n      file = new File(\n        [csvString],\n        fileName,\n        { type: 'text/csv;charset=utf-8' }\n      )\n      FileSaver.saveAs(file)\n      break\n    }\n    case 'xlsx':\n    default: {\n      const sheet = XLSX.utils.aoa_to_sheet(array, {header});\n      const wb = XLSX.utils.book_new();\n      XLSX.utils.book_append_sheet(wb, sheet, 'SheetJS');\n      XLSX.writeFile(wb, fileName);\n      break\n    }\n  }\n}\n","import React from 'react';\nimport {connect} from 'react-redux';\nimport {\n  Button,\n} from 'design-workshop';\n\nimport {exportFlows} from '../../redux/modules/flows';\nimport {downloadFile} from '../../utils/fileExporter';\n\nclass DataPublish extends React.Component {\n\n  render () {\n    const handleExport = () => {\n      const {file, data} = this.props.flows;\n      downloadFile(data, file.name, 'xlsx')\n    }\n    return (\n      <div>\n        <Button onClick={handleExport}>Export fixed data</Button>\n      </div>\n    )\n  }\n}\n\nconst mapStateToProps = state => ({\n  flows: state.flows\n})\n\nexport default connect(mapStateToProps, {exportFlows})(DataPublish);","import DataPublish from './DataPublish'\n\nexport default DataPublish","import React from 'react';\nimport {connect} from 'react-redux'\n\nimport {\n  Label,\n  Button,\n  Help,\n  Select\n} from 'design-workshop';\n\nimport { \n  selectBranch,\n  fetchBranches,\n  fetchAllTables,\n  fetchDatapackage\n} from '../../redux/modules/repoData';\n\nclass DataPrep extends React.Component {\n  componentDidMount() {\n    // const {repoData} = this.props\n    // if (!repoData.tables && !repoData.datapackage) {\n    //   this.props.fetchDatapackage()\n    //   this.props.fetchAllTables({branch:'master'})\n    // }\n    this.props.fetchDatapackage()\n    this.props.fetchBranches()\n  }  \n\n  render () {\n    const {repoData} = this.props;\n    const {branches, selectedBranch, tables} = repoData;\n    const handleSelectBranch = (event) => {\n      this.props.selectBranch({\n        branch: event.target.value\n      })\n    }\n    const handleGetTables = () => {\n      this.props.fetchAllTables({branch: selectedBranch});\n    }\n    return (\n      <div>\n        {branches && \n          <div>\n            <Label>Get tables from {selectedBranch} branch</Label>\n            <Select value={selectedBranch} onChange={handleSelectBranch}>\n              {\n                branches.map((item, index) => {\n                  return (\n                    <option key={index}>{item.name}</option>\n                  )\n                })\n              }\n            </Select>\n            <Button isColor=\"info\" onClick={handleGetTables}>Fetch</Button>\n            {tables &&\n              <Help isColor=\"success\">tables from {selectedBranch} branch are loaded</Help>\n            }\n          </div>\n        }\n      </div>\n    )\n  }\n}\n\nconst mapStateToProps = state => ({\n repoData: state.repoData\n})\n\nexport default connect(mapStateToProps, {\n  fetchBranches,\n  selectBranch,\n  fetchAllTables,\n  fetchDatapackage\n})(DataPrep);","import DataPrep from './DataPrep'\n\nexport default DataPrep","import React from 'react';\nimport {difference} from 'lodash';\n\nimport {\n  HelpPin\n} from 'design-workshop';\n\nconst HeaderValidation = ({\n  headerNames,\n  fieldNames\n}) => {\n  const diffLength = headerNames.length - fieldNames.length;\n  let diff;\n  if (diffLength > 0) {\n    diff = difference(headerNames, fieldNames);\n  }\n  else diff = difference(fieldNames, headerNames);\n  const validationMap = headerNames.map((name, index) => {\n    if (fieldNames[index] && fieldNames[index] === name) {\n      return {\n        name,\n        valid: true\n      }\n    } else {\n      return {\n        name,\n        valid: false\n      }\n    }\n  });\n\n  return (\n    <div style={{\n      }}>\n      {diff.length === diffLength && diffLength > 0 &&\n        <div className=\"has-text-danger\">\n          <span>Extra headers - </span>\n          { diff.map((field) => {\n             return <span>\"{field}\" </span>\n            })\n          }\n        </div>\n      } \n      {diff.length === Math.abs(diffLength) && diffLength < 0 &&\n        <div className=\"has-text-danger has-text-weight-bold\">\n          <span>Missing headers - </span>\n          { diff.map((field) => {\n             return <span>\"{field}\" </span>\n            })\n          }\n        </div>\n      }\n      <div style={{\n        display: 'flex',\n        justifyContent: 'space-evenly'\n      }}>\n        <div>\n          <div className=\"has-text-weight-bold\">headers </div>\n          {\n            validationMap.map((item, index) => {\n              return (\n                <div key={index} className={item.valid ? 'has-text-black': 'has-text-danger'}>\n                  {item.name}\n                </div>\n              );\n            })\n          }\n        </div>\n        <div>\n          <div className=\"has-text-weight-bold\">schema fields</div>\n          {\n            fieldNames.map((columnName, index) => {\n              return (\n                <div key={index}>\n                  {columnName}\n                </div>\n              );\n            })\n          }\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default HeaderValidation;","import React from 'react'\nimport {connect} from 'react-redux'\n\nimport {Button, DropZone} from 'design-workshop'\nimport { \n  importFlows,\n} from '../../redux/modules/flows';\n\nimport { \n  setStep\n} from '../../redux/modules/ui';\n\nimport {\n  validateHeader, \n  getResourceSchema\n} from '../../redux/modules/schemaValidation';\nimport DataPrep from '../DataPrep';\n\nimport HeaderValidation from '../../components/HeaderValidation';\n\nimport {parseSheet, parseTable} from '../../utils/fileParser';\nimport { MAXIMUM_FILE_SIZE } from '../../constants';\n\nconst FileUpload = ({\n  schema,\n  tables,\n  flows,\n  headerFeedback,\n  setStep,\n  importFlows,\n  validateHeader\n}) => {\n  const handleDrop = ([file]) => {\n    if (file.name.split('.')[1] === 'xlsx') {\n      parseSheet(file)\n      .then((data) => {\n        importFlows({\n          file: {\n            name: file.name\n          },\n          data\n        });\n        validateHeader({source: data, schema})\n      })\n      .catch((error) => {\n        console.error(error)\n        console.error('fail to parse file')\n      })\n    }\n    else {\n      parseTable(file)\n      .then((data) => {\n        importFlows({\n          file: {\n            name: file.name\n          },\n          data\n        });\n        validateHeader({source: data, schema})\n      })\n      .catch((error) => console.error('fail to parse file'))\n    }\n  }\n  const handleDropRejected = (file, event) => {\n    console.log(\"file is invalid\")\n  }\n  const handleNextStep = () => setStep({id: '1'})\n  return (\n    <div>\n      <DataPrep />\n      {\n        tables &&\n        <DropZone\n          maxSize={MAXIMUM_FILE_SIZE}\n          onDrop={handleDrop}\n          onDropRejected={handleDropRejected}\n          isSize=\"small\">\n          <span className=\"tech-info\">Drag and drop .xlsx, .csv file here(maximum 10MB)</span>\n        </DropZone>\n      }\n      {\n        headerFeedback && headerFeedback.status === 'loading' &&\n        <span>Validating Headers</span>\n      }\n      {\n        headerFeedback && headerFeedback.valid &&\n        <div style={{\n          display: 'flex',\n          justifyContent: 'space-between'\n          }}>\n          <span className=\"has-text-success has-text-weight-bold\">Headers of \"{flows.file.name}\" are valid</span>\n          <Button \n            isColor=\"info\" \n            onClick={handleNextStep}>\n              Next Step\n          </Button>\n        </div>\n      }\n      {\n        headerFeedback && !headerFeedback.valid && headerFeedback.type === 'ERROR_HEADER' &&\n        <div style={{\n          textAlign:'center'\n          }}>\n          <span className=\"has-text-danger has-text-weight-bold\">Headers of \"{flows.file.name}\" do not match schema fields, please fix your file and re-upload</span>\n          <HeaderValidation \n            headerNames = {headerFeedback.headerNames}\n            fieldNames = {headerFeedback.fieldNames}\n          />\n        </div>\n      }\n    </div>\n  )\n}\n\n\nconst mapStateToProps = state => ({\n  schema: state.repoData.descriptor && getResourceSchema(state),\n  flows: state.flows,\n  tables: state.repoData.tables,\n  headerFeedback: state.schemaValidation.headerFeedback\n })\n \n export default connect(mapStateToProps, {\n  importFlows,\n  setStep,\n  validateHeader\n })(FileUpload);\n","import FileUpload from './FileUpload'\n\nexport default FileUpload","\nimport XLSX from 'xlsx';\nimport {\n  csvParse,\n  csvParseRows,\n  tsvParse,\n} from 'd3-dsv';\n\nexport function parseTable( file ) {\n  return new Promise( ( resolve, reject ) => {\n    let reader = new FileReader();\n    reader.onload = ( event ) => {\n      let data;\n      if (file.name.split('.')[1] === 'csv') {\n        data = csvParseRows(event.target.result);\n      }\n      else {\n        data = tsvParse(event.target.result);\n      }\n      resolve(data);\n      reader = undefined;\n    };\n    reader.onerror = ( event ) => {\n      reject( event.target.error );\n      reader = undefined;\n    };\n    return reader.readAsText( file );\n  } );\n}\n\nexport function parseSheet( file ) {\n  return new Promise( (resolve, reject) => {\n    let reader = new FileReader();\n    // Handle errors loadrABS\n    reader.onload = ( event ) => {\n      const bstr = event.target.result;\n      const wb = XLSX.read(bstr, {\n        type: 'binary', \n        // raw: true //If true, plain text parsing will not parse values **\n      }); \n\t\t\t// Get first worksheet\n\t\t\tconst wsname = wb.SheetNames[0];\n\t\t\tconst ws = wb.Sheets[wsname];\n\t\t\t// Convert to \"2D Array\"\n      const data = XLSX.utils.sheet_to_json(ws, {\n        header: 1, \n        // raw: false, // use raw values (true) or formatted strings (false)\n        defval: '', // set null and undefined to empty string for validation\n        blankrows: false // skip blank rows\n      });\n      resolve(data)\n      reader = undefined;\n    };\n    reader.onerror = ( event ) => {\n      reject( event.target.error );\n      reader = undefined;\n    };\n    // Read file into memory as UTF-8\n    reader.readAsBinaryString( file );\n  })\n}","import React from 'react';\n\nimport {\n  Button,\n  Card,\n  Modal,\n  ModalBackground,\n  ModalContent,\n  ModalCard,\n  ModalCardBody,\n  ModalCardFooter,\n  ModalClose\n} from 'design-workshop';\n\nconst ConfirmationModal = ({\n  flows,\n  onSelectDiscard, \n  onSelectDownload,\n  isActive,\n  closeModal\n}) => {\n\n  const handleAction = (id, e) => {\n    switch(id) {\n      case 'cacnel':\n      default: \n        closeModal(); \n        break;\n      case 'download':\n        onSelectDownload();\n        break;\n      case 'discard':\n        onSelectDiscard();\n        break;\n    }\n  }\n  return (\n    <div>\n          <Modal isActive={isActive}>\n            <ModalBackground onClick={closeModal} />\n            <ModalContent>\n              <Card \n                // title=\"Modal title\" \n                bodyContent=\"Leave this step, you might lost your modification?\"\n                onAction = {handleAction}\n                footerActions={[\n                  {label: 'Download', id: 'download', isColor: 'success' }, \n                  {label: 'Discard', id: 'discard', isColor: 'danger'},\n                  {label: 'Cancel', id: 'cancel', isColor: 'info'},\n                ]} />\n            </ModalContent>\n            {/* <ModalCard>\n              <ModalCardBody>\n                You might lost your modification? \n              </ModalCardBody>\n              <ModalCardFooter>\n                  <Button isColor='success'>Download file to local</Button>\n                  <Button isColor=\"danger\">Discard</Button>\n                  <Button isColor='info'>Cancel</Button>\n              </ModalCardFooter>\n            </ModalCard> */}\n            <ModalClose onClick={closeModal} />\n          </Modal>\n    </div>\n  )\n}\n\nexport default ConfirmationModal","import React from 'react';\nimport {groupBy, sortBy} from 'lodash';\n\nimport {RANKED_FIELDS} from '../constants'\n\nconst OverviewTable = ({\n  className,\n  collectedErrors,\n}) => {\n  const columnNames = ['Field', 'Error Type', 'Error Overview']\n  const orderedErrors = sortBy(collectedErrors, (field) => {\n    return RANKED_FIELDS[field.name]\n  })\n  return (\n    <div style={{position: 'relative', width: '100%', height: '70vh'}}>\n      \n      <div className={`action-table ${className}`}>\n        <div className={'action-table-header'}>\n          {\n            columnNames.map((columnName, index) => {\n              return (\n                <div key={index} className=\"table-cell\">\n                  {columnName}\n                </div>\n              );\n            })\n          }\n        </div>\n        <div className={'action-table-main'}>\n          {\n            orderedErrors.map((field, rowIndex) => {\n              // const field = collectedErrors[errorKey];\n              const totalErrors = field.errors.length;\n              const groupedErrors = groupBy(field.errors, (v)=> {return v.value});\n              const distinctErrors = Object.keys(groupedErrors).length;\n              return (\n                <div key={rowIndex} className=\"table-row\">\n                  {\n                    columnNames.map((columnName, columnIndex) => {\n                      let cellValue;\n                      if(columnIndex === 0) cellValue = field.name;\n                      else if(columnIndex === 1) cellValue = field.errorType;\n                      else cellValue = `${totalErrors} rows affected in total, ${distinctErrors} different invalid values`\n                      return (<div key={columnIndex} className=\"table-cell\">{cellValue}</div>)\n                    })\n                  }\n                </div>\n              );\n            })\n          }\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default OverviewTable","import React from 'react';\nimport {connect} from 'react-redux';\nimport {groupBy, sortBy, values, max, min} from 'lodash';\n\nimport {RANKED_FIELDS} from '../../constants';\n\nimport {Button} from 'design-workshop';\nimport { \n  setStep\n} from '../../redux/modules/ui';\nimport {startModification} from '../../redux/modules/modification';\n\n// import FeedbackTable from '../../components/FeedbackTable';\n// import AggregatedTable from '../../components/AggregatedTable';\nimport OverviewTable from '../../components/OverviewTable';\n\nimport {validateTable, getRelations, getResourceSchema} from '../../redux/modules/schemaValidation';\n\nclass SchemaValidation extends React.Component {\n  componentDidMount () {\n    const {flows, schema, relations, schemaFeedback} = this.props;\n    if (!schemaFeedback) {\n      this.props.validateTable({source:flows, schema, relations});\n    }\n  }\n  render() {\n    const {schemaFeedback, modificationList} = this.props;\n    const re = /row\\s\\d*/;\n\n    const getOrderedErrors = (collectedErrors) => {\n      const errorsList = values(collectedErrors).reduce((res, item) => {\n        return res.concat(item.errors)\n      },[]);\n      \n      const groupedErrorsList = \n        values(groupBy(errorsList,(v) => {\n          if (v.field !== 'currency|year|reporting') return (v.field + v.value)\n          else {\n            const groupedValue = v.value.split('|')[0] + v.value.split('|')[2]\n            return v.field + groupedValue\n          }\n        }))\n        .map((errors, index)=> {\n          const fieldName = errors[0].field;\n          let yearRange;\n          if (fieldName === 'currency|year|reporting') {\n            const years = errors.map((error) => error.value.split('|')[1]);\n            yearRange = years.length > 0 ? `${min(years)}-${max(years)}` : years[0]\n          }\n          const value = fieldName !== 'currency|year|reporting' ? errors[0].value : `${errors[0].value.split('|')[0]}|${yearRange}|${errors[0].value.split('|')[2]}`\n          return {\n            index,\n            field: errors[0].field,\n            errorType: errors[0].errorType,\n            fixed: false,\n            message: errors[0].message.replace(re, `${errors.length} rows`),\n            value, \n            errors\n          }\n        });\n      return sortBy(groupedErrorsList, (field) => {\n        return RANKED_FIELDS[field.name]\n      });\n    }\n\n    const handlePrevStep = () => this.props.setStep({id: '0'})\n    const handleNextStep = () => {\n      if (!modificationList) {\n        const orderedErrors = getOrderedErrors(schemaFeedback.collectedErrors);\n        this.props.startModification(orderedErrors)\n      }\n      this.props.setStep({id: '2'});\n    }\n\n    return (\n      <div>\n        {\n          schemaFeedback && schemaFeedback.status === 'loading' &&\n          <span>{schemaFeedback.loader}</span>\n        }\n        {\n          schemaFeedback && !schemaFeedback.valid && schemaFeedback.collectedErrors &&\n          <div>\n            <span className=\"has-text-danger has-text-weight-bold\">\n              {/* Found format errors in {Object.keys(schemaFeedback.collectedErrors.formatErrors).length} columns, ForeignKey errors in {Object.keys(schemaFeedback.collectedErrors.foreignKeyErrors).length} columns, {schemaFeedback.errors.length} rows */}\n              Found errors in {schemaFeedback.errors.length} rows of {Object.keys(schemaFeedback.collectedErrors).length} fields\n            </span>\n            <OverviewTable collectedErrors={schemaFeedback.collectedErrors} />\n            <div style={{\n              display: 'flex',\n              justifyContent: 'space-between'\n            }}>\n              <Button \n                isColor=\"info\" \n                onClick={handlePrevStep}>\n                  Previous Step\n              </Button>\n              <Button \n                isColor=\"info\"\n                onClick={handleNextStep}>\n                  Review Errors\n              </Button>\n            </div>\n           \n          </div>\n        }\n        {\n          schemaFeedback && schemaFeedback.valid && <span className=\"has-text-success has-text-weight-bold\">Flows data is valid</span>\n        }\n      </div>\n    )\n  }\n}\nconst mapStateToProps = state => ({\n  flows: state.flows.data,\n  schema: getResourceSchema(state),\n  relations: getRelations(state),\n  schemaFeedback: state.schemaValidation.schemaFeedback,\n  modificationList: state.modification.modificationList\n})\n\nexport default connect(mapStateToProps, {\n  validateTable,\n  setStep,\n  startModification,\n})(SchemaValidation);","import SchemaValidation from './SchemaValidation'\n\nexport default SchemaValidation","import Layout from './Layout'\n\nexport default Layout","/* eslint-disable no-unused-vars */\nimport React from 'react';\n\nimport {\n    LayoutWrapper,\n    LayoutContainer,\n    LayoutNav,\n    LayoutFooter,\n    LayoutFooterColumn,\n    LayoutContent,\n    LayoutContentColumn,\n    LayoutHeader,\n    AppTitle,\n    RunningTitle,\n    Content,\n    ButtonContainer,\n    Button\n} from 'design-workshop';\n\nconst Layout = ({\n  steps, \n  selectedStep, \n  onSetStep,\n  children\n}) => {\n  return (\n    <LayoutWrapper hasConfig>\n      <LayoutHeader>\n        <AppTitle>Ricardo Data App</AppTitle>\n        <RunningTitle>{selectedStep.title}</RunningTitle>\n      </LayoutHeader>\n      <LayoutContainer>\n        <LayoutContent>\n          <LayoutContentColumn isConfig>\n            {steps.map((step, index) => {\n              const isSelectedStep = (selectedStep.id === step.id)\n              const isStepDisabled = step.id > selectedStep.id;\n              const handleClickStep = () => onSetStep(step)\n              return (\n                <ButtonContainer key={index} >\n                  <Button \n                    isColor={isSelectedStep ? \"info\" : null} \n                    isDisabled={isStepDisabled}\n                    onClick={handleClickStep}>\n                    {step.name}\n                  </Button>\n                </ButtonContainer>)\n              })\n            }\n          </LayoutContentColumn>\n          <LayoutContentColumn isWorkspace>\n            {children}\n          </LayoutContentColumn>\n        </LayoutContent>\n        <LayoutFooter>\n          <LayoutFooterColumn isSecondary>\n            <h3>médialab SciencesPo</h3>\n          </LayoutFooterColumn>\n          <LayoutFooterColumn isPrimary>\n            Ricardo Data App\n          </LayoutFooterColumn>\n        </LayoutFooter>\n      </LayoutContainer>\n    </LayoutWrapper>\n  )\n};\n\nexport default Layout;\n","/* eslint-disable no-unused-vars */\nimport React from 'react';\nimport {connect} from 'react-redux'\n\nimport DataModification from './containers/DataModification';\nimport DataPublish from './containers/DataPublish';\nimport FileUpload from './containers/FileUpload';\n\nimport ConfirmationModal from './components/ConfirmationModal';\n\nimport SchemaValidation from './containers/SchemaValidation';\nimport Layout from './containers/Layout';\n\nimport {downloadFile} from './utils/fileExporter';\n\nimport styles from 'design-workshop/themes/default/style.css';\nimport './App.css';\n\nimport { \n  setStep,\n  showModal,\n  hideModal\n} from './redux/modules/ui';\n\nimport { initTables } from './redux/modules/tables';\n\nconst App = ({\n  steps,\n  isModalDisplay,\n  selectedStep,\n  repoData,\n  flows,\n  modificationList,\n  //actions\n  initTables,\n  setStep,\n  showModal,\n  hideModal\n}) => {\n\n  const renderChildren = () => {\n    switch(selectedStep.id) {\n      case '0':\n      default:\n        return <FileUpload />;\n      case '1':\n        return <SchemaValidation />;\n      case '2':\n        return <DataModification />;\n      case '3':\n        return <DataPublish />;\n    }\n  }\n  const handleExport = () => {\n    const {file, data} = flows;\n    downloadFile(data, file.name, 'xlsx')\n  }\n\n  const handleSetStep = (step) => {\n    let fixed\n    if (modificationList) {\n      fixed = modificationList.filter((item) => item.fixed)\n    }\n    if(fixed && step.id === '0') showModal();\n    else setStep(step)\n  }\n\n  const handleDiscard = () => {\n    initTables(repoData.tables);\n    setStep(steps[0]);\n  }\n  \n  return (\n    <div className=\"App\">\n      <Layout \n        steps={steps}\n        selectedStep={selectedStep}\n        onSetStep={handleSetStep}>\n        {renderChildren()}\n      </Layout>\n      <ConfirmationModal \n        isActive={isModalDisplay}\n        onSelectDiscard={handleDiscard}\n        onSelectDownload={handleExport}\n        closeModal={hideModal} />\n    </div>\n  );\n}\n\n\nconst mapStateToProps = state => ({\n  steps: state.ui.steps,\n  isModalDisplay: state.ui.isModalDisplay,\n  flows: state.flows,\n  selectedStep: state.ui.selectedStep,\n  modificationList: state.modification.modificationList,\n  repoData: state.repoData\n })\n \n export default connect(mapStateToProps, {\n  initTables,\n  showModal,\n  hideModal,\n  setStep\n })(App);\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import { combineReducers } from 'redux'\nimport ui from './modules/ui';\nimport flows from './modules/flows';\nimport tables from './modules/tables';\nimport repoData from './modules/repoData';\nimport schemaValidation from './modules/schemaValidation';\nimport modification from './modules/modification';\nexport default combineReducers({\n  ui,\n  flows,\n  tables,\n  schemaValidation,\n  modification,\n  repoData\n})","import { createStore, applyMiddleware, compose } from 'redux'\nimport { persistStore, persistReducer } from 'redux-persist'\n// import storage from 'redux-persist/lib/storage' // defaults to localStorage for web\nimport * as storage from 'localforage';\n\nimport thunk from 'redux-thunk'\nimport rootReducer from './rootReducer'\n\nconst persistConfig = {\n  key: 'root',\n  storage,\n}\nconst persistedReducer = persistReducer(persistConfig, rootReducer)\n\n\nexport default function configureStore ( initialState = {} ) {\n  const enhancers = []\n  const middleware = [thunk]\n  \n  if (process.env.NODE_ENV === 'development') {\n    const devToolsExtension = window.__REDUX_DEVTOOLS_EXTENSION__\n  \n    if (typeof devToolsExtension === 'function') {\n      enhancers.push(devToolsExtension())\n    }\n  }\n  \n  const composedEnhancers = compose(\n    applyMiddleware(...middleware),\n    ...enhancers\n  )\n  \n  let store = createStore(\n    // rootReducer,\n    persistedReducer,\n    initialState,\n    composedEnhancers\n  )\n  let persistor = persistStore(store)\n  return { store, persistor }\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux'\n\nimport './index.css';\nimport App from './App';\n\nimport * as serviceWorker from './serviceWorker';\n\nimport configureStore from './redux/configureStore';\n\nconst initialState = {};\nconst {store} = configureStore(initialState);\n\n\nReactDOM.render(\n  <Provider store={store}>\n    <App />\n  </Provider>, \n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}