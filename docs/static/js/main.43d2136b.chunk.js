(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{362:function(e,t){},373:function(e,t,a){e.exports=a(966)},384:function(e,t,a){},620:function(e,t){},622:function(e,t){},654:function(e,t){},655:function(e,t){},780:function(e,t,a){var n={"./geojson.json":318,"./table-schema.json":781,"./topojson.json":319};function r(e){var t=i(e);return a(t)}function i(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=i,e.exports=r,r.id=780},843:function(e,t,a){var n={"./data-package.json":844,"./data-resource.json":845,"./fiscal-data-package.json":846,"./registry.json":847,"./tabular-data-package.json":848,"./tabular-data-resource.json":849};function r(e){var t=i(e);return a(t)}function i(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=i,e.exports=r,r.id=843},85:function(e){e.exports={a:"https://api.github.com/repos/medialab/ricardo_data/contents",b:"https://api.github.com/repos/medialab/ricardo_data/branches"}},914:function(e,t,a){var n={"./geojson.json":352,"./table-schema.json":915,"./topojson.json":353};function r(e){var t=i(e);return a(t)}function i(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=i,e.exports=r,r.id=914},962:function(e,t){},963:function(e,t){},965:function(e,t,a){},966:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(49),o=a.n(i),l=a(24),c=(a(384),a(28)),s=a(29),u=a(31),d=a(30),f=a(32),m=a(2),p=a(3),h=a(84),E=a(14),v="START_MODIFICATION",b={foreignKeyField:null,modificationIndex:0,modificationList:null},y=Object(h.a)(b,{SET_STEP:function(e,t){if("0"===t.payload.id)return b},START_MODIFICATION:function(e,t){var a=t.payload;e.modificationList=a,e.modificationIndex=0},REVALIDATE_ROWS_SUCCESS:function(e,t){var a=t.payload,n=a.fixedValues,r=a.orderedErrors.map(function(e){return(""+e.value).split("|")[0]+(""+e.value).split("|")[2]});e.modificationList.forEach(function(t,i){var o=r.indexOf((""+t.value).split("|")[0]+(""+t.value).split("|")[2]);-1!==o?e.modificationList[i]=Object(p.a)({},a.orderedErrors[o],{index:i}):"currency|year|reporting"===t.field&&(e.modificationList[i]=Object(p.a)({},e.modificationList[i],{fixed:!0,fixedValues:{currency:t.value.split("|")[0],year:n.year,reporting:t.value.split("|")[1]}}))})},REVALIDATE_ROWS_FAILURE:function(e,t){var a=t.payload,n=a.orderedErrors.map(function(e){return(""+e.value).split("|")[0]+(""+e.value).split("|")[2]});e.modificationList.forEach(function(t,r){var i=n.indexOf((""+t.value).split("|")[0]+(""+t.value).split("|")[2]);-1!==i&&(e.modificationList[r]=Object(p.a)({},a.orderedErrors[i],{index:r}))})},HIDE_MODIFICATION:function(e,t){e.modificationIndex=0},SELECT_ERROR:function(e,t){var a=t.payload;e.modificationIndex=a.index},GO_NEXT_ERROR:function(e,t){e.modificationIndex=e.modificationIndex+1},GO_PREV_ERROR:function(e,t){e.modificationIndex>0&&(e.modificationIndex=e.modificationIndex-1)},SUBMIT_MODIFICATION:function(e,t){var a=t.payload;e.modificationList[a.index]=Object(p.a)({},e.modificationList[a.index],a,{fixed:!0})}}),g="SET_STEP",O="HIDE_MODIFICATION",x="SELECT_ERROR",w="SHOW_CONFIRMATION_MODAL",S="HIDE_CONFIRMATION_MODAL",C=function(e){return{type:g,payload:e}},j=[{id:"0",name:"Upload file",title:"Choose a file"},{id:"1",name:"Schema Validation",title:"Schema validation against datapackage"},{id:"2",name:"Error Fixing",title:"Fix errors by fields"},{id:"3",name:"Export/Publish Data",title:"Export or Publish your data to Github"}],N={steps:j,isModalDisplay:!1,selectedStep:j[0],isModification:!1,fixedIndex:[]};var R={},k=Object(h.a)(R,{SET_STEP:function(e,t){if("0"===t.payload.id)return R},IMPORT_FLOWS:function(e,t){return t.payload},UPDATE_FLOWS:function(e,t){var a=t.payload,n=a.errors,r=a.fixedValues,i=Object.keys(r);n.forEach(function(t){i.forEach(function(a){var n=e.data[0].indexOf(a);e.data[t.rowNumber-1][n]=r[a]})})}}),F=a(11),_=a.n(F),T=a(102),A=a(25),I=a(199),D=a(367),L=a(61),V=a(68),B=a(51),M=a(85),H={id:0,flow:1,unit:2,year:3,species_bullions:4,transport_type:5,statistical_period:6,partner_sum:7,world_trade_type:8,notes:9,source:10,reporting:11,partner:12,"export_import|special_general":13,"currency|year|reporting":14},U=a(103),P="FETCH_DATAPACKAGE_SUCCESS",K="FETCH_TABLES_SUCCESS",G="FETCH_BRANCHES_SUCCESS",W="SELECT_BRANCH",z=[{name:"sources",path:"data/sources.csv"},{name:"currencies",path:"data/currencies.csv"},{name:"entity_names",path:"data/entity_names.csv"},{name:"expimp_spegen",path:"data/expimp_spegen.csv"}],Q={selectedBranch:"master"};var Y="VALIDATE_TABLE_REQUEST",q="VALIDATE_TABLE_SUCCESS",J="VALIDATE_TABLE_FAILURE",X="VALIDATE_HEADER_REQUEST",Z="VALIDATE_HEADER_SUCCESS",$="VALIDATE_HEADER_FAILURE",ee="REVALIDATE_ROWS_SUCCESS",te="REVALIDATE_ROWS_FAILURE",ae=function(e){return"string"===typeof e?e:e.join("|")},ne=function(e,t,a){var n=t.fields,r=t.foreignKeys,i=n.map(function(e){return e.name}),o=["source","export_import","special_general","currency"],l=n.filter(function(e){return-1===o.indexOf(e.name)}),c=r.map(function(e){return ae(e.fields)}),s=["ERROR_FORMAT","ERROR_FOREIGN_KEY"],u=l.reduce(function(e,t){return Object(p.a)({},e,Object(A.a)({},t.name,{name:t.name,schema:t,errorType:"ERROR_FORMAT",errors:[]}))},{}),d=r.reduce(function(e,t){var a=ae(t.fields);return Object(p.a)({},e,Object(A.a)({},a,Object(p.a)({name:a},t,{errorType:"ERROR_FOREIGN_KEY",errors:[]})))},{});return a.forEach(function(t){var a=e[t.rowNumber-1],n=t.rowNumber,r=t.originalRowNumber;s.forEach(function(e){var l=t.errors.find(function(t){return t.type===e});l&&("ERROR_FORMAT"===e?i.forEach(function(t,r){l.errors.forEach(function(i){if(i.columnNumber===r+1&&-1===o.indexOf(t)){var l={rowNumber:n,errorType:e,columnNumber:i.columnNumber,field:t,value:a[r],message:i.message};u[t].errors.push(l)}})}):"ERROR_FOREIGN_KEY"===e&&c.forEach(function(t){l.errors.forEach(function(o){var l=ae(o.columnName);if(l===t){var c=o.columnName.map(function(e){var t=i.indexOf(e);return a[t]}),s={rowNumber:n,originalRowNumber:r,errorType:e,columnName:o.columnName,field:l,value:c.join("|"),message:o.message};d[t].errors.push(s)}})}))})}),Object.keys(u).forEach(function(e){u[e].errors.length||delete u[e]}),Object.keys(d).forEach(function(e){d[e].errors.length||delete d[e]}),Object(p.a)({},u,d)},re={resourceName:"flows",schemaFeedback:null,headerFeedback:null,descriptor:null};var ie=function(e){return e.schemaValidation.resourceName},oe=function(e){return e.schemaValidation.descriptor.resources},le=/row\s\d*/,ce=function(e){var t=Object(E.values)(e).reduce(function(e,t){return e.concat(t.errors)},[]),a=Object(E.values)(Object(E.groupBy)(t,function(e){if("currency|year|reporting"!==e.field)return e.field+e.value;var t=e.value.split("|")[0]+e.value.split("|")[2];return e.field+t})).map(function(e,t){var a,n=e[0].field;if("currency|year|reporting"===n){var r=e.map(function(e){return e.value.split("|")[1]});a=r.length>0?"".concat(Object(E.min)(r),"-").concat(Object(E.max)(r)):r[0]}var i="currency|year|reporting"!==n?e[0].value:"".concat(e[0].value.split("|")[0],"|").concat(a,"|").concat(e[0].value.split("|")[2]);return{index:t,field:e[0].field,errorType:e[0].errorType,fixed:!1,message:e[0].message.replace(le,"".concat(e.length," rows")),value:i,errors:e}});return Object(E.sortBy)(a,function(e){return H[e.name]})},se=Object(I.a)(ie,oe,function(e,t){return t.find(function(t){return t.name===e}).schema}),ue=Object(I.a)(ie,oe,function(e){return e.tables.tables},function(e,t,a){var n=t.find(function(t){return t.name===e}),r={};return n.schema.foreignKeys.forEach(function(e){var t=e.reference.resource;r[t]=a[t]}),r}),de=function(e){var t=e.className,a=e.modificationList,n=e.onSelectError,i=["","Field","Value","Rows",""],o=a.find(function(e){return"year"===e.field&&!e.fixed});return r.a.createElement("div",{style:{position:"relative",width:"100%",height:"70vh"}},r.a.createElement("div",{className:"action-table ".concat(t)},r.a.createElement("div",{className:"action-table-header"},i.map(function(e,t){return r.a.createElement("div",{key:t,className:"table-cell"},r.a.createElement("span",{className:"Value"===e?"has-text-danger":"has-text-black"},e))})),r.a.createElement("div",{className:"action-table-main"},a.map(function(e,t){var a=e.field,l=e.errors,c=e.value,s=e.message,u=e.fixed,d=e.fixedValues,f=Object(E.values)(d).join("|"),p=function(){n(t)},h="currency|year|reporting"===e.field&&o;return r.a.createElement("div",{key:t,className:"table-row"},i.map(function(n,i){switch(i){case 0:default:return r.a.createElement("div",{key:i,className:"table-cell"},t+1);case 1:return r.a.createElement("div",{key:i,className:"table-cell"},a);case 2:return r.a.createElement("div",{key:i,className:"table-cell"},r.a.createElement("span",{className:"has-text-danger"},Object(E.isNull)(c)?"none":c),u&&r.a.createElement("span",{className:"has-text-success"},"->",""===f?"none":f),r.a.createElement(m.HelpPin,null,s));case 3:return r.a.createElement("div",{key:i,className:"table-cell"},r.a.createElement("span",{className:e.fixed?"has-text-success":"has-text-black"},l.length," ",e.fixed&&"rows affected"),r.a.createElement("br",null),e.fixedReferenceTable&&r.a.createElement("span",{className:"has-text-success"},'new row added to "',e.fixedReferenceTable,'" table'));case 4:return r.a.createElement("div",{key:i,className:"table-cell"},r.a.createElement(m.Button,{isDisabled:h,isOutlined:!0,isColor:e.fixed?"success":"info",onClick:p},e.fixed?"fixed":"fix error"))}}))}))))},fe=function(e){var t=e.className,a=e.flows,n=e.modificationItem,i=a[0],o=n.errors,l=n.field,c=n.value,s=n.fixedValues;return r.a.createElement("div",{style:{position:"relative",width:"100%",height:"20vh"}},r.a.createElement("div",{className:"action-table ".concat(t)},r.a.createElement("div",{className:"action-table-header"},i.map(function(e,t){var a=-1!==l.split("|").indexOf(e);return r.a.createElement("div",{key:t,className:"table-cell"},r.a.createElement("span",{className:a?"has-text-danger":"has-text-black"},e))})),r.a.createElement("div",{className:"action-table-main",style:{height:"100%"}},o.map(function(e,t){return r.a.createElement("div",{key:t,className:"table-row"},i.map(function(t,n){var i,o=-1!==l.split("|").indexOf(t),u=l.split("|").indexOf(t),d=(""+c).split("|")[u];return"year"===t&&1===u&&(d=a[e.rowNumber-1][n]),s&&o&&(i=0===s[t].length?"none":s[t]),r.a.createElement("div",{key:n,className:"table-cell",style:{wordBreak:"break-all"}},r.a.createElement("span",{className:o?"has-text-danger":"has-text-black"},o?d:a[e.rowNumber-1][n]),i&&r.a.createElement("span",{className:"has-text-success"},"->",i))}))}))))},me=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=e.map(function(e){return{label:e,value:e}});return t||a.unshift({value:"",label:"none"}),a},pe=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).hydrateState=function(){var e,t=a.props,n=t.modificationItem,r=t.fieldDescriptor,i=new L.Field(r),o=n.value;return n.fixedValues&&(o=n.fixedValues[i.name]),i.constraints&&i.constraints.enum&&(e=me(i.constraints.enum,i.constraints.required)),{fieldSchema:i,fixedValue:o,options:e,showSolving:!n.fixed,fieldValid:null}},a.validateField=function(e){var t=a.state.fieldSchema;try{t.castValue(e),a.setState({fixedValue:e,fieldValid:{valid:!0}})}catch(n){a.setState({fixedValue:e,fieldValid:{valid:!1,error:n}})}},a.handleChange=function(e){e.preventDefault(),a.validateField(e.target.value)},a.handleSubmitForm=function(){var e=a.props.modificationItem,t=a.state,n=t.fixedValue,r=t.fieldValid;if(r&&r.valid){var i=Object(A.a)({},e.field,n);a.props.onSubmitForm({fixedValues:i})}},a.handleShowSolving=function(){a.setState({showSolving:!0})},a.handleHideSolving=function(){a.setState({showSolving:!1})},a.state=a.hydrateState(),a}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidUpdate",value:function(e){if(this.props.modificationIndex!==e.modificationIndex){var t=this.hydrateState();this.setState(Object(p.a)({},t))}}},{key:"renderOriginal",value:function(){var e=this.props.modificationItem,t=e.value,a=e.message,n=e.field;return r.a.createElement(m.Field,null,r.a.createElement(m.Label,null,'Original value of "',n,'":'),r.a.createElement("strong",null,0===t.length?"none":t),r.a.createElement(m.Help,{isColor:"danger"},a))}},{key:"renderFixed",value:function(){var e=this.props.modificationItem,t=e.fixedValues,a=e.field,n=e.errors,i=0===t[a].length?"none":t[a];return r.a.createElement(m.Field,null,r.a.createElement(m.Label,{className:"has-text-success"},"Fixed with value"),r.a.createElement("strong",{className:"has-text-success"},i),r.a.createElement(m.Help,{isColor:"success"},"total ",n.length," rows affected"),r.a.createElement(m.Button,{isColor:"info",onClick:this.handleShowSolving},"Change this fix"))}},{key:"renderInput",value:function(){var e=this.props.modificationItem,t=e.value,a=e.errors,n=this.state,i=n.fieldSchema,o=n.fixedValue,l=n.fieldValid,c=!l||!l.valid,s=0===o.length?"none":o;return r.a.createElement("div",null,(!i.constraints||!i.constraints.enum)&&r.a.createElement(m.Field,null,r.a.createElement(m.Label,null,"Fix with a new input"),r.a.createElement(m.Control,null,r.a.createElement(m.Input,{value:this.state.fixedValue,onChange:this.handleChange})),null!==l&&!l.valid&&r.a.createElement(m.Help,{isColor:"danger"},l.error.message),!c&&r.a.createElement(m.Help,{isColor:"success"},"change ",t," to ",s,", total ",a.length," rows affected")),i.constraints&&i.constraints.enum&&r.a.createElement(m.Field,null,r.a.createElement(m.Label,null,'Select a value of "',i.name,'" from:'),r.a.createElement(m.Control,null,r.a.createElement(m.Select,{value:this.state.fixedValue,onChange:this.handleChange},this.state.options.map(function(e,t){return r.a.createElement("option",{key:t,value:e.value},e.label)})),!c&&r.a.createElement(m.Help,{isColor:"success"},"change ",t," to ",s,", total ",a.length," rows affected"))),r.a.createElement(m.Field,{isGrouped:!0},r.a.createElement(m.Control,null,r.a.createElement(m.Button,{isColor:"info",onClick:this.handleHideSolving},"Cancel")),r.a.createElement(m.Control,null,r.a.createElement(m.Button,{isColor:"info",isDisabled:c,onClick:this.handleSubmitForm},"Confirm this fix"))))}},{key:"render",value:function(){var e=this.props.modificationItem.fixed;return r.a.createElement("div",{style:{height:"60vh"}},r.a.createElement("form",null,r.a.createElement(m.Columns,null,r.a.createElement(m.Column,{isSize:"1/2"},this.renderOriginal(),e&&!this.state.showSolving&&this.renderFixed(),this.state.showSolving&&this.renderInput()))))}}]),t}(r.a.Component),he=a(370),Ee=["slug","export_import","special_general"],ve=["author","name","country","volume_date","volume_number","pages"],be=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).getStateFromProps=function(){var e,t=a.props,n=t.fieldDescriptor,r=t.fieldValue,i=new L.Field(n);return i.constraints&&i.constraints.enum&&(e=me(i.constraints.enum,i.constraints.required)),{fieldSchema:i,value:r,fieldValid:{valid:!1},options:e}},a.validateField=function(e){var t,n=a.state.fieldSchema;try{n.castValue(e),t={value:e,fieldValid:{valid:!0}},a.setState(t),a.props.onChange(Object(p.a)({fieldName:a.state.fieldSchema.name},t))}catch(r){t={value:e,fieldValid:{valid:!1,error:r}},a.setState(t),a.props.onChange(Object(p.a)({fieldName:a.state.fieldSchema.name},t))}},a.handleChange=function(e){a.validateField(e.target.value)},a.state=a.getStateFromProps(),a}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this.props,a=t.fieldDescriptor,n=t.fieldValue;"slug"===a.name&&n!==e.fieldValue&&this.validateField(n)}},{key:"render",value:function(){var e=this.state,t=e.fieldSchema,a=e.fieldValid,n=e.value;return r.a.createElement(m.Field,null,r.a.createElement(m.Label,null,t.name,t.constraints&&t.constraints.required&&r.a.createElement("span",null,"*")),-1!==Ee.indexOf(t.name)?r.a.createElement(m.Control,null,r.a.createElement("span",null,this.props.fieldValue)):r.a.createElement(m.Control,null,t.constraints&&t.constraints.enum?r.a.createElement(m.Select,{value:n,onChange:this.handleChange},this.state.options.map(function(e,t){return r.a.createElement("option",{key:t,value:e.value},e.label)})):r.a.createElement(m.Input,{value:n,onChange:this.handleChange})),a&&a.message&&r.a.createElement(m.Help,{isColor:"danger"},a.error.message))}}]),t}(r.a.Component),ye=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).getStateFromProps=function(){var e=a.props,t=e.resourceDescriptor,n=e.originalValue;return{fields:t.schema.fields.reduce(function(e,t){var a="",r=!0;t.constraints&&t.constraints.enum&&(a=t.constraints.enum[0]);return"export_import"===t.name&&(a=n.split("|")[0]),"special_general"===t.name&&(a=n.split("|")[1]),t.constraints&&t.constraints.required&&!t.constraints.enum&&(r=!1),Object(p.a)({},e,Object(A.a)({},t.name,{value:a,fieldValid:{valid:r}}))},{})}},a.getSlug=function(e){var t=Object(p.a)({},a.state.fields,Object(A.a)({},e.fieldName,e));return{fieldName:"slug",value:ve.reduce(function(e,a){var n=t[a].value||"";return e+Object(E.capitalize)(n)},"")}},a.handleFieldChange=function(e){if(a.state.fields.slug&&-1!==ve.indexOf(e.fieldName)){var t=a.getSlug(e);a.setState({fields:Object(p.a)({},a.state.fields,Object(A.a)({slug:t},e.fieldName,e))})}else a.setState({fields:Object(p.a)({},a.state.fields,Object(A.a)({},e.fieldName,e))})},a.state=a.getStateFromProps(),a}return Object(f.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props.resourceDescriptor,a=t.schema,n=Object(E.values)(this.state.fields).filter(function(e){return e.fieldValid&&!e.fieldValid.valid});return r.a.createElement("div",null,r.a.createElement("div",{style:{height:"40vh",overflow:"auto"}},r.a.createElement("h3",null,'Add a new row to "',t.name,'" table'),a.fields.map(function(t,a){return r.a.createElement(be,{key:a,fieldDescriptor:t,fieldValue:e.state.fields[t.name].value,onChange:e.handleFieldChange})})),r.a.createElement(m.Field,{isGrouped:!0},r.a.createElement(m.Control,null,r.a.createElement(m.Button,{isColor:"info",onClick:this.props.onCancel},"Cancel")),r.a.createElement(m.Control,null,r.a.createElement(m.Button,{isColor:"info",isDisabled:n.length>0,onClick:function(){var t=Object(E.mapValues)(e.state.fields,function(e){return e.value||""});e.props.onAddNew(t)}},"Add new"))))}}]),t}(r.a.Component),ge=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).initFixedValues=function(){return a.props.modificationItem.field.split("|").reduce(function(e,t){return Object(p.a)({},e,Object(A.a)({},t,""))},{})},a.hydrateState=function(){var e=a.props.modificationItem,t=a.initFixedValues();return e.fixedValues&&(t=e.fixedValues),{fixedValues:t,showNewForm:!1,newRow:null,showSolving:!e.fixed}},a.handleSubmitForm=function(){var e=a.props.foreignKeyField.reference.resource,t=a.state,n=t.fixedValues,r=t.newRow;a.props.onSubmitForm({fixedValues:n,fixedReferenceTable:r?e:null}),r&&a.props.onUpdateTable({row:r,resourceName:e})},a.handleClickCreate=function(){var e=a.initFixedValues();a.setState({fixedValues:e,showNewForm:!0,newRow:null})},a.handleAddNewRow=function(e){var t=a.props,n=t.modificationItem,r=t.foreignKeyField,i=n.field.split("|"),o=i.reduce(function(t,a,n){return Object(p.a)({},t,Object(A.a)({},a,i.length>1?e[r.reference.fields[n]]:e[r.reference.fields]))},{});a.setState({newRow:e,fixedValues:o,showNewForm:!1})},a.handleCancel=function(){a.setState({showNewForm:!1,newRow:null})},a.handleSelectExist=function(e){var t=a.props.modificationItem;e?a.setState({fixedValues:Object(A.a)({},t.field,e.value),newRow:null}):a.setState({fixedValues:Object(A.a)({},t.field,"")})},a.handleShowSolving=function(){a.setState({showSolving:!0})},a.handleHideSolving=function(){a.setState({showSolving:!1})},a.state=a.hydrateState(),a}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidUpdate",value:function(e){if(this.props.modificationIndex!==e.modificationIndex){var t=this.hydrateState();this.setState(Object(p.a)({},t))}}},{key:"renderFixed",value:function(){var e=this.props,t=e.modificationItem,a=e.foreignKeyField,n=t.fixedValues,i=Object(E.values)(n).join("|"),o=i.length?i:"none",l=a.reference.resource;return r.a.createElement(m.Field,null,r.a.createElement(m.Label,{className:"has-text-success"},"Fixed with value"),r.a.createElement("strong",{className:"has-text-success"},o),r.a.createElement(m.Help,{isColor:"success"},r.a.createElement("li",null,"total ",t.errors.length," rows affected"),r.a.createElement("li",null,'new row will be added to "',l,'" table')),r.a.createElement("br",null),r.a.createElement(m.Button,{isColor:"info",onClick:this.handleShowSolving},"Change this fix"))}},{key:"renderSolving",value:function(){var e=this.props,t=e.modificationItem,a=e.foreignKeyField,n=e.tables,i=t.field,o=t.fixedReferenceTable,l=a.reference.resource,c=a.reference.fields,s=function(e){return{value:e,label:e}},u=this.state.newRow?s(""):s(this.state.fixedValues[i]);return r.a.createElement("div",null,"source"===t.field&&r.a.createElement(m.Field,null,r.a.createElement(m.Label,null,"Select from exist sources"),r.a.createElement(he.a,{isSearchable:!0,isClearable:!0,value:u,onChange:this.handleSelectExist,options:n[l].map(function(e){return{value:e[c],label:e[c]}})}),""!==u.value&&!o&&r.a.createElement(m.Help,{isColor:"success"},r.a.createElement("li",null,'change "',t.value,'" to "',Object(E.values)(this.state.fixedValues).join("|"),'"'),r.a.createElement("li",null,"total ",t.errors.length," rows affected"))),r.a.createElement(m.Field,null,r.a.createElement(m.Control,null,r.a.createElement(m.Label,null,"Not found one"),r.a.createElement(m.Button,{isColor:"info",onClick:this.handleClickCreate},"Create new item"),this.state.newRow&&r.a.createElement(m.Help,{isColor:"success"},r.a.createElement("li",null,'change "',t.value,'" to "',Object(E.values)(this.state.fixedValues).join("|"),'"'),r.a.createElement("li",null,"total ",t.errors.length," rows affected"),r.a.createElement("li",null,'new row will be added to "',l,'" table')))))}},{key:"render",value:function(){var e=this.state,t=(e.newRow,e.fixedValues),a=this.props,n=a.modificationItem,i=a.foreignKeyField,o=a.descriptor,l=n.value,c=n.message,s=n.field,u=i.reference.resource,d=o.resources.find(function(e){return e.name===u}),f=function(e){return{value:e,label:e}},p=this.state.newRow?f(""):f(t[s]),h=this.state.newRow||p.value;return r.a.createElement("div",{style:{height:"60vh"}},r.a.createElement("form",null,r.a.createElement(m.Columns,null,r.a.createElement(m.Column,{isSize:"1/2"},r.a.createElement(m.Field,null,r.a.createElement(m.Label,null,'Original value of "',s,'":'),r.a.createElement("div",{className:"has-text-danger"},l),r.a.createElement(m.Help,{isColor:"danger"},c)),!this.state.showSolving&&this.renderFixed(),this.state.showSolving&&this.renderSolving()),this.state.showNewForm&&("source"===n.field||"export_import|special_general"===n.field)&&r.a.createElement(m.Column,{isSize:"1/2",className:"new-resource-form",style:{flex:"auto"}},r.a.createElement(ye,{originalValue:n.value,resourceDescriptor:d,onCancel:this.handleCancel,onAddNew:this.handleAddNewRow}))),this.state.showSolving&&r.a.createElement(m.Field,{isGrouped:!0},r.a.createElement(m.Control,null,r.a.createElement(m.Button,{isColor:"info",onClick:this.handleHideSolving},"Cancel")),r.a.createElement(m.Control,null,h&&r.a.createElement(m.Button,{isColor:"info",onClick:this.handleSubmitForm},"Confirm this fix")))))}}]),t}(r.a.Component),Oe=Object(l.b)(null,{validateResource:function(e){return function(t){var a=e.descriptor;t(Object(T.a)(_.a.mark(function e(){var n;return _.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=D.Resource.load(a),e.next=4,n.read();case 4:t({type:"VALIDATE_RESOURCE_SUCCESS",payload:{valid:!0}}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0),e.t0.multiple?t({type:"VALIDATE_RESOURCE_FAILURE",payload:{rowNumber:e.t0.rowNumber,messages:e.t0.errors.map(function(e){return Object(p.a)({},e,{message:e.message})})}}):t({type:"VALIDATE_RESOURCE_FAILURE",payload:{rowNumber:e.t0.rowNumber,messages:[Object(p.a)({},e.t0,{message:e.t0.message})]}});case 11:case"end":return e.stop()}},e,null,[[0,7]])})))}}})(ge),xe=Object(h.a)({},{INIT_TABLES:function(e,t){var a=t.payload,n={};Object.keys(a).forEach(function(e){n[e]=Object(B.b)(V.Base64.decode(a[e].content),function(e){return e.year?Object(p.a)({},e,{year:+e.year}):e})}),e.tables=n},FETCH_TABLES_SUCCESS:function(e,t){var a=t.payload,n={};Object.keys(a).forEach(function(e){n[e]=Object(B.b)(V.Base64.decode(a[e].content),function(e){return e.year?Object(p.a)({},e,{year:+e.year}):e})}),e.tables=n},UPDATE_TABLE:function(e,t){var a=t.payload,n=a.row,r=a.resourceName,i=e.tables[r].slice();i.splice(i.length,0,n),e.tables[r]=i}}),we=Object(l.b)(function(e){return{descriptor:e.schemaValidation.descriptor,tables:e.tables.tables}},{updateTable:function(e){return{type:"UPDATE_TABLE",payload:e}}})(function(e){e.className;var t=e.flows,a=e.tables,n=e.descriptor,i=e.schema,o=e.modificationItem,l=e.modificationIndex,c=e.onSubmitModification,s=e.updateTable,u=function(e){var t=e.fixedValues,a=e.fixedReferenceTable;return c(Object(p.a)({},o,{fixedValues:t,fixedReferenceTable:a,index:l}))};return r.a.createElement("div",null,"ERROR_FORMAT"===o.errorType&&r.a.createElement(pe,{fieldDescriptor:function(){var e=o.field;return i.fields.find(function(t){return t.name===e})}(),modificationItem:o,modificationIndex:l,onSubmitForm:u}),"ERROR_FOREIGN_KEY"===o.errorType&&r.a.createElement(Oe,{schema:i,descriptor:n,foreignKeyField:function(){var e;if(-1!==o.field.indexOf("|")){var t=o.field.split("|");e=i.foreignKeys.find(function(e){return Object(E.isEqual)(e.fields,t)})}else e=i.foreignKeys.find(function(e){return e.fields===o.field});return e}(),tables:a,modificationItem:o,modificationIndex:l,onUpdateTable:s,onSubmitForm:u}),r.a.createElement(fe,{flows:t,modificationItem:o}))}),Se=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.flows,n=t.schema,i=t.isModification,o=t.modificationIndex,l=t.modificationList,c=t.schemaFeedback,s=l.filter(function(e){return!1===e.fixed}),u=function(t){t<l.length&&e.props.selectError({index:t})};return r.a.createElement("div",null,!i&&r.a.createElement("div",null,l.length>0&&r.a.createElement("div",{className:"has-text-danger has-text-weight-bold"},l.length," different errors need to modify"),l&&r.a.createElement(de,{modificationList:l,onSelectError:u}),r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement(m.Button,{isColor:"info",onClick:function(){return e.props.setStep({id:"1"})}},"Previous Step"),0===s.length?r.a.createElement(m.Button,{isColor:"info",onClick:function(){return e.props.setStep({id:"3"})}},"Ready to publish"):r.a.createElement(m.Button,{isColor:"info",onClick:function(){e.props.selectError({index:s[0].index})}},"Start fix error"))),i&&r.a.createElement("div",null,r.a.createElement(we,{flows:a,schema:n,modificationIndex:o,modificationItem:l[o],onSubmitModification:function(t){var a=e.props,n=a.schema,r=a.flows,i=a.tables,o=t.index,d=t.errors;if(e.props.submitModification(t),e.props.updateFlows(t),"year"===t.field){var f=d.map(function(e){return e.rowNumber}),m=r[0].indexOf("year"),p=[r[0]].concat(d.map(function(e){var a=r[e.rowNumber];return a[m]=t.fixedValues.year,a})),h={currencies:i.currencies},E=c.collectedErrors["currency|year|reporting"].errors;e.props.revalidateRows({fixedValues:t.fixedValues,rowNumbers:f,source:p,schema:n,relations:h,prevErrors:E})}o+1<l.length&&s.length>0?u(o+1):e.props.hideModification()}}),r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement("div",null,r.a.createElement(m.Button,{isColor:"info",onClick:this.props.hideModification},"Back to summary")),r.a.createElement("span",{className:"has-text-danger has-text-weight-bold"},o+1," / ",l.length),r.a.createElement("div",null,0!==o&&r.a.createElement(m.Button,{isColor:"info",style:{marginLeft:"10px"},onClick:function(){o>0&&e.props.goPrevError()}},"Prev Error"),o!==l.length-1&&r.a.createElement(m.Button,{isColor:"info",style:{marginLeft:"10px"},onClick:function(){o<l.length-1&&e.props.goNextError()}},"Next Error")))))}}]),t}(r.a.Component),Ce=Object(l.b)(function(e){return{flows:e.flows.data,tables:e.tables.tables,schema:se(e),schemaFeedback:e.schemaValidation.schemaFeedback,modificationList:e.modification.modificationList,isModification:e.ui.isModification,modificationIndex:e.modification.modificationIndex}},{setStep:C,updateFlows:function(e){return{type:"UPDATE_FLOWS",payload:e}},revalidateRows:function(e){return function(t){var a=e.rowNumbers,n=e.fixedValues,r=e.source,i=e.schema,o=e.relations,l=e.prevErrors;t({type:"REVALIDATE_ROWS_REQUEST",payload:Object(p.a)({},e,{status:"loading"})}),t(Object(T.a)(_.a.mark(function e(){var c,s,u,d,f,m,h,E;return _.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,L.Table.load(r,{schema:i});case 3:return c=e.sent,e.next=6,c.read({forceCast:!0,relations:o});case 6:(s=e.sent).forEach(function(e,t){e.errors&&(e.originalRowNumber=a[t])}),u=s.filter(function(e){return e.errors}),(m=ne(r,i,u))&&m["currency|year|reporting"]?(m["currency|year|reporting"].errors.forEach(function(e){return e.rowNumber=e.originalRowNumber}),h=m["currency|year|reporting"].errors,E=h.map(function(e){return e.rowNumber}),d=l.map(function(e){return-1!==E.indexOf(e.rowNumber)?h.find(function(t){return t.rowNumber===e.rowNumber}):e}),f=ce({"currency|year|reporting":Object(p.a)({},m["currency|year|reporting"],{errors:d})}),t({type:te,payload:{status:"done",valid:!1,newErrors:d,orderedErrors:f}})):(d=l.filter(function(e){return-1===a.indexOf(e.rowNumber)}),f=ce({"currency|year|reporting":{errors:d}}),d.length?t({type:ee,payload:{status:"done",valid:!1,fixedValues:n,newErrors:d,orderedErrors:f}}):t({type:ee,payload:{rowNumbers:a,status:"done",valid:!0,fixedValues:n,newErrors:d,orderedErrors:f}})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error(e.t0),t({type:te,payload:{status:"done",valid:!1,error:e.t0}});case 17:case"end":return e.stop()}},e,null,[[0,13]])})))}},hideModification:function(){return{type:O}},selectError:function(e){return{type:x,payload:e}},goNextError:function(){return{type:"GO_NEXT_ERROR"}},goPrevError:function(){return{type:"GO_PREV_ERROR"}},submitModification:function(e){return{type:"SUBMIT_MODIFICATION",payload:e}}})(Se),je=a(62),Ne=a.n(je),Re=a(368),ke=a.n(Re);function Fe(e,t,a){var n,r=e[0];switch(a){case"csv":var i=Object(B.a)(e);n=new File([i],t,{type:"text/csv;charset=utf-8"}),ke.a.saveAs(n);break;case"xlsx":default:var o=Ne.a.utils.aoa_to_sheet(e,{header:r}),l=Ne.a.utils.book_new();Ne.a.utils.book_append_sheet(l,o,"SheetJS"),Ne.a.writeFile(l,t)}}var _e=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(m.Button,{onClick:function(){var t=e.props.flows,a=t.file;Fe(t.data,a.name,"xlsx")}},"Export fixed data"))}}]),t}(r.a.Component),Te=Object(l.b)(function(e){return{flows:e.flows}},{exportFlows:function(e){return{type:"EXPORT_FLOWS"}}})(_e),Ae=a(371),Ie=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.props.fetchDatapackage(),this.props.fetchBranches()}},{key:"render",value:function(){var e=this,t=this.props.repoData,a=t.branches,n=t.selectedBranch,i=t.tables;return r.a.createElement("div",null,a&&r.a.createElement("div",null,r.a.createElement(m.Label,null,"Get tables from ",n," branch"),r.a.createElement(m.Select,{value:n,onChange:function(t){e.props.selectBranch({branch:t.target.value})}},a.map(function(e,t){return r.a.createElement("option",{key:t},e.name)})),r.a.createElement(m.Button,{isColor:"info",onClick:function(){e.props.fetchAllTables({branch:n})}},"Fetch"),i&&r.a.createElement(m.Help,{isColor:"success"},"tables from ",n," branch are loaded")))}}]),t}(r.a.Component),De=Object(l.b)(function(e){return{repoData:e.repoData}},{fetchBranches:function(e){return function(t){return t({type:"FETCH_BRANCHES_REQUEST",payload:e}),Object(U.get)(M.b).then(function(a){return t({type:G,payload:Object(p.a)({},e,{branches:a.data})})}).catch(function(a){return t({type:"FETCH_BRANCHES_FAILURE",payload:e,error:a})})}},selectBranch:function(e){return{type:W,payload:e}},fetchAllTables:function(e){return function(t){var a=e.branch;t({type:"FETCH_TABLES_REQUEST"}),Promise.all(z.map(function(e){return Object(U.get)("".concat(M.a,"/").concat(e.path,"?ref=").concat(a))})).then(function(e){var a={};e.forEach(function(e){var t=e.data.name.split(".")[0];a[t]=e.data}),t({type:K,payload:a})}).catch(function(a){return t({type:"FETCH_TABLES_FAILURE",payload:e,error:a})})}},fetchDatapackage:function(){return function(e){return e({type:"FETCH_DATAPACKAGE_REQUEST"}),Object(U.get)("".concat(M.a,"/datapackage.json?ref=master")).then(function(t){return e({type:P,payload:t.data})}).catch(function(t){return e({type:"FETCH_DATAPACKAGE_FAILURE",error:t})})}}})(Ie),Le=function(e){var t,a=e.headerNames,n=e.fieldNames,i=a.length-n.length;t=i>0?Object(E.difference)(a,n):Object(E.difference)(n,a);var o=a.map(function(e,t){return n[t]&&n[t]===e?{name:e,valid:!0}:{name:e,valid:!1}});return r.a.createElement("div",{style:{}},t.length===i&&i>0&&r.a.createElement("div",{className:"has-text-danger"},r.a.createElement("span",null,"Extra headers - "),t.map(function(e){return r.a.createElement("span",null,'"',e,'" ')})),t.length===Math.abs(i)&&i<0&&r.a.createElement("div",{className:"has-text-danger has-text-weight-bold"},r.a.createElement("span",null,"Missing headers - "),t.map(function(e){return r.a.createElement("span",null,'"',e,'" ')})),r.a.createElement("div",{style:{display:"flex",justifyContent:"space-evenly"}},r.a.createElement("div",null,r.a.createElement("div",{className:"has-text-weight-bold"},"headers "),o.map(function(e,t){return r.a.createElement("div",{key:t,className:e.valid?"has-text-black":"has-text-danger"},e.name)})),r.a.createElement("div",null,r.a.createElement("div",{className:"has-text-weight-bold"},"schema fields"),n.map(function(e,t){return r.a.createElement("div",{key:t},e)}))))};var Ve=Object(l.b)(function(e){return{schema:e.repoData.descriptor&&se(e),flows:e.flows,tables:e.repoData.tables,headerFeedback:e.schemaValidation.headerFeedback}},{importFlows:function(e){return{type:"IMPORT_FLOWS",payload:e}},setStep:C,validateHeader:function(e){return function(t){var a=e.source,n=e.schema;t({type:X,payload:Object(p.a)({},e,{status:"loading"})}),t(Object(T.a)(_.a.mark(function e(){var r;return _.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,L.Table.load(a.slice(0,2),{schema:n});case 3:return r=e.sent,e.next=6,r.read({limit:1});case 6:t({type:Z,payload:{status:"done",valid:!0,headers:r.headers}}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0),"ERROR_HEADER"!==e.t0.type?t({type:Z,payload:{status:"done",valid:!0,headers:r.headers}}):t({type:$,valid:!1,status:"done",payload:e.t0});case 13:case"end":return e.stop()}},e,null,[[0,9]])})))}}})(function(e){var t=e.schema,a=e.tables,n=e.flows,i=e.headerFeedback,o=e.setStep,l=e.importFlows,c=e.validateHeader;return r.a.createElement("div",null,r.a.createElement(De,null),a&&r.a.createElement(m.DropZone,{maxSize:1e7,onDrop:function(e){var a=Object(Ae.a)(e,1)[0];"xlsx"===a.name.split(".")[1]?function(e){return new Promise(function(t,a){var n=new FileReader;n.onload=function(e){var a=e.target.result,r=Ne.a.read(a,{type:"binary"}),i=r.SheetNames[0],o=r.Sheets[i],l=Ne.a.utils.sheet_to_json(o,{header:1,defval:"",blankrows:!1});t(l),n=void 0},n.onerror=function(e){a(e.target.error),n=void 0},n.readAsBinaryString(e)})}(a).then(function(e){l({file:{name:a.name},data:e}),c({source:e,schema:t})}).catch(function(e){console.error(e),console.error("fail to parse file")}):function(e){return new Promise(function(t,a){var n=new FileReader;return n.onload=function(a){var r;r="csv"===e.name.split(".")[1]?Object(B.c)(a.target.result):Object(B.d)(a.target.result),t(r),n=void 0},n.onerror=function(e){a(e.target.error),n=void 0},n.readAsText(e)})}(a).then(function(e){l({file:{name:a.name},data:e}),c({source:e,schema:t})}).catch(function(e){return console.error("fail to parse file")})},onDropRejected:function(e,t){console.log("file is invalid")},isSize:"small"},r.a.createElement("span",{className:"tech-info"},"Drag and drop .xlsx, .csv file here(maximum 10MB)")),i&&"loading"===i.status&&r.a.createElement("span",null,"Validating Headers"),i&&i.valid&&r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement("span",{className:"has-text-success has-text-weight-bold"},'Headers of "',n.file.name,'" are valid'),r.a.createElement(m.Button,{isColor:"info",onClick:function(){return o({id:"1"})}},"Next Step")),i&&!i.valid&&"ERROR_HEADER"===i.type&&r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("span",{className:"has-text-danger has-text-weight-bold"},'Headers of "',n.file.name,'" do not match schema fields, please fix your file and re-upload'),r.a.createElement(Le,{headerNames:i.headerNames,fieldNames:i.fieldNames})))}),Be=function(e){e.flows;var t=e.onSelectDiscard,a=e.onSelectDownload,n=e.isActive,i=e.closeModal;return r.a.createElement("div",null,r.a.createElement(m.Modal,{isActive:n},r.a.createElement(m.ModalBackground,{onClick:i}),r.a.createElement(m.ModalContent,null,r.a.createElement(m.Card,{bodyContent:"Leave this step, you might lost your modification?",onAction:function(e,n){switch(e){case"cacnel":default:i();break;case"download":a();break;case"discard":t()}},footerActions:[{label:"Download",id:"download",isColor:"success"},{label:"Discard",id:"discard",isColor:"danger"},{label:"Cancel",id:"cancel",isColor:"info"}]})),r.a.createElement(m.ModalClose,{onClick:i})))},Me=function(e){var t=e.className,a=e.collectedErrors,n=["Field","Error Type","Error Overview"],i=Object(E.sortBy)(a,function(e){return H[e.name]});return r.a.createElement("div",{style:{position:"relative",width:"100%",height:"70vh"}},r.a.createElement("div",{className:"action-table ".concat(t)},r.a.createElement("div",{className:"action-table-header"},n.map(function(e,t){return r.a.createElement("div",{key:t,className:"table-cell"},e)})),r.a.createElement("div",{className:"action-table-main"},i.map(function(e,t){var a=e.errors.length,i=Object(E.groupBy)(e.errors,function(e){return e.value}),o=Object.keys(i).length;return r.a.createElement("div",{key:t,className:"table-row"},n.map(function(t,n){var i;return i=0===n?e.name:1===n?e.errorType:"".concat(a," rows affected in total, ").concat(o," different invalid values"),r.a.createElement("div",{key:n,className:"table-cell"},i)}))}))))},He=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.flows,a=e.schema,n=e.relations;e.schemaFeedback||this.props.validateTable({source:t,schema:a,relations:n})}},{key:"render",value:function(){var e=this,t=this.props,a=t.schemaFeedback,n=t.modificationList;return r.a.createElement("div",null,a&&"loading"===a.status&&r.a.createElement("span",null,a.loader),a&&!a.valid&&a.collectedErrors&&r.a.createElement("div",null,r.a.createElement("span",{className:"has-text-danger has-text-weight-bold"},"Found errors in ",a.errors.length," rows of ",Object.keys(a.collectedErrors).length," fields"),r.a.createElement(Me,{collectedErrors:a.collectedErrors}),r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement(m.Button,{isColor:"info",onClick:function(){return e.props.setStep({id:"0"})}},"Previous Step"),r.a.createElement(m.Button,{isColor:"info",onClick:function(){if(!n){var t=ce(a.collectedErrors);e.props.startModification(t)}e.props.setStep({id:"2"})}},"Review Errors"))),a&&a.valid&&r.a.createElement("span",{className:"has-text-success has-text-weight-bold"},"Flows data is valid"))}}]),t}(r.a.Component),Ue=Object(l.b)(function(e){return{flows:e.flows.data,schema:se(e),relations:ue(e),schemaFeedback:e.schemaValidation.schemaFeedback,modificationList:e.modification.modificationList}},{validateTable:function(e){return function(t){var a=e.source,n=e.schema,r=e.relations;t(Object(T.a)(_.a.mark(function e(){return _.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.delegateYield(_.a.mark(function e(){var i,o,l,c,s;return _.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=a.length,o=100,l=0,c=[],s=_.a.mark(function e(){var i,s,u,d,f;return _.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:Y,payload:{status:"loading",loader:"validating ".concat(l," rows")}}),i=l/o,s=[a[0]].concat(a.slice(l+1-i,l+o-i)),e.next=5,L.Table.load(s,{schema:n});case 5:return u=e.sent,e.next=8,u.read({forceCast:!0,relations:r});case 8:d=e.sent,(f=d.filter(function(e){return e.errors})).length&&(f.forEach(function(e){e.rowNumber=e.rowNumber+o*i-i}),c=c.concat(f));case 11:case"end":return e.stop()}},e)});case 6:if(!(l<i)){e.next=11;break}return e.delegateYield(s(),"t0",8);case 8:l+=o,e.next=6;break;case 11:c.length?t({type:J,payload:{status:"done",valid:!1,errors:c,collectedErrors:ne(a,n,c)}}):t({type:q,payload:{status:"done",valid:!0}});case 12:case"end":return e.stop()}},e)})(),"t0",2);case 2:e.next=8;break;case 4:e.prev=4,e.t1=e.catch(0),console.error(e.t1),t({type:J,payload:e.t1});case 8:case"end":return e.stop()}},e,null,[[0,4]])})))}},setStep:C,startModification:function(e){return{type:v,payload:e}}})(He),Pe=function(e){var t=e.steps,a=e.selectedStep,n=e.onSetStep,i=e.children;return r.a.createElement(m.LayoutWrapper,{hasConfig:!0},r.a.createElement(m.LayoutHeader,null,r.a.createElement(m.AppTitle,null,"Ricardo Data App"),r.a.createElement(m.RunningTitle,null,a.title)),r.a.createElement(m.LayoutContainer,null,r.a.createElement(m.LayoutContent,null,r.a.createElement(m.LayoutContentColumn,{isConfig:!0},t.map(function(e,t){var i=a.id===e.id,o=e.id>a.id;return r.a.createElement(m.ButtonContainer,{key:t},r.a.createElement(m.Button,{isColor:i?"info":null,isDisabled:o,onClick:function(){return n(e)}},e.name))})),r.a.createElement(m.LayoutContentColumn,{isWorkspace:!0},i)),r.a.createElement(m.LayoutFooter,null,r.a.createElement(m.LayoutFooterColumn,{isSecondary:!0},r.a.createElement("h3",null,"m\xe9dialab SciencesPo")),r.a.createElement(m.LayoutFooterColumn,{isPrimary:!0},"Ricardo Data App"))))},Ke=(a(964),a(965),Object(l.b)(function(e){return{steps:e.ui.steps,isModalDisplay:e.ui.isModalDisplay,flows:e.flows,selectedStep:e.ui.selectedStep,modificationList:e.modification.modificationList,repoData:e.repoData}},{initTables:function(e){return{type:"INIT_TABLES",payload:e}},showModal:function(){return{type:w}},hideModal:function(){return{type:S}},setStep:C})(function(e){var t=e.steps,a=e.isModalDisplay,n=e.selectedStep,i=e.repoData,o=e.flows,l=e.modificationList,c=e.initTables,s=e.setStep,u=e.showModal,d=e.hideModal;return r.a.createElement("div",{className:"App"},r.a.createElement(Pe,{steps:t,selectedStep:n,onSetStep:function(e){var t;l&&(t=l.filter(function(e){return e.fixed})),t&&"0"===e.id?u():s(e)}},function(){switch(n.id){case"0":default:return r.a.createElement(Ve,null);case"1":return r.a.createElement(Ue,null);case"2":return r.a.createElement(Ce,null);case"3":return r.a.createElement(Te,null)}}()),r.a.createElement(Be,{isActive:a,onSelectDiscard:function(){c(i.tables),s(t[0])},onSelectDownload:function(){var e=o.file;Fe(o.data,e.name,"xlsx")},closeModal:d}))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ge=a(20),We=a(200),ze=a(369),Qe=a(138),Ye=Object(Ge.combineReducers)({ui:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0,a=t.payload;switch(t.type){case g:return Object(p.a)({},N,{selectedStep:j.find(function(e){return a.id===e.id})});case w:return Object(p.a)({},e,{isModalDisplay:!0});case S:return Object(p.a)({},e,{isModalDisplay:!1});case v:return Object(p.a)({},e,{isModification:!0});case O:return Object(p.a)({},e,{isModification:!1});case x:return Object(p.a)({},e,{isModification:!0});default:return e}},flows:k,tables:xe,schemaValidation:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re,t=arguments.length>1?arguments[1]:void 0,a=t.payload;switch(t.type){case g:return"0"===a.id?Object(p.a)({},e,{schemaFeedback:null,headerFeedback:null}):e;case P:return Object(p.a)({},e,{descriptor:JSON.parse(V.Base64.decode(a.content))});case ee:return Object(p.a)({},e,{schemaFeedback:Object(p.a)({},e.schemaFeedback,{collectedErrors:Object(p.a)({},e.schemaFeedback.collectedErrors,{"currency|year|reporting":null})})});case te:return a.newErrors?Object(p.a)({},e,{schemaFeedback:Object(p.a)({},e.schemaFeedback,{collectedErrors:Object(p.a)({},e.schemaFeedback.collectedErrors,{"currency|year|reporting":{errors:a.newErrors}})})}):e;case X:case $:case Z:return Object(p.a)({},e,{headerFeedback:a});case Y:case J:case q:return Object(p.a)({},e,{schemaFeedback:a});default:return e}},modification:y,repoData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,t=arguments.length>1?arguments[1]:void 0,a=t.payload;switch(t.type){case K:return Object(p.a)({},e,{tables:a});case P:return Object(p.a)({},e,{datapackage:a,descriptor:JSON.parse(V.Base64.decode(a.content))});case G:return Object(p.a)({},e,{branches:a.branches});case W:return Object(p.a)({},e,{selectedBranch:a.branch,tables:null});default:return e}}}),qe={key:"root",storage:ze},Je=Object(We.a)(qe,Ye);var Xe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[Qe.a],a=Ge.compose.apply(void 0,[Ge.applyMiddleware.apply(void 0,t)].concat([])),n=Object(Ge.createStore)(Je,e,a);return{store:n,persistor:Object(We.b)(n)}}({}).store;o.a.render(r.a.createElement(l.a,{store:Xe},r.a.createElement(Ke,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[373,1,2]]]);
//# sourceMappingURL=main.43d2136b.chunk.js.map