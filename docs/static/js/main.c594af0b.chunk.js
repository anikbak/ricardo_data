(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{226:function(e,t){},328:function(e,t,a){e.exports=a(887)},339:function(e,t,a){},592:function(e,t){},593:function(e,t){},599:function(e,t){},601:function(e,t){},63:function(e){e.exports={b:"https://raw.githubusercontent.com/medialab/ricardo_data/master",a:"https://api.github.com/repos/medialab/ricardo_data/contents"}},633:function(e,t){},634:function(e,t){},767:function(e,t,a){var n={"./geojson.json":299,"./table-schema.json":768,"./topojson.json":300};function r(e){var t=o(e);return a(t)}function o(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=o,e.exports=r,r.id=767},835:function(e,t,a){var n={"./data-package.json":836,"./data-resource.json":837,"./fiscal-data-package.json":838,"./registry.json":839,"./tabular-data-package.json":840,"./tabular-data-resource.json":841};function r(e){var t=o(e);return a(t)}function o(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=o,e.exports=r,r.id=835},887:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(76),c=a.n(o),i=a(34),l=(a(339),a(58)),s=a(59),u=a(61),d=a(60),p=a(62),m=a(18),f=a(120),h=a(63),v=a(77),b="FETCH_DATAPACKAGE_SUCCESS",E="FETCH_TABLES_SUCCESS",y=[{name:"sources",path:"data/sources.csv"},{name:"entity_names",path:"data/entity_names.csv"}],O={};var j=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.props.fetchDatapackage(),this.props.fetchAllTables({branch:"master"})}},{key:"render",value:function(){var e=this.props.repoData;return r.a.createElement("div",null,!e.tables&&r.a.createElement("span",null,"loading tables"),!e.datapackage&&r.a.createElement("span",null,"loading datapackage"))}}]),t}(r.a.Component),g=Object(i.b)(function(e){return{repoData:e.repoData}},{fetchAllTables:function(e){return function(t){var a=e.branch;t({type:"FETCH_TABLES_REQUEST"}),Promise.all(y.map(function(e){return Object(f.get)("".concat(h.a,"/").concat(e.path,"?ref=").concat(a))})).then(function(e){var a={};e.forEach(function(e){var t=e.data.name.split(".")[0];a[t]=e.data}),t({type:E,payload:a})}).catch(function(a){return t({type:"FETCH_TABLES_FAILURE",payload:e,error:a})})}},fetchDatapackage:function(){return function(e){return e({type:"FETCH_DATAPACKAGE_REQUEST"}),Object(f.get)("".concat(h.a,"/datapackage.json?ref=master")).then(function(t){return e({type:b,payload:t.data})}).catch(function(t){return e({type:"FETCH_DATAPACKAGE_FAILURE",error:t})})}}})(j),w=a(327),k=a(15),S="UPDATE_FLOW",T="IMPORT_FLOWS",A={};var _="SET_STEP",C=function(e){return{type:_,payload:e}},F=[{id:"0",name:"Upload file",title:"Choose a file"},{id:"1",name:"Schema Validation",title:"Schema validation against datapackage"}],D={steps:F,selectedStep:F[0]};var L=a(177),N=a.n(L),R=a(78);var U=Object(i.b)(function(e){return{flow:e.flow}},{importFlows:function(e){return{type:T,payload:e}},setStep:C})(function(e){var t=e.setStep,a=e.importFlows;return r.a.createElement(k.DropZone,{maxSize:1e7,onDrop:function(e){var n=Object(w.a)(e,1)[0];"xlsx"===n.name.split(".")[1]?function(e){return new Promise(function(t,a){var n=new FileReader;n.onload=function(e){var a=e.target.result,r=N.a.read(a,{type:"binary"}),o=r.SheetNames[0],c=r.Sheets[o],i=N.a.utils.sheet_to_json(c,{header:1,defval:"",blankrows:!1});t(i),n=void 0},n.onerror=function(e){a(e.target.error),n=void 0},n.readAsBinaryString(e)})}(n).then(function(e){a({file:{name:n.name},data:e}),t({id:"1"})}).catch(function(e){return console.error("fail to parse file")}):function(e){return new Promise(function(t,a){var n=new FileReader;return n.onload=function(a){var r;r="csv"===e.name.split(".")[1]?Object(R.b)(a.target.result):Object(R.c)(a.target.result),t(r),n=void 0},n.onerror=function(e){a(e.target.error),n=void 0},n.readAsText(e)})}(n).then(function(e){a({file:{name:n.name},data:e}),t({id:"1"})}).catch(function(e){return console.error("fail to parse file")})}},r.a.createElement("span",{className:"tech-info"},"Drag and drop .xlsx, .csv file here"))}),V=a(119),B=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.className,a=e.columnNames,n=void 0===a?[]:a,o=e.values,c=void 0===o?[]:o;return r.a.createElement("div",{style:{position:"relative",width:"100%",height:"70vh"}},r.a.createElement("div",{className:"action-table ".concat(t)},r.a.createElement("div",{className:"action-table-header"},n.map(function(e,t){return r.a.createElement("div",{key:t,className:"table-cell"},e)})),r.a.createElement("div",{className:"action-table-main"},c.map(function(e,t){return r.a.createElement("div",{key:t,className:"table-row"},n.map(function(t,a){return r.a.createElement("div",{key:a,className:"table-cell",style:{wordBreak:"break-all",color:e[t].valid?"black":"red"}},e[t].value,!e[t].valid&&r.a.createElement(k.HelpPin,{place:"right"},e[t].errorType,":",e[t].message))}))}))))}}]),t}(r.a.Component),x=a(17),P=a.n(x),I=a(178),H=(a(595),a(325),a(118)),K="VALIDATE_TABLE_REQUEST",M="VALIDATE_TABLE_SUCCESS",W="VALIDATE_TABLE_FAILURE",G={tableValidated:"flows",schemaFeedback:null,tables:null};var J=function(e){var t=e.schemaValidation.tableValidated;return e.schemaValidation.descriptor.resources.find(function(e){return e.name===t}).schema},Q=function(e){var t=Y(e),a={};return t.forEach(function(t){var n=t.reference.resource;a[n]=e.schemaValidation.tables[n]}),a},Y=function(e){var t=e.schemaValidation.tableValidated;return e.schemaValidation.descriptor.resources.find(function(e){return e.name===t}).schema.foreignKeys},z=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.flows,a=e.schema,n=(e.schemaFeedback,e.relations);this.props.validateTable({source:t,schema:a,relations:n})}},{key:"render",value:function(){var e=this.props,t=e.flows,a=(e.schema,e.schemaFeedback),n=(e.relations,t[0]),o=["ERROR_FORMAT","ERROR_UNIQUE_KEY","ERROR_FOREIGN_KEY"];return r.a.createElement("div",null,a&&"loading"===a.status&&r.a.createElement("span",null,"validating flows"),a&&!a.valid&&a.errors&&r.a.createElement("div",null,r.a.createElement("span",null,"Found ",a.errors.length," rows has errors"),r.a.createElement(B,{values:function(){var e=[];return a.errors.forEach(function(a){var r=t[a.rowNumber-1],c=n.reduce(function(e,t,n){var c={name:t,value:r[n],valid:!0};return o.forEach(function(e){var r=a.errors.find(function(t){return t.type===e});if(r&&r.errors){var o=r.errors.find(function(e){return e.columnNumber?e.columnNumber===n+1:e.columnName?e.columnName[0]===t:void 0});o&&(c=Object(m.a)({},c,{valid:!1,errorType:e,message:o.message}))}}),Object(m.a)({},e,Object(V.a)({},t,c))},{});e.push(c)}),e}(),columnNames:n})),a&&a.valid&&r.a.createElement("span",null,"Flows data is valid"))}}]),t}(r.a.Component),Z=Object(i.b)(function(e){return{flows:e.flows.data,schema:e.schemaValidation.descriptor&&J(e),relations:e.schemaValidation.descriptor&&Q(e),foreignKeys:e.schemaValidation.descriptor&&Y(e),schemaFeedback:e.schemaValidation.schemaFeedback}},{validateTable:function(e){return function(t){t({type:K,payload:{status:"loading"}});var a=e.source,n=e.schema,r=e.relations;t(Object(I.a)(P.a.mark(function e(){var o,c,i;return P.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,H.Table.load(a,{schema:n});case 3:return o=e.sent,e.next=6,o.read({forceCast:!0,relations:r,limit:500});case 6:c=e.sent,(i=c.filter(function(e){return e.errors})).length?t({type:W,payload:{status:"done",valid:!1,errors:i}}):t({type:M,payload:{status:"done",valid:!0}}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),t({type:W,payload:e.t0});case 14:case"end":return e.stop()}},e,null,[[0,11]])})))}}})(z),$=function(e){var t=e.steps,a=e.selectedStep,n=e.onSetStep,o=e.children;return r.a.createElement(k.LayoutWrapper,{hasConfig:!0},r.a.createElement(k.LayoutHeader,null,r.a.createElement(k.AppTitle,null,"Ricardo Data App"),r.a.createElement(k.RunningTitle,null,a.title)),r.a.createElement(k.LayoutContainer,null,r.a.createElement(k.LayoutContent,null,r.a.createElement(k.LayoutContentColumn,{isConfig:!0},t.map(function(e,t){var o=a.id===e.id,c=e.id>a.id;return r.a.createElement(k.ButtonContainer,{key:t},r.a.createElement(k.Button,{isColor:o?"info":null,isDisabled:c,onClick:function(){return n(e)}},e.name))})),r.a.createElement(k.LayoutContentColumn,{isWorkspace:!0},o)),r.a.createElement(k.LayoutFooter,null,r.a.createElement(k.LayoutFooterColumn,{isSecondary:!0},r.a.createElement("h3",null,"m\xe9dialab SciencesPo")),r.a.createElement(k.LayoutFooterColumn,{isPrimary:!0},"Ricardo Data App"))))},q=(a(886),Object(i.b)(function(e){return{steps:e.ui.steps,selectedStep:e.ui.selectedStep,repoData:e.repoData}},{setStep:C})(function(e){var t=e.steps,a=e.selectedStep,n=e.repoData,o=e.setStep;return r.a.createElement("div",{className:"App"},r.a.createElement(g,null),n.descriptor&&r.a.createElement($,{steps:t,selectedStep:a,onSetStep:o},function(){switch(a.id){case"0":default:return r.a.createElement(U,null);case"1":return r.a.createElement(Z,null)}}()))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var X=a(41),ee=a(326),te=Object(X.c)({ui:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0,a=t.payload;switch(t.type){case _:return Object(m.a)({},e,{selectedStep:F.find(function(e){return a.id===e.id})});default:return e}},flows:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,t=arguments.length>1?arguments[1]:void 0,a=t.payload;switch(t.type){case T:return a;case S:return Object(m.a)({},e,{data:a.data});default:return e}},schemaValidation:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G,t=arguments.length>1?arguments[1]:void 0,a=t.payload;switch(t.type){case _:return"0"===a.id?Object(m.a)({},e,{schemaFeedback:null}):e;case E:var n={};return Object.keys(a).forEach(function(e){n[e]=Object(R.a)(v.Base64.decode(a[e].content))}),Object(m.a)({},e,{tables:n});case b:return Object(m.a)({},e,{descriptor:JSON.parse(v.Base64.decode(a.content))});case K:case W:case M:return Object(m.a)({},e,{schemaFeedback:a});default:return e}},repoData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,t=arguments.length>1?arguments[1]:void 0,a=t.payload;switch(t.type){case E:return Object(m.a)({},e,{tables:a});case b:return Object(m.a)({},e,{datapackage:a,descriptor:JSON.parse(v.Base64.decode(a.content))});default:return e}}});var ae=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[ee.a],a=X.d.apply(void 0,[X.a.apply(void 0,t)].concat([]));return Object(X.e)(te,e,a)}({});c.a.render(r.a.createElement(i.a,{store:ae},r.a.createElement(q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[328,1,2]]]);
//# sourceMappingURL=main.c594af0b.chunk.js.map